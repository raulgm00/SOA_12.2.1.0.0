<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
    <con:coreEntry>
        <con:description/>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="GestionClientes/Clientes/Resources/WSDL/NMPClientesWSDL"/>
            <con:binding>
                <con:name>ClientesBinding</con:name>
                <con:namespace>http://servicios.montedepiedad.com.mx/NMP/Services/Clientes</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations>
            <oper:tracingEnabled>true</oper:tracingEnabled>
            <oper:logging enabled="false" level="debug"/>
            <oper:monitoring enabled="true" level="action" aggregationInterval="1440"/>
            <oper:pipeline-alerting enabled="false" level="normal"/>
            <oper:sla-alerting enabled="false" level="normal"/>
        </oper:operations>
        <con:pageAttachments isEnabled="false"/>
        <con:transactions isRequired="false" sameTxForResponse="false"/>
    </con:coreEntry>
    <con2:router errorHandler="_onErrorHandler-4672933421076769680--773d94a4.14252537b97.-7f54" xmlns:ser="http://www.bea.com/wli/sb/services" xmlns:tran="http://www.bea.com/wli/sb/transports" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/pipeline/config">
        <con2:pipeline name="PipelinePairNodeGetClientesByID_response" type="response">
            <con:stage name="Response Stage" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="tem" namespace="http://tempuri.org/"/>
                    <con1:userNsDecl prefix="a" namespace="http://schemas.datacontract.org/2004/07/Nmp.Crm.BusinessEntity.DataContract"/>
                    <con1:userNsDecl prefix="crm" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal"/>
                    <con1:userNsDecl prefix="crma" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/CanonicalModel"/>
                    <con1:userNsDecl prefix="b" namespace="http://schemas.datacontract.org/2004/07/Nmp.Crm.BusinessEntity.Modelos"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con3:assign varName="respuesta" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-a1e030f.26a809d1.9.153533e10d3.N8000</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">dvm:lookupValue('GestionClientes/Clientes/Resources/DVM/settingsServicioClientes', 'Value',$header/nmp:headerMessage/nmp:idConsumidor/text(),'Attribute2', '0',('Parameter','ServicioCRM'))</con:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con2:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:comment>RES1 = Respuesta del BS CrmSericioClientesBS
RES2 = Respuesta del BS RhinoServiceBS
RES3 = Respuesta Corta del BS CrmSericioClientesBS
ELSE = Se adjunta a la respuesta del BS RhinoServiceBS las calificaciones.</con1:comment>
                        <con1:id>_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fe9</con1:id>
                        <con2:case>
                            <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta= 'RES1'</con:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fe8</con1:id>
                                    <con2:location>
                                        <con1:xpathText>.</con1:xpathText>
                                    </con2:location>
                                    <con2:expr>
                                        <con1:xsltTransform>
                                            <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMGetClienteResToGetClienteByIdResSiva2"/>
                                            <con1:input>$getClienteRes</con1:input>
                                        </con1:xsltTransform>
                                    </con2:expr>
                                </con2:replace>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta = 'RES2'</con:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-a1e030f.N29ad687d.26.1527f11d854.N7fff</con1:id>
                                    <con2:location>
                                        <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                                    </con2:location>
                                    <con2:expr>
                                        <con:xsltTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                            <con:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMCredGetClienteResToGetClienteByIdRes"/>
                                            <con:input>$getClienteByIdRes</con:input>
                                        </con:xsltTransform>
                                    </con2:expr>
                                </con2:replace>
                            </con2:actions>
                        </con2:case>
                        <con2:case id="_BranchId-N3f57c7ff.N4732ce16.0.1533a63aa59.N7fff">
                            <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta = 'RES3'</con:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-N3f57c7ff.N4732ce16.0.1533a63aa59.N7ffc</con1:id>
                                    <con2:location>
                                        <con1:xpathText>.</con1:xpathText>
                                    </con2:location>
                                    <con2:expr>
                                        <con1:xsltTransform>
                                            <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMCredGetClienteByIdToGetClienteResponseShort"/>
                                            <con1:input>$getClienteByIdRes</con1:input>
                                        </con1:xsltTransform>
                                    </con2:expr>
                                </con2:replace>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta = 'RES4'</con:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-a1e030f.Na232ee5.6.15454dec6bd.N8000</con1:id>
                                    <con2:location>
                                        <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                                    </con2:location>
                                    <con2:expr>
                                        <con:xsltTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                            <con:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMCredGetClienteResToGetClienteByIdResV2"/>
                                            <con:input>$getClienteByIdRes</con:input>
                                        </con:xsltTransform>
                                    </con2:expr>
                                </con2:replace>
                            </con2:actions>
                        </con2:case>
                        <con2:case>
                            <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta = '0'</con:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:Error>
                                    <con1:id>_ActionId-a1e030f.24c85e56.4.15749a3d92e.N7fff</con1:id>
                                    <con2:errCode>NMP-1009</con2:errCode>
                                    <con2:message>Consumidor no identificado</con2:message>
                                </con2:Error>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:assign varName="CalifAjust">
                                <con1:id>_ActionId-a1e030f.34944d31.f.152c36674c7.N8000</con1:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteRes//crm:GetClienteResult/crma:CalificacionAjustada/text()</con:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="FechIng">
                                <con1:id>_ActionId-a1e030f.34944d31.10.152c3672941.N8000</con1:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteRes//crm:GetClienteResult/crma:FechaIngreso/text()</con:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="CalifSIVA2">
                                <con1:id>_ActionId-a1e030f.34944d31.12.152c38776d8.N8000</con1:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteRes//crm:GetClienteResult/crma:CalificacionSIVA2/text()</con:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="SobAfAj">
                                <con1:id>_ActionId-a1e030f.34944d31.13.152c388ee4a.N8000</con1:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteRes//crm:GetClienteResult/crma:SobreAforoAjustado/text()</con:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con2:assign varName="SobSIVA2">
                                <con1:id>_ActionId-a1e030f.34944d31.a.152c1cb3d42.N7fff</con1:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteRes//crm:GetClienteResult/crma:SobreAforoSIVA2/text()</con:xqueryText>
                                </con2:expr>
                            </con2:assign>
                            <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                                <con1:id>_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fe7</con1:id>
                                <con:location>
                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                                </con:location>
                                <con:expr>
                                    <con:xsltTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                        <con:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMGetClienteResToGetClienteByIdRes"/>
                                        <con:input>$getClienteRes</con:input>
                                    </con:xsltTransform>
                                </con:expr>
                            </con:replace>
                            <con2:insert varName="body">
                                <con1:id>_ActionId-a1e030f.34944d31.11.152c36a4267.N8000</con1:id>
                                <con2:location>
                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmp1:getClientesByIDResponse/nmp1:Cliente/nmp1:fechaDeNacimiento</con:xpathText>
                                </con2:location>
                                <con2:where>after</con2:where>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML(fn:concat('
&lt;NMPConsultaC:fechaIngreso xmlns:NMPConsultaC="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">',$FechIng,'&lt;/NMPConsultaC:fechaIngreso>
'))</con:xqueryText>
                                </con2:expr>
                            </con2:insert>
                            <con2:insert varName="body">
                                <con1:id>_ActionId-a1e030f.34944d31.14.152c38b63b2.N8000</con1:id>
                                <con2:location>
                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmp1:getClientesByIDResponse/nmp1:Cliente/nmp1:sobreAforo</con:xpathText>
                                </con2:location>
                                <con2:where>after</con2:where>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[fn-bea:inlinedXML(fn:concat('
<NMPConsultaC:calificacionAjustada xmlns:NMPConsultaC="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">',$CalifAjust,'</NMPConsultaC:calificacionAjustada>
<NMPConsultaC:calificacionSIVA2 xmlns:NMPConsultaC="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">',$CalifSIVA2,'</NMPConsultaC:calificacionSIVA2>
<NMPConsultaC:sobreaforoAjustado xmlns:NMPConsultaC="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">',$SobAfAj,'</NMPConsultaC:sobreaforoAjustado>
<NMPConsultaC:sobreaforoSIVA2 xmlns:NMPConsultaC="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">',$SobSIVA2,'</NMPConsultaC:sobreaforoSIVA2>
'))]]></con:xqueryText>
                                </con2:expr>
                            </con2:insert>
                        </con2:default>
                    </con2:ifThenElse>
                    <con1:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fe6</con3:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML(&lt;soap:Header xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"/>)</con:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con3:report xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:id>_ActionId-a1e030f.5c4c5103.2.152a3629a80.N7fff</con1:id>
                        <con1:disabled>true</con1:disabled>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>Response idCliente</con3:key>
                            <con3:varName>body</con3:varName>
                            <con3:value>
                                <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmp1:getClientesByIDResponse/nmp1:Cliente/nmp1:idCliente</con:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                </con:actions>
            </con:stage>
        </con2:pipeline>
        <con:pipeline name="_onErrorHandler-4672933421076769680--773d94a4.14252537b97.-7f54" type="error" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
            <con:stage name="Error Handler General">
                <con:context>
                    <con1:userNsDecl prefix="con" namespace="http://www.bea.com/wli/sb/context"/>
                    <con1:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                    <con1:userNsDecl prefix="ns1" namespace="urn:mx.com.nmp.clientes"/>
                    <con1:userNsDecl prefix="NMPConsultaC" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="crm" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal"/>
                    <con1:varNsDecl prefix="nmp2" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-4672933421076769680--773d94a4.14252537b97.-7e30</con2:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML('&lt;soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">&lt;/soapenv:Header>')</con:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7f8b</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrClientesSvcFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>0</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con:replace>
                    <con3:report xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:id>_ActionId-5159819096348468750-7788eb9a.145e1add37b.-7f8d</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$fault</con:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>errorClientes</con3:key>
                            <con3:varName>fault</con3:varName>
                            <con3:value>
                                <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./con:errorCode</con:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                    <con4:reply isError="true" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con3:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7f88</con3:id>
                    </con4:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con2:pipeline name="PipelinePairNodeGetClientesByID_request" type="request">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N7dec" name="StageValidacion">
                <con2:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="nmpH" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con2:context>
                <con2:actions>
                    <con2:ifThenElse xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:comment>If Then: componente que ayuda a validar el header comun para NMP : id, idConsumidor, idDestino</con1:comment>
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7deb</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N7dea">
                            <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$header/nmpH:headerMessage/nmpH:idConsumidor</con:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:validate>
                                    <con1:comment>valida el headerMessage de los XSD comunes de NMP</con1:comment>
                                    <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7de9</con1:id>
                                    <con1:disabled>true</con1:disabled>
                                    <con2:schema ref="Common/XSD/NMPStandardHeader"/>
                                    <con2:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con2:schemaElement>
                                    <con2:varName>header</con2:varName>
                                    <con2:location>
                                        <con1:xpathText>./nmpH:headerMessage</con1:xpathText>
                                    </con2:location>
                                    <con2:resultVarName/>
                                </con2:validate>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:comment>Propaga un error NMP-008  = Hacen falta datos en el header</con1:comment>
                                <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7de8</con1:id>
                                <con1:disabled>true</con1:disabled>
                                <con2:errCode>NMP-008</con2:errCode>
                                <con2:message>Hacen falta datos del encabezado. Favor de intentarlo nuevamente</con2:message>
                            </con2:Error>
                            <con2:assign varName="header">
                                <con1:id>_ActionId-a1e030f.24c85e56.18.1579c41ce2e.N7ffd</con1:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<soap:Header   xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
        <nmph:headerMessage xmlns:nmph="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
            <nmph:usuario>NMP</nmph:usuario>
            <nmph:idConsumidor>0</nmph:idConsumidor>
            <nmph:idDestino>CRM</nmph:idDestino>
        </nmph:headerMessage>
</soap:Header>]]></con:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:default>
                    </con2:ifThenElse>
                    <con:validate xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7de7</con1:id>
                        <con3:schema ref="GestionClientes/Clientes/Resources/Schemas/NMPClientesSvcElementosXSD"/>
                        <con3:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">nmp:getClientesByIDRequest</con3:schemaElement>
                        <con:varName>body</con:varName>
                        <con:location>
                            <con1:xpathText>./nmp:getClientesByIDRequest</con1:xpathText>
                        </con:location>
                        <con3:resultVarName/>
                    </con:validate>
                    <con:assign varName="header_tmp" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7de6</con1:id>
                        <con:expr>
                            <con1:xqueryText>$header</con1:xqueryText>
                        </con:expr>
                    </con:assign>
                </con2:actions>
            </con2:stage>
            <con2:stage name="Request Stage" errorHandler="error-N5601d8a2.7c411741.0.1566b28cb14.N7826" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="crma" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/CanonicalModel"/>
                    <con1:userNsDecl prefix="tem" namespace="http://tempuri.org/"/>
                    <con1:userNsDecl prefix="crm" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal"/>
                    <con1:userNsDecl prefix="urn" namespace="urn:sap-com:document:sap:soap:functions:mc-style"/>
                    <con1:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con3:assign varName="BS" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-a1e030f.26a809d1.7.1535339df37.N8000</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">dvm:lookupValue('GestionClientes/Clientes/Resources/DVM/settingsServicioClientes', 'Value',$header/nmp:headerMessage/nmp:idConsumidor/text(),'Attribute1', '0',('Parameter','ServicioCRM'))</con:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-a1e030f.N31a57db3.1.151c8042c4b.N8000</con1:id>
                        <con3:case>
                            <con3:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$BS = '2'</con:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:wsCallout>
                                    <con1:id>_ActionId-a1e030f.N31a57db3.2.151c8056d12.N8000</con1:id>
                                    <con3:service ref="GestionClientes/Clientes/Business Services/CRMClienteSvcBajaDispBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>GetCliente</con3:operation>
                                    <con3:request>
                                        <con3:body wrapped="false">getClienteByIdReq</con3:body>
                                        <con3:header/>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body wrapped="false">getClienteByIdRes</con3:body>
                                        <con3:header/>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con3:assign varName="getClienteByIdReq">
                                            <con1:id>_ActionId-a1e030f.N31a57db3.3.151c8060130.N8000</con1:id>
                                            <con3:expr>
                                                <con1:xqueryText>&lt;tem:GetCliente xmlns:tem='http://tempuri.org/'>
        &lt;tem:Id>{$body/nmp1:getClientesByIDRequest/nmp1:idCliente/text()}&lt;/tem:Id>
&lt;/tem:GetCliente></con1:xqueryText>
                                            </con3:expr>
                                        </con3:assign>
                                        <con1:assign varName="fuenteDatosCRM" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7e6e</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>dvm:lookup("Common/DVM/NMPFuenteDatosCRM", "idDestinoOSB",$header/nmp:headerMessage/nmp:idDestino, "fuenteDatosCRM", "null")</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7e70</con2:id>
                                            <con3:case id="_BranchId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7e6f">
                                                <con3:condition>
                                                    <con2:xqueryText>$fuenteDatosCRM!='null'</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:insert varName="getClienteByIdReq">
                                                        <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7e6d</con2:id>
                                                        <con3:location>
                                                            <con2:xpathText>./tem:Id</con2:xpathText>
                                                        </con3:location>
                                                        <con3:where>after</con3:where>
                                                        <con3:expr>
                                                            <con2:xqueryText>&lt;tem:FuenteDato>{$fuenteDatosCRM}&lt;/tem:FuenteDato></con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:insert>
                                                </con3:actions>
                                            </con3:case>
                                        </con1:ifThenElse>
                                        <con4:report xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                                            <con1:id>_ActionId-a1e030f.77e03d19.6.1583fe564df.N8000</con1:id>
                                            <con4:expr>
                                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteByIdReq</con:xqueryText>
                                            </con4:expr>
                                            <con4:labels>
                                                <con4:key>idDestino</con4:key>
                                                <con4:varName>header</con4:varName>
                                                <con4:value>
                                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmph:headerMessage/nmph:idDestino</con:xpathText>
                                                </con4:value>
                                            </con4:labels>
                                        </con4:report>
                                    </con3:requestTransform>
                                    <con3:responseTransform/>
                                </con3:wsCallout>
                            </con3:actions>
                        </con3:case>
                        <con3:case>
                            <con3:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$BS = '1'</con:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a1e030f.26a809d1.7.1535339df37.N7fff</con2:id>
                                    <con1:service ref="GestionClientes/Clientes/Business Services/CRMClienteSvcAltaDispBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>GetCliente</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">getClienteReq</con1:body>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">getClienteRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="getClienteReq">
                                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a1e030f.26a809d1.7.1535339df37.N7ffe</con2:id>
                                            <con1:expr>
                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">&lt;crm:GetCliente>
        &lt;crm:Id>{$body/nmp1:getClientesByIDRequest/nmp1:idCliente/text()}&lt;/crm:Id>
&lt;/crm:GetCliente></con4:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="fuenteDatosCRM" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7deb</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>dvm:lookup("Common/DVM/NMPFuenteDatosCRM", "idDestinoOSB",$header/nmp:headerMessage/nmp:idDestino, "fuenteDatosCRM", "null")</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7ded</con2:id>
                                            <con3:case id="_BranchId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dec">
                                                <con3:condition>
                                                    <con2:xqueryText>$fuenteDatosCRM!='null'</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:insert varName="getClienteReq">
                                                        <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dea</con2:id>
                                                        <con3:location>
                                                            <con2:xpathText>./crm:Id</con2:xpathText>
                                                        </con3:location>
                                                        <con3:where>after</con3:where>
                                                        <con3:expr>
                                                            <con2:xqueryText>&lt;crm:FuenteDato>{$fuenteDatosCRM}&lt;/crm:FuenteDato></con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:insert>
                                                </con3:actions>
                                            </con3:case>
                                        </con1:ifThenElse>
                                        <con4:report xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                                            <con1:id>_ActionId-a1e030f.77e03d19.9.1583fe74081.N8000</con1:id>
                                            <con4:expr>
                                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteReq</con:xqueryText>
                                            </con4:expr>
                                            <con4:labels>
                                                <con4:key>idDestino</con4:key>
                                                <con4:varName>header</con4:varName>
                                                <con4:value>
                                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmph:headerMessage/nmph:idDestino</con:xpathText>
                                                </con4:value>
                                            </con4:labels>
                                        </con4:report>
                                    </con1:requestTransform>
                                    <con1:responseTransform/>
                                </con1:wsCallout>
                            </con3:actions>
                        </con3:case>
                    </con3:ifThenElse>
                </con:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline type="request" name="request-N5601d8a2.7c411741.0.1566b28cb14.N7b58">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N7b56" name="StageDefault">
                <con2:context/>
                <con2:actions>
                    <con3:Error xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7b21</con1:id>
                        <con3:errCode>NMP-021</con3:errCode>
                        <con3:message>Operación no permitida</con3:message>
                    </con3:Error>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline name="PipelinePairNodeGetClientesByNumCredencial_response" type="response">
            <con:stage name="Response Stage" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="tem" namespace="http://tempuri.org/"/>
                    <con1:userNsDecl prefix="a" namespace="http://schemas.datacontract.org/2004/07/Nmp.Crm.BusinessEntity.DataContract"/>
                    <con1:userNsDecl prefix="crm" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal"/>
                    <con1:userNsDecl prefix="crma" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/CanonicalModel"/>
                    <con1:userNsDecl prefix="b" namespace="http://schemas.datacontract.org/2004/07/Nmp.Crm.BusinessEntity.Modelos"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con3:assign varName="respuesta" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-a1e030f.26a809d1.d.15353431ebb.N8000</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">dvm:lookupValue('GestionClientes/Clientes/Resources/DVM/settingsServicioClientes', 'Value',$header/nmp:headerMessage/nmp:idConsumidor/text(),'Attribute2', '0',('Parameter','ServicioCRM'))</con:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:comment>RES1 = Respuesta del BS CrmSericioClientesBS
RES2 = Respuesta del BS RhinoServiceBS</con1:comment>
                        <con1:id>_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fe2</con1:id>
                        <con3:case>
                            <con3:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta= 'RES1'</con:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fe1</con1:id>
                                    <con3:location>
                                        <con1:xpathText>.</con1:xpathText>
                                    </con3:location>
                                    <con3:expr>
                                        <con1:xsltTransform>
                                            <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMGetClienteByNumCredResToGetClienteByNumCredResSiva2"/>
                                            <con1:input>$getClienteByNMPCredentialRes</con1:input>
                                        </con1:xsltTransform>
                                    </con3:expr>
                                </con3:replace>
                            </con3:actions>
                        </con3:case>
                        <con3:case id="_BranchId-af00456.78c830e0.0.151c5c6a05a.N7f8d">
                            <con3:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta = 'RES2' or $respuesta = 'RES3' or $respuesta = 'RES4'</con:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-af00456.78c830e0.0.151c5c6a05a.N7f8a</con1:id>
                                    <con3:expr>
                                        <con:xsltTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                            <con:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMCredGetClienteByNumCredResToGetClienteByNumCredencialRes"/>
                                            <con:input>$getClienteByNMPCredentialRes</con:input>
                                        </con:xsltTransform>
                                    </con3:expr>
                                </con3:replace>
                            </con3:actions>
                        </con3:case>
                        <con3:case>
                            <con3:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$respuesta = '0'</con:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con2:Error xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con1:id>_ActionId-a1e030f.24c85e56.c.15769039118.N8000</con1:id>
                                    <con2:errCode>NMP-1009</con2:errCode>
                                    <con2:message>Consumidor no identificado</con2:message>
                                </con2:Error>
                            </con3:actions>
                        </con3:case>
                        <con3:default>
                            <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fe0</con4:id>
                                <con1:location>
                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                                </con1:location>
                                <con1:expr>
                                    <con:xsltTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                        <con:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMGetClienteByNumCredResToGetClienteByNumCredRes"/>
                                        <con:input>$getClienteByNMPCredentialRes</con:input>
                                    </con:xsltTransform>
                                </con1:expr>
                            </con1:replace>
                        </con3:default>
                    </con3:ifThenElse>
                    <con1:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con3:id xmlns:con3="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fdf</con3:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML(&lt;soap:Header xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"/>)</con:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con3:report xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:id>_ActionId-a1e030f.5c4c5103.7.152a413ae54.N8000</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body</con:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>Response numCredencial</con3:key>
                            <con3:varName>body</con3:varName>
                            <con3:value>
                                <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmp1:getClientesByNumCredencialResponse/nmp1:Cliente/nmp1:numeroDeCredencial</con:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                </con:actions>
            </con:stage>
        </con2:pipeline>
        <con2:pipeline type="error" name="error-N5601d8a2.N14b41a90.0.15651c81563.N77df">
            <con2:stage id="_StageId-N5601d8a2.N14b41a90.0.15651c81563.N77de" name="StageErrorHandlerGetCampanias">
                <con2:context/>
                <con2:actions>
                    <con:assign varName="getCampaniasClienteBodyRes" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ffb</con1:id>
                        <con:expr>
                            <con1:xqueryText>&lt;nmp1:getCampaniasClienteResponse xmlns:nmp1="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCampaniasPrendario"/></con1:xqueryText>
                        </con:expr>
                    </con:assign>
                    <con1:resume>
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ffe</con1:id>
                    </con1:resume>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline name="PipelinePairNodeGetHuellaCliente_request" type="request">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N7cbb" name="StageValidacion">
                <con2:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="nmpH" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con2:context>
                <con2:disabled>true</con2:disabled>
                <con2:actions>
                    <con2:ifThenElse xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:comment>If Then: componente que ayuda a validar el header comun para NMP : id, idConsumidor, idDestino</con1:comment>
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7cba</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N7cb9">
                            <con2:condition>
                                <con1:xqueryText>$header/nmpH:headerMessage</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:validate>
                                    <con1:comment>valida el headerMessage de los XSD comunes de NMP</con1:comment>
                                    <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7cb8</con1:id>
                                    <con2:schema ref="Common/XSD/NMPStandardHeader"/>
                                    <con2:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con2:schemaElement>
                                    <con2:varName>header</con2:varName>
                                    <con2:location>
                                        <con1:xpathText>./nmpH:headerMessage</con1:xpathText>
                                    </con2:location>
                                    <con2:resultVarName/>
                                </con2:validate>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:comment>Propaga un error NMP-008  = Hacen falta datos en el header</con1:comment>
                                <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7cb7</con1:id>
                                <con2:errCode>NMP-008</con2:errCode>
                                <con2:message>Hacen falta datos del encabezado. Favor de intentarlo nuevamente</con2:message>
                            </con2:Error>
                        </con2:default>
                    </con2:ifThenElse>
                    <con:validate xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7cb6</con1:id>
                        <con3:schema ref="GestionClientes/Clientes/Resources/Schemas/NMPClientesSvcElementosXSD"/>
                        <con3:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">nmp:getHuellaClienteRequest</con3:schemaElement>
                        <con:varName>body</con:varName>
                        <con:location>
                            <con1:xpathText>./nmp:getHuellaClienteRequest</con1:xpathText>
                        </con:location>
                        <con3:resultVarName/>
                    </con:validate>
                    <con:assign varName="header_tmp" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7cb5</con1:id>
                        <con:expr>
                            <con1:xqueryText>$header</con1:xqueryText>
                        </con:expr>
                    </con:assign>
                </con2:actions>
            </con2:stage>
            <con:stage name="Request Stage" errorHandler="error-N5601d8a2.7c411741.0.1566b28cb14.N7606" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="tem" namespace="http://tempuri.org/"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fd7</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Business Services/CRMClienteFingerPrintSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>GetHuellaByID</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">GetHuellaByIDReq</con1:body>
                            <con1:header/>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">GetHuellaByIDRes</con1:body>
                            <con1:header/>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="GetHuellaByIDReq">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fd8</con2:id>
                                <con1:expr>
                                    <con3:xqueryText xmlns:con3="http://www.bea.com/wli/sb/stages/config">&lt;tem:GetHuellaByID xmlns:tem='http://tempuri.org/'>
         &lt;tem:Id>{$body/nmp1:getHuellaClienteRequest/nmp1:idCliente/text()}&lt;/tem:Id>
&lt;/tem:GetHuellaByID></con3:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con3:assign varName="fuenteDatosCRM" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dc1</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>dvm:lookup("Common/DVM/NMPFuenteDatosCRM", "idDestinoOSB",$header/nmp:headerMessage/nmp:idDestino, "fuenteDatosCRM", "null")</con2:xqueryText>
                                </con1:expr>
                            </con3:assign>
                            <con3:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dc3</con2:id>
                                <con3:case id="_BranchId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dc2">
                                    <con3:condition>
                                        <con2:xqueryText>$fuenteDatosCRM!='null'</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions>
                                        <con3:insert varName="GetHuellaByIDReq">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dc0</con2:id>
                                            <con3:location>
                                                <con2:xpathText>./tem:Id</con2:xpathText>
                                            </con3:location>
                                            <con3:where>after</con3:where>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;tem:FuenteDato>{$fuenteDatosCRM}&lt;/tem:FuenteDato></con2:xqueryText>
                                            </con3:expr>
                                        </con3:insert>
                                    </con3:actions>
                                </con3:case>
                            </con3:ifThenElse>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con2:pipeline>
        <con2:pipeline type="response" name="response-af004c8.22fe03f8.0.151b1078e26.N7fff">
            <con2:stage id="_StageId-af004c8.22fe03f8.0.151b1078e26.N7ffd" name="Response Stage">
                <con2:context/>
                <con2:actions>
                    <con:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-af004c8.22fe03f8.0.151b1078e26.N7ff2</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMValidarActualizarToValidarClienteRes"/>
                                <con1:input>$validarClienteRes</con1:input>
                            </con1:xsltTransform>
                        </con:expr>
                    </con:replace>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline type="error" name="error-N5601d8a2.7c411741.0.1566b28cb14.N7826">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N77de" name="StageCalloutError">
                <con2:context/>
                <con2:actions>
                    <con3:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7740</con4:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML('&lt;soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">&lt;/soapenv:Header>')</con:xqueryText>
                        </con1:expr>
                    </con3:replace>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N77d9</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrClientesSvcFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>1</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con3:replace>
                    <con4:reply isError="true" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N77d8</con4:id>
                    </con4:reply>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline type="error" name="error-N5601d8a2.7c411741.0.1566b28cb14.N7606">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N75cd" name="StageCalloutError">
                <con2:context/>
                <con2:actions>
                    <con3:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N75cc</con4:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML('&lt;soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">&lt;/soapenv:Header>')</con:xqueryText>
                        </con1:expr>
                    </con3:replace>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N75cb</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrClientesSvcFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>1</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con3:replace>
                    <con4:reply isError="true" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N75ca</con4:id>
                    </con4:reply>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline type="error" name="error-N5601d8a2.7c411741.0.1566b28cb14.N7956">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N7955" name="StageCalloutError">
                <con2:context/>
                <con2:actions>
                    <con3:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N78ff</con4:id>
                        <con1:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N78fe">
                            <con1:condition>
                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">$fault/ctx:errorCode = 'OSB-382500'</con4:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con1="http://www.bea.com/wli/sb/stages/config">
                                    <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N78fb</con1:id>
                                    <con3:location>
                                        <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                                    </con3:location>
                                    <con3:expr>
                                        <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML(fn:concat("&lt;NMPConsultaC:validarClienteResponse xmlns:NMPConsultaC='http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente'>
	&lt;NMPConsultaC:respuesta>false&lt;/NMPConsultaC:respuesta>
&lt;/NMPConsultaC:validarClienteResponse>"))</con:xqueryText>
                                    </con3:expr>
                                </con3:replace>
                                <con3:reply isError="false" xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                    <con3:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N78fa</con3:id>
                                </con3:reply>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                                <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N78f7</con1:id>
                                <con:expr>
                                    <con1:xsltTransform>
                                        <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrClientesSvcFault"/>
                                        <con1:input>$fault</con1:input>
                                        <con1:param name="app">
                                            <con1:path>1</con1:path>
                                        </con1:param>
                                    </con1:xsltTransform>
                                </con:expr>
                            </con:replace>
                            <con3:reply isError="true" xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                <con3:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N78f6</con3:id>
                            </con3:reply>
                        </con1:default>
                    </con3:ifThenElse>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline type="error" name="error-N5601d8a2.7c411741.0.1566b28cb14.N7536">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N74fd" name="StageCalloutError">
                <con2:context/>
                <con2:actions>
                    <con3:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N74fc</con4:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML('&lt;soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">&lt;/soapenv:Header>')</con:xqueryText>
                        </con1:expr>
                    </con3:replace>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N74fb</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrClientesSvcFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>1</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con3:replace>
                    <con4:reply isError="true" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N74fa</con4:id>
                    </con4:reply>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline name="PipelinePairNodeGetHuellaCliente_response" type="response">
            <con:stage name="Response Stage" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="temp" namespace="http://tempuri.org/"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fd6</con2:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML(&lt;soap:Header xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"/>)</con:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con:replace varName="body" contents-only="true" xmlns:con="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fd5</con1:id>
                        <con:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con:location>
                        <con:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML(fn:concat("&lt;getHuellaClienteResponse xmlns:NMPConsultaC='http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente'>
	&lt;NMPConsultaC:huellaCliente>", $GetHuellaByIDRes/temp:GetHuellaByIDResult/text(), "&lt;/NMPConsultaC:huellaCliente>
&lt;/getHuellaClienteResponse>"))</con:xqueryText>
                        </con:expr>
                    </con:replace>
                </con:actions>
            </con:stage>
        </con2:pipeline>
        <con2:pipeline type="error" name="error-N5601d8a2.7c411741.0.1566b28cb14.N76da">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N76a1" name="StageCalloutError">
                <con2:context/>
                <con2:actions>
                    <con3:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N76a0</con4:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML('&lt;soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">&lt;/soapenv:Header>')</con:xqueryText>
                        </con1:expr>
                    </con3:replace>
                    <con3:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N769f</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrClientesSvcFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>1</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con3:replace>
                    <con4:reply isError="true" xmlns:con3="http://www.bea.com/wli/sb/stages/config" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/config">
                        <con4:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N769e</con4:id>
                    </con4:reply>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline name="PipelinePairNodeUpdateCliente_request" type="request">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N7ba8" name="StageValidacion">
                <con2:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="nmpH" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con2:context>
                <con2:actions>
                    <con2:ifThenElse xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:comment>If Then: componente que ayuda a validar el header comun para NMP : id, idConsumidor, idDestino</con1:comment>
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ba7</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N7ba6">
                            <con2:condition>
                                <con1:xqueryText>$header/nmpH:headerMessage</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:validate>
                                    <con1:comment>valida el headerMessage de los XSD comunes de NMP</con1:comment>
                                    <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ba5</con1:id>
                                    <con2:schema ref="Common/XSD/NMPStandardHeader"/>
                                    <con2:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con2:schemaElement>
                                    <con2:varName>header</con2:varName>
                                    <con2:location>
                                        <con1:xpathText>./nmpH:headerMessage</con1:xpathText>
                                    </con2:location>
                                    <con2:resultVarName/>
                                </con2:validate>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:comment>Propaga un error NMP-008  = Hacen falta datos en el header</con1:comment>
                                <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ba4</con1:id>
                                <con2:errCode>NMP-008</con2:errCode>
                                <con2:message>Hacen falta datos del encabezado. Favor de intentarlo nuevamente</con2:message>
                            </con2:Error>
                        </con2:default>
                    </con2:ifThenElse>
                    <con:validate xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ba3</con1:id>
                        <con3:schema ref="GestionClientes/Clientes/Resources/Schemas/NMPClientesSvcElementosXSD"/>
                        <con3:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">nmp:updateClienteRequest</con3:schemaElement>
                        <con:varName>body</con:varName>
                        <con:location>
                            <con1:xpathText>./nmp:updateClienteRequest</con1:xpathText>
                        </con:location>
                        <con3:resultVarName/>
                    </con:validate>
                    <con:assign varName="header_tmp" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ba2</con1:id>
                        <con:expr>
                            <con1:xqueryText>$header</con1:xqueryText>
                        </con:expr>
                    </con:assign>
                </con2:actions>
            </con2:stage>
            <con:stage name="Request Stage" errorHandler="error-N5601d8a2.7c411741.0.1566b28cb14.N7536" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="tmp" namespace="http://tempuri.org/"/>
                    <con1:userNsDecl prefix="ns1" namespace="http://schemas.datacontract.org/2004/07/Nmp.Crm.BusinessEntity.DataContract"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con3:wsCallout xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-a1e030f.4bae2a75.3b.151b2be68f8.N8000</con1:id>
                        <con3:service ref="GestionClientes/Clientes/Business Services/CRMClienteSvcBajaDispBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>ActualizaInformacionCliente</con3:operation>
                        <con3:request>
                            <con3:body wrapped="false">updateClienteReq</con3:body>
                            <con3:header/>
                        </con3:request>
                        <con3:response>
                            <con3:body wrapped="false">updateClienteRes</con3:body>
                            <con3:header/>
                        </con3:response>
                        <con3:requestTransform>
                            <con1:replace varName="updateClienteReq" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a1e030f.4bae2a75.3c.151b2bee846.N7fff</con2:id>
                                <con1:expr>
                                    <con:xsltTransform xmlns:con="http://www.bea.com/wli/sb/stages/config">
                                        <con:resource ref="GestionClientes/Clientes/Resources/Transformations/TrUpdateClienteReqToCRMValidarActualizar"/>
                                        <con:input>$body/*</con:input>
                                        <con:param name="StandardHeader">
                                            <con:path>$header</con:path>
                                        </con:param>
                                    </con:xsltTransform>
                                </con1:expr>
                            </con1:replace>
                            <con1:assign varName="fuenteDatosCRM" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7d19</con2:id>
                                <con2:disabled>true</con2:disabled>
                                <con1:expr>
                                    <con2:xqueryText>dvm:lookup("Common/DVM/NMPFuenteDatosCRM", "idDestinoOSB",$header/nmp:headerMessage/nmp:idDestino, "fuenteDatosCRM", "null")</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7d1b</con2:id>
                                <con2:disabled>true</con2:disabled>
                                <con3:case id="_BranchId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7d1a">
                                    <con3:condition>
                                        <con2:xqueryText>$fuenteDatosCRM!='null'</con2:xqueryText>
                                    </con3:condition>
                                    <con3:actions>
                                        <con3:insert varName="updateClienteReq">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7d18</con2:id>
                                            <con3:location>
                                                <con2:xpathText>./tmp:request</con2:xpathText>
                                            </con3:location>
                                            <con3:where>first-child</con3:where>
                                            <con3:expr>
                                                <con2:xqueryText>&lt;ns1:FuenteDato>{$fuenteDatosCRM}&lt;/ns1:FuenteDato></con2:xqueryText>
                                            </con3:expr>
                                        </con3:insert>
                                    </con3:actions>
                                </con3:case>
                            </con1:ifThenElse>
                            <con4:report xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                                <con1:id>_ActionId-a1e030f.77e03d19.c.1584a3eb66a.N7fe4</con1:id>
                                <con4:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$updateClienteReq</con:xqueryText>
                                </con4:expr>
                                <con4:labels>
                                    <con4:key>CRM UpdateCliente Req</con4:key>
                                    <con4:varName>body</con4:varName>
                                    <con4:value>
                                        <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmp1:updateClienteRequest/nmp1:idCliente</con:xpathText>
                                    </con4:value>
                                </con4:labels>
                            </con4:report>
                        </con3:requestTransform>
                        <con3:responseTransform/>
                    </con3:wsCallout>
                </con:actions>
            </con:stage>
        </con2:pipeline>
        <con2:pipeline type="request" name="request-af004c8.22fe03f8.0.151b1078e26.N8000">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N7b5f" name="StageValidacion">
                <con2:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="nmpH" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con2:context>
                <con2:disabled>true</con2:disabled>
                <con2:actions>
                    <con2:ifThenElse xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:comment>If Then: componente que ayuda a validar el header comun para NMP : id, idConsumidor, idDestino</con1:comment>
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7b5e</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N7b5d">
                            <con2:condition>
                                <con1:xqueryText>$header/nmpH:headerMessage</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:validate>
                                    <con1:comment>valida el headerMessage de los XSD comunes de NMP</con1:comment>
                                    <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7b5c</con1:id>
                                    <con2:schema ref="Common/XSD/NMPStandardHeader"/>
                                    <con2:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con2:schemaElement>
                                    <con2:varName>header</con2:varName>
                                    <con2:location>
                                        <con1:xpathText>./nmpH:headerMessage</con1:xpathText>
                                    </con2:location>
                                    <con2:resultVarName/>
                                </con2:validate>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:comment>Propaga un error NMP-008  = Hacen falta datos en el header</con1:comment>
                                <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7b5b</con1:id>
                                <con2:errCode>NMP-008</con2:errCode>
                                <con2:message>Hacen falta datos del encabezado. Favor de intentarlo nuevamente</con2:message>
                            </con2:Error>
                        </con2:default>
                    </con2:ifThenElse>
                    <con:validate xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7b5a</con1:id>
                        <con3:schema ref="GestionClientes/Clientes/Resources/Schemas/NMPClientesSvcElementosXSD"/>
                        <con3:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">nmp:validarClienteRequest</con3:schemaElement>
                        <con:varName>body</con:varName>
                        <con:location>
                            <con1:xpathText>./nmp:validarClienteRequest</con1:xpathText>
                        </con:location>
                    </con:validate>
                    <con:assign varName="header_tmp" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7b59</con1:id>
                        <con:expr>
                            <con1:xqueryText>$header</con1:xqueryText>
                        </con:expr>
                    </con:assign>
                </con2:actions>
            </con2:stage>
            <con2:stage id="_StageId-af004c8.22fe03f8.0.151b1078e26.N7ffe" name="Request Stage" errorHandler="error-N5601d8a2.7c411741.0.1566b28cb14.N7956">
                <con2:context/>
                <con2:actions>
                    <con:wsCallout xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-af004c8.22fe03f8.0.151b1078e26.N7ff9</con1:id>
                        <con:service ref="GestionClientes/Clientes/Business Services/CRMClienteSvcBajaDispBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con:operation>ConfirmaAccesoPortal</con:operation>
                        <con:request>
                            <con:body wrapped="false">validarClienteReq</con:body>
                        </con:request>
                        <con:response>
                            <con:body wrapped="false">validarClienteRes</con:body>
                        </con:response>
                        <con:requestTransform>
                            <con:replace varName="validarClienteReq" contents-only="false">
                                <con1:id>_ActionId-af004c8.22fe03f8.0.151b1078e26.N7ff6</con1:id>
                                <con:expr>
                                    <con1:xsltTransform>
                                        <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrValidarClienteReqToCRMValidarActualizar"/>
                                        <con1:input>$body/*</con1:input>
                                    </con1:xsltTransform>
                                </con:expr>
                            </con:replace>
                        </con:requestTransform>
                        <con:responseTransform/>
                    </con:wsCallout>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline name="PipelinePairNodeUpdateCliente_response" type="response">
            <con:stage name="Response Stage" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="con" namespace="http://www.bea.com/wli/sb/context"/>
                    <con1:userNsDecl prefix="ns1" namespace="urn:mx.com.nmp.clientes"/>
                    <con1:userNsDecl prefix="suc" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal"/>
                    <con1:userNsDecl prefix="a" namespace="http://schemas.datacontract.org/2004/07/Nmp.Crm.BusinessEntity.DataContract"/>
                    <con1:userNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="NMPConsultaC" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:replace varName="header" contents-only="false" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fbf</con2:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">fn-bea:inlinedXML('&lt;soapenv:Header xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">&lt;/soapenv:Header>')</con:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con1:replace varName="body" contents-only="true" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                        <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-915052723653721046--7423156d.14e9d6487aa.-7fbe</con2:id>
                        <con1:location>
                            <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">.</con:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con3:xsltTransform xmlns:con3="http://www.bea.com/wli/sb/stages/config">
                                <con3:resource ref="GestionClientes/Clientes/Resources/Transformations/TrCRMActualizaInformacionClienteResToUpdateClienteRes"/>
                                <con3:input>$updateClienteRes</con3:input>
                            </con3:xsltTransform>
                        </con1:expr>
                    </con1:replace>
                </con:actions>
            </con:stage>
        </con2:pipeline>
        <con2:pipeline type="response" name="response-N5601d8a2.7c411741.0.1566b28cb14.N7b57"/>
        <con2:pipeline type="error" name="error-N5601d8a2.N14b41a90.0.15651c81563.N781d">
            <con2:stage id="_StageId-N5601d8a2.N14b41a90.0.15651c81563.N781c" name="StageErrorHandlerGetCliente">
                <con2:context/>
                <con2:actions>
                    <con:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ff5</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrClientesSvcFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>1</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con:replace>
                    <con:replace varName="header" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7f85</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrHeaderRequestToHeaderResponse"/>
                                <con1:input>$header_tmp/*</con1:input>
                                <con1:param name="codigoRespuesta">
                                    <con1:path>1001</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con:replace>
                    <con1:reply isError="true">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ff2</con1:id>
                    </con1:reply>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline type="response" name="response-N5601d8a2.N14b41a90.0.15651c81563.N78d4">
            <con2:stage id="_StageId-N5601d8a2.N14b41a90.0.15651c81563.N78d2" name="StageResponse">
                <con2:comment>Se uniran los resultados de cada llamada para generar la respuesta final del servicio</con2:comment>
                <con2:context/>
                <con2:actions>
                    <con:replace varName="body" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N77d4</con1:id>
                        <con:expr>
                            <con1:xqueryTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrGetClienteByIdResToGetClienteCampaniaByIdRes"/>
                                <con1:param name="getClienteByIdRes">
                                    <con1:path>$getClienteBodyRes</con1:path>
                                </con1:param>
                                <con1:param name="getClienteCampaniasRes">
                                    <con1:path>$getCampaniasClienteBodyRes</con1:path>
                                </con1:param>
                            </con1:xqueryTransform>
                        </con:expr>
                    </con:replace>
                    <con:replace varName="header" contents-only="true" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ff8</con1:id>
                        <con:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrHeaderRequestToHeaderResponse"/>
                                <con1:input>$header_tmp/*</con1:input>
                                <con1:param name="codigoRespuesta">
                                    <con1:path>0</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con:expr>
                    </con:replace>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con2:pipeline name="PipelinePairNodeGetClientesByNumCredencial_request" type="request">
            <con2:stage id="_StageId-N5601d8a2.7c411741.0.1566b28cb14.N7d6c" name="StageValidacion">
                <con2:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="nmpH" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con2:context>
                <con2:actions>
                    <con2:ifThenElse xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:comment>If Then: componente que ayuda a validar el header comun para NMP : id, idConsumidor, idDestino</con1:comment>
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7d6b</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N7d6a">
                            <con2:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$header/nmpH:headerMessage/nmpH:idConsumidor</con:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:validate>
                                    <con1:comment>valida el headerMessage de los XSD comunes de NMP</con1:comment>
                                    <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7d69</con1:id>
                                    <con1:disabled>true</con1:disabled>
                                    <con2:schema ref="Common/XSD/NMPStandardHeader"/>
                                    <con2:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con2:schemaElement>
                                    <con2:varName>header</con2:varName>
                                    <con2:location>
                                        <con1:xpathText>./nmpH:headerMessage</con1:xpathText>
                                    </con2:location>
                                    <con2:resultVarName/>
                                </con2:validate>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:comment>Propaga un error NMP-008  = Hacen falta datos en el header</con1:comment>
                                <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7d68</con1:id>
                                <con1:disabled>true</con1:disabled>
                                <con2:errCode>NMP-008</con2:errCode>
                                <con2:message>Hacen falta datos del encabezado. Favor de intentarlo nuevamente</con2:message>
                            </con2:Error>
                            <con2:assign varName="header">
                                <con1:id>_ActionId-a1e030f.24c85e56.10.1576d1151f0.N7ffb</con1:id>
                                <con2:expr>
                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config"><![CDATA[<soap:Header   xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
        <nmph:headerMessage xmlns:nmph="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
            <nmph:usuario>NMP</nmph:usuario>
            <nmph:idConsumidor>0</nmph:idConsumidor>
            <nmph:idDestino>CRM</nmph:idDestino>
        </nmph:headerMessage>
</soap:Header>]]></con:xqueryText>
                                </con2:expr>
                            </con2:assign>
                        </con2:default>
                    </con2:ifThenElse>
                    <con:validate xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7d67</con1:id>
                        <con3:schema ref="GestionClientes/Clientes/Resources/Schemas/NMPClientesSvcElementosXSD"/>
                        <con3:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">nmp:getClientesByNumCredencialRequest</con3:schemaElement>
                        <con:varName>body</con:varName>
                        <con:location>
                            <con1:xpathText>./nmp:getClientesByNumCredencialRequest</con1:xpathText>
                        </con:location>
                        <con3:resultVarName/>
                    </con:validate>
                    <con:assign varName="header_tmp" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7d66</con1:id>
                        <con:expr>
                            <con1:xqueryText>$header</con1:xqueryText>
                        </con:expr>
                    </con:assign>
                </con2:actions>
            </con2:stage>
            <con:stage name="Request Stage" errorHandler="error-N5601d8a2.7c411741.0.1566b28cb14.N76da" xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
                <con:comment/>
                <con:context>
                    <con1:userNsDecl prefix="nmp2" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal"/>
                    <con1:userNsDecl prefix="tem" namespace="http://tempuri.org/"/>
                    <con1:userNsDecl prefix="urn" namespace="urn:sap-com:document:sap:soap:functions:mc-style"/>
                    <con1:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:varNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con3:assign varName="BS" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-a1e030f.26a809d1.a.15353414e2c.N8000</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">dvm:lookupValue('GestionClientes/Clientes/Resources/DVM/settingsServicioClientes', 'Value',$header/nmp:headerMessage/nmp:idConsumidor/text(),'Attribute1', '0',('Parameter','ServicioCRM'))</con:xqueryText>
                        </con3:expr>
                    </con3:assign>
                    <con3:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:comment>BS =2 Se invoca el BS CrmServicioClientesBS
BS =1 Se invoca el BS RhinoServiceBS</con1:comment>
                        <con1:id>_ActionId-af00456.78c830e0.0.151c5c6a05a.N7fc8</con1:id>
                        <con3:case id="_BranchId-af00456.78c830e0.0.151c5c6a05a.N7fc7">
                            <con3:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$BS = '2'</con:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con3:wsCallout>
                                    <con1:id>_ActionId-af00456.78c830e0.0.151c5c6a05a.N7fc2</con1:id>
                                    <con3:service ref="GestionClientes/Clientes/Business Services/CRMClienteSvcBajaDispBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con3:operation>GetClienteByNMPCredential</con3:operation>
                                    <con3:request>
                                        <con3:body wrapped="false">getClienteByNumCredReq</con3:body>
                                        <con3:header/>
                                    </con3:request>
                                    <con3:response>
                                        <con3:body wrapped="false">getClienteByNMPCredentialRes</con3:body>
                                        <con3:header/>
                                    </con3:response>
                                    <con3:requestTransform>
                                        <con1:assign varName="getClienteByNumCredReq" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                            <con4:id xmlns:con4="http://www.bea.com/wli/sb/stages/config">_ActionId-af00456.78c830e0.0.151c5c6a05a.N7f8f</con4:id>
                                            <con1:expr>
                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">&lt;tem:GetClienteByNMPCredential xmlns:tem='http://tempuri.org/'>
    &lt;tem:NoCredencial>{$body/nmp1:getClientesByNumCredencialRequest/nmp1:numCredencial/text()}&lt;/tem:NoCredencial>
&lt;/tem:GetClienteByNMPCredential></con4:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="fuenteDatosCRM" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7ddd</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>dvm:lookup("Common/DVM/NMPFuenteDatosCRM", "idDestinoOSB",$header/nmp:headerMessage/nmp:idDestino, "fuenteDatosCRM", "null")</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:ifThenElse xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7ddf</con2:id>
                                            <con3:case id="_BranchId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dde">
                                                <con3:condition>
                                                    <con2:xqueryText>$fuenteDatosCRM!='null'</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:insert varName="getClienteByNumCredReq">
                                                        <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7ddc</con2:id>
                                                        <con3:location>
                                                            <con2:xpathText>./tem:NoCredencial</con2:xpathText>
                                                        </con3:location>
                                                        <con3:where>after</con3:where>
                                                        <con3:expr>
                                                            <con2:xqueryText>&lt;tem:FuenteDato>{$fuenteDatosCRM}&lt;/tem:FuenteDato></con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:insert>
                                                </con3:actions>
                                            </con3:case>
                                        </con1:ifThenElse>
                                        <con4:report xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                                            <con1:id>_ActionId-a1e030f.77e03d19.7.1583fe61b60.N8000</con1:id>
                                            <con4:expr>
                                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteByNumCredReq</con:xqueryText>
                                            </con4:expr>
                                            <con4:labels>
                                                <con4:key>idDestino</con4:key>
                                                <con4:varName>header</con4:varName>
                                                <con4:value>
                                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmph:headerMessage/nmph:idDestino</con:xpathText>
                                                </con4:value>
                                            </con4:labels>
                                        </con4:report>
                                    </con3:requestTransform>
                                    <con3:responseTransform/>
                                </con3:wsCallout>
                            </con3:actions>
                        </con3:case>
                        <con3:case>
                            <con3:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$BS = '1'</con:xqueryText>
                            </con3:condition>
                            <con3:actions>
                                <con1:wsCallout xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config">
                                    <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a1e030f.26a809d1.c.15353428f43.N8000</con2:id>
                                    <con1:service ref="GestionClientes/Clientes/Business Services/CRMClienteSvcAltaDispBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>GetClienteByNMPCredential</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">getClienteByNMPCredentialReq</con1:body>
                                        <con1:header/>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">getClienteByNMPCredentialRes</con1:body>
                                        <con1:header/>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="getClienteByNMPCredentialReq">
                                            <con2:id xmlns:con2="http://www.bea.com/wli/sb/stages/config">_ActionId-a1e030f.26a809d1.c.15353428f43.N7fff</con2:id>
                                            <con1:expr>
                                                <con4:xqueryText xmlns:con4="http://www.bea.com/wli/sb/stages/config">&lt;nmp2:GetClienteByNMPCredential xmlns:nmp2='http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSucursal'>
         &lt;nmp2:NoCredencial>{$body/nmp1:getClientesByNumCredencialRequest/nmp1:numCredencial/text()}&lt;/nmp2:NoCredencial>
&lt;/nmp2:GetClienteByNMPCredential></con4:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="fuenteDatosCRM" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dcf</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>dvm:lookup("Common/DVM/NMPFuenteDatosCRM", "idDestinoOSB",$header/nmp:headerMessage/nmp:idDestino, "fuenteDatosCRM", "null")</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:ifThenElse xmlns:con2="http://www.bea.com/wli/sb/stages/config">
                                            <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dd1</con2:id>
                                            <con3:case id="_BranchId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dd0">
                                                <con3:condition>
                                                    <con2:xqueryText>$fuenteDatosCRM!='null'</con2:xqueryText>
                                                </con3:condition>
                                                <con3:actions>
                                                    <con3:insert varName="getClienteByNMPCredentialReq">
                                                        <con2:id>_ActionId-N3f57c7ff.7e2ca8a7.0.158214a54e5.N7dce</con2:id>
                                                        <con3:location>
                                                            <con2:xpathText>./nmp2:NoCredencial</con2:xpathText>
                                                        </con3:location>
                                                        <con3:where>after</con3:where>
                                                        <con3:expr>
                                                            <con2:xqueryText>&lt;nmp2:FuenteDato>{$fuenteDatosCRM}&lt;/nmp2:FuenteDato></con2:xqueryText>
                                                        </con3:expr>
                                                    </con3:insert>
                                                </con3:actions>
                                            </con3:case>
                                        </con1:ifThenElse>
                                        <con4:report xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/routing/config" xmlns:con4="http://www.bea.com/wli/sb/stages/logging/config">
                                            <con1:id>_ActionId-a1e030f.77e03d19.8.1583fe6843c.N8000</con1:id>
                                            <con4:expr>
                                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$getClienteByNumCredReq</con:xqueryText>
                                            </con4:expr>
                                            <con4:labels>
                                                <con4:key>idDestino</con4:key>
                                                <con4:varName>header</con4:varName>
                                                <con4:value>
                                                    <con:xpathText xmlns:con="http://www.bea.com/wli/sb/stages/config">./nmph:headerMessage/nmph:idDestino</con:xpathText>
                                                </con4:value>
                                            </con4:labels>
                                        </con4:report>
                                    </con1:requestTransform>
                                    <con1:responseTransform/>
                                </con1:wsCallout>
                            </con3:actions>
                        </con3:case>
                    </con3:ifThenElse>
                </con:actions>
            </con:stage>
        </con2:pipeline>
        <con2:pipeline type="request" name="request-N5601d8a2.N14b41a90.0.15651c81563.N78d5">
            <con2:stage id="_StageId-N5601d8a2.N14b41a90.0.15651c81563.N78d3" name="StageValidacion">
                <con2:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="nmpH" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con2:context>
                <con2:actions>
                    <con2:ifThenElse xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:con4="http://www.bea.com/wli/sb/stages/publish/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
                        <con1:comment>If Then: componente que ayuda a validar el header comun para NMP : id, idConsumidor, idDestino</con1:comment>
                        <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7862</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.N14b41a90.0.15651c81563.N7861">
                            <con2:condition>
                                <con1:xqueryText>$header/nmpH:headerMessage</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:validate>
                                    <con1:comment>valida el headerMessage de los XSD comunes de NMP</con1:comment>
                                    <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7860</con1:id>
                                    <con2:schema ref="Common/XSD/NMPStandardHeader"/>
                                    <con2:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con2:schemaElement>
                                    <con2:varName>header</con2:varName>
                                    <con2:location>
                                        <con1:xpathText>./nmpH:headerMessage</con1:xpathText>
                                    </con2:location>
                                    <con2:resultVarName/>
                                </con2:validate>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:comment>Propaga un error NMP-008  = Hacen falta datos en el header</con1:comment>
                                <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N785f</con1:id>
                                <con2:errCode>NMP-020</con2:errCode>
                                <con2:message>Hacen falta datos del encabezado. Favor de intentarlo nuevamente</con2:message>
                            </con2:Error>
                        </con2:default>
                    </con2:ifThenElse>
                    <con:validate xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N785c</con1:id>
                        <con:schema ref="GestionClientes/Clientes/Resources/Schemas/NMPClientesSvcElementosXSD"/>
                        <con:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">nmp:getClienteCampaniasByIdRequest</con:schemaElement>
                        <con:varName>body</con:varName>
                        <con:location>
                            <con1:xpathText>./nmp:getClienteCampaniasByIdRequest</con1:xpathText>
                        </con:location>
                    </con:validate>
                    <con:assign varName="header_tmp" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7855</con1:id>
                        <con:expr>
                            <con1:xqueryText>$header</con1:xqueryText>
                        </con:expr>
                    </con:assign>
                </con2:actions>
            </con2:stage>
            <con2:stage id="_StageId-N5601d8a2.N14b41a90.0.15651c81563.N785b" name="StageInvocarGetCliente" errorHandler="error-N5601d8a2.N14b41a90.0.15651c81563.N781d">
                <con2:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con2:context>
                <con2:actions>
                    <con:ifThenElse xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7f49</con1:id>
                        <con:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N7f48">
                            <con:condition>
                                <con1:xqueryText>fn:string-length($body/nmp:getClienteCampaniasByIdRequest/nmp:idCliente) > 0</con1:xqueryText>
                            </con:condition>
                            <con:actions>
                                <con:wsCallout>
                                    <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7858</con1:id>
                                    <con:service ref="GestionClientes/Clientes/Pipelines/NMPClientesPL" xsi:type="con2:PipelineRef"/>
                                    <con:operation>getClientesByID</con:operation>
                                    <con:request>
                                        <con:body wrapped="false">getClienteByIdBodyReq</con:body>
                                        <con:header>getClienteByIdHeaderReq</con:header>
                                    </con:request>
                                    <con:response>
                                        <con:body wrapped="false">getClienteBodyRes</con:body>
                                        <con:header>getClienteByIdHeaderRes</con:header>
                                    </con:response>
                                    <con:requestTransform>
                                        <con:assign varName="getClienteByIdHeaderReq">
                                            <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N784f</con1:id>
                                            <con:expr>
                                                <con1:xqueryText>$header_tmp</con1:xqueryText>
                                            </con:expr>
                                        </con:assign>
                                        <con:assign varName="getClienteByIdBodyReq">
                                            <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7852</con1:id>
                                            <con:expr>
                                                <con1:xsltTransform>
                                                    <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrGetClienteCampaniasByIdReqToGetClienteByIdReq"/>
                                                    <con1:input>$body/nmp:getClienteCampaniasByIdRequest</con1:input>
                                                </con1:xsltTransform>
                                            </con:expr>
                                        </con:assign>
                                    </con:requestTransform>
                                    <con:responseTransform/>
                                </con:wsCallout>
                            </con:actions>
                        </con:case>
                        <con:case id="_BranchId-N5601d8a2.7c411741.0.1566b28cb14.N7f43">
                            <con:condition>
                                <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">string-length($body/nmp:getClienteCampaniasByIdRequest/nmp:numCredencial) > 0</con:xqueryText>
                            </con:condition>
                            <con:actions>
                                <con:wsCallout>
                                    <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ed8</con1:id>
                                    <con:service ref="GestionClientes/Clientes/Pipelines/NMPClientesPL" xsi:type="con2:PipelineRef"/>
                                    <con:operation>getClientesByNumCredencial</con:operation>
                                    <con:request>
                                        <con:body wrapped="false">getClienteByNumCredBodyReq</con:body>
                                        <con:header>getClienteByNumCredHeaderReq</con:header>
                                    </con:request>
                                    <con:response>
                                        <con:body wrapped="false">getClienteBodyRes</con:body>
                                        <con:header>getClienteByNumCredHeaderRes</con:header>
                                    </con:response>
                                    <con:requestTransform>
                                        <con:assign varName="getClienteByNumCredHeaderReq">
                                            <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ed7</con1:id>
                                            <con:expr>
                                                <con1:xqueryText>$header_tmp</con1:xqueryText>
                                            </con:expr>
                                        </con:assign>
                                        <con:assign varName="getClienteByNumCredBodyReq">
                                            <con1:id>_ActionId-N5601d8a2.7c411741.0.1566b28cb14.N7ed6</con1:id>
                                            <con:expr>
                                                <con1:xsltTransform>
                                                    <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrGetClienteCampaniasByNumReqToGetclienteByNumReq"/>
                                                    <con1:input>$body/nmp:getClienteCampaniasByIdRequest</con1:input>
                                                </con1:xsltTransform>
                                            </con:expr>
                                        </con:assign>
                                    </con:requestTransform>
                                    <con:responseTransform/>
                                </con:wsCallout>
                            </con:actions>
                        </con:case>
                        <con:default/>
                    </con:ifThenElse>
                </con2:actions>
            </con2:stage>
            <con2:stage id="_StageId-N5601d8a2.N14b41a90.0.15651c81563.N781b" name="StageInvocarGetCampanias" errorHandler="error-N5601d8a2.N14b41a90.0.15651c81563.N77df">
                <con2:context/>
                <con2:actions>
                    <con:wsCallout xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                        <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7818</con1:id>
                        <con:service ref="FuerzaDeVentas/Campanias/Prendario/Proxy Services/NMPCampaniasPrendarioSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con3:operation>getCampaniasCliente</con3:operation>
                        <con:request>
                            <con3:body wrapped="false">getCampaniasClienteBodyReq</con3:body>
                            <con3:header>getCampaniasClienteHeaderReq</con3:header>
                        </con:request>
                        <con:response>
                            <con3:body wrapped="false">getCampaniasClienteBodyRes</con3:body>
                            <con3:header>getCampaniasClienteHeaderRes</con3:header>
                        </con:response>
                        <con:requestTransform>
                            <con:assign varName="getCampaniasClienteHeaderReq">
                                <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7812</con1:id>
                                <con:expr>
                                    <con1:xqueryText>$header_tmp</con1:xqueryText>
                                </con:expr>
                            </con:assign>
                            <con:assign varName="getCampaniasClienteBodyReq">
                                <con1:id>_ActionId-N5601d8a2.N14b41a90.0.15651c81563.N7815</con1:id>
                                <con:expr>
                                    <con1:xsltTransform>
                                        <con1:resource ref="GestionClientes/Clientes/Resources/Transformations/TrGetClienteCampaniasByIdReqToGetCampaniasClienteReq"/>
                                        <con1:input>$body/*</con1:input>
                                    </con1:xsltTransform>
                                </con:expr>
                            </con:assign>
                        </con:requestTransform>
                        <con:responseTransform/>
                    </con:wsCallout>
                </con2:actions>
            </con2:stage>
        </con2:pipeline>
        <con:flow xmlns:con="http://www.bea.com/wli/sb/pipeline/config">
            <con:branch-node type="operation" name="BranchNodeClientesOperaciones">
                <con:branch-table>
                    <con:branch name="getClientesByID">
                        <con:operator>equals</con:operator>
                        <con:value>getClientesByID</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairNodeGetClientesByID">
                                <con:comment/>
                                <con:request>PipelinePairNodeGetClientesByID_request</con:request>
                                <con:response>PipelinePairNodeGetClientesByID_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getClientesByNumCredencial">
                        <con:operator>equals</con:operator>
                        <con:value>getClientesByNumCredencial</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairNodeGetClientesByNumCredencial">
                                <con:comment/>
                                <con:request>PipelinePairNodeGetClientesByNumCredencial_request</con:request>
                                <con:response>PipelinePairNodeGetClientesByNumCredencial_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getHuellaCliente">
                        <con:operator>equals</con:operator>
                        <con:value>getHuellaCliente</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairNodeGetHuellaCliente">
                                <con:comment/>
                                <con:request>PipelinePairNodeGetHuellaCliente_request</con:request>
                                <con:response>PipelinePairNodeGetHuellaCliente_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="updateCliente">
                        <con:operator>equals</con:operator>
                        <con:value>updateCliente</con:value>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairNodeUpdateCliente">
                                <con:comment/>
                                <con:request>PipelinePairNodeUpdateCliente_request</con:request>
                                <con:response>PipelinePairNodeUpdateCliente_response</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="validarCliente">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairValidarCliente">
                                <con:request>request-af004c8.22fe03f8.0.151b1078e26.N8000</con:request>
                                <con:response>response-af004c8.22fe03f8.0.151b1078e26.N7fff</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getClienteCampaniasById">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePar_GetClienteCampaniasById">
                                <con:request>request-N5601d8a2.N14b41a90.0.15651c81563.N78d5</con:request>
                                <con:response>response-N5601d8a2.N14b41a90.0.15651c81563.N78d4</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairDefault">
                                <con:request>request-N5601d8a2.7c411741.0.1566b28cb14.N7b58</con:request>
                                <con:response>response-N5601d8a2.7c411741.0.1566b28cb14.N7b57</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con2:router>
    <aler:alertRules xsi:nil="true" xmlns:aler="http://xmlns.oracle.com/servicebus/monitoring/alert"/>
</con:pipelineEntry>