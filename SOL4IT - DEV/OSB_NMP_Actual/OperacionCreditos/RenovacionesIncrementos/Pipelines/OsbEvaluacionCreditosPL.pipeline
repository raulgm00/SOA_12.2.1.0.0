<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/stages/config" xmlns:con2="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="OperacionCreditos/RenovacionesIncrementos/Resources/WSDLs/OSBRenovacionCreditosWSDL"/>
            <con:binding>
                <con:name>evaluacionCredito_pttSOAP11Binding</con:name>
                <con:namespace>http://servicios.montedepiedad.com.mx/NMP/Services/Osb/EvaluacionCredito</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
            <oper:tracingEnabled>true</oper:tracingEnabled>
            <oper:monitoring enabled="true" level="service" aggregationInterval="10"/>
        </oper:operations>
        <con:xqConfiguration>
            <con:snippetVersion>1.0</con:snippetVersion>
        </con:xqConfiguration>
    </con:coreEntry>
    <con:router errorHandler="error-N53efffe1.N727c6ccd.0.15156e80bbd.N7f98">
        <con:pipeline type="response" name="response-N53effff2.N68cbfab3.0.1514c233dac.N7ffa">
            <con:stage id="_StageId-N53effff2.N3d0d4b1c.0.1514c88e5f6.N7ff9" name="StageResponse">
                <con:context>
                    <con1:userNsDecl prefix="ns0" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7d08</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.6a67e5b2.0.155c7742702.N7d07">
                            <con2:condition>
                                <con1:xqueryText>$header_res</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:assign varName="header">
                                    <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7ccd</con1:id>
                                    <con2:expr>
                                        <con1:xqueryText>$header_res</con1:xqueryText>
                                    </con2:expr>
                                </con2:assign>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:replace varName="header" contents-only="true">
                                <con1:id>_ActionId-N3f57c7ff.6d92291a.0.151b6bc74a1.N7ffe</con1:id>
                                <con2:location>
                                    <con1:xpathText>.</con1:xpathText>
                                </con2:location>
                                <con2:expr>
                                    <con1:xqueryText><![CDATA[fn-bea:inlinedXML(concat(' <ns0:headerMessageResponse xmlns:ns0="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
         <ns0:usuario>',$header_tmp//ns0:usuario/text(),'</ns0:usuario>
         <ns0:idConsumidor>',$header_tmp//ns0:idConsumidor/text(),'</ns0:idConsumidor>
         <ns0:idDestino>',$header_tmp//ns0:idDestino/text(),'</ns0:idDestino>
         <ns0:codigoRespuesta>0</ns0:codigoRespuesta>
         <ns0:descripcionRespuesta>Success</ns0:descripcionRespuesta>
      </ns0:headerMessageResponse>
'))]]></con1:xqueryText>
                                </con2:expr>
                            </con2:replace>
                        </con2:default>
                    </con2:ifThenElse>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-N53efffe1.N727c6ccd.0.15156e80bbd.N7ffe</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[fn-bea:inlinedXML(fn:string('<eval:processCreditoResponse xmlns:eval="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito">
         <eval:codigoResultado>true</eval:codigoResultado>
         <eval:descripcionResultado>Success</eval:descripcionResultado>
      </eval:processCreditoResponse>'))]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53effff2.N68cbfab3.0.1514c233dac.N7fb9" name="StageOutputReport">
                <con:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPPersona"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con3:report>
                        <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fb7</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/eval:processCreditoResponse</con:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>clienteId_response</con3:key>
                            <con3:varName>body_tmp</con3:varName>
                            <con3:value>
                                <con1:xpathText>./eval:processCreditoRequest/eval:cliente/nmp1:id/text()</con1:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.56359bc7.0.1515a807d29.N7f49">
            <con:stage id="_StageId-N3f57c7ff.56359bc7.0.1515a807d29.N7e8e" name="StageCallOutCrmError">
                <con:context>
                    <con1:userNsDecl prefix="ns0" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="a" namespace="http://schemas.datacontract.org/2004/07/NMP.MRT.Services.DataContracts"/>
                    <con1:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                </con:context>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7dad</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformOsbProcessRenovacionFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>2</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-N3f57c7ff.6d92291a.0.151b6bc74a1.N7f8e</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[fn-bea:inlinedXML(concat(' <ns0:headerMessageResponse xmlns:ns0="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
         <ns0:usuario>',$header_tmp//ns0:usuario/text(),'</ns0:usuario>
         <ns0:idConsumidor>',$header_tmp//ns0:idConsumidor/text(),'</ns0:idConsumidor>
         <ns0:idDestino>',$header_tmp//ns0:idDestino/text(),'</ns0:idDestino>
         <ns0:codigoRespuesta>1</ns0:codigoRespuesta>
         <ns0:descripcionRespuesta>Error</ns0:descripcionRespuesta>
      </ns0:headerMessageResponse>
'))]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con3:report>
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7e8a</con1:id>
                        <con3:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>clienteId_errorHandler</con3:key>
                            <con3:varName>body_tmp</con3:varName>
                            <con3:value>
                                <con1:xpathText>./eval:processCreditoRequest/eval:cliente/nmp:id/text()</con1:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                    <con1:reply isError="true">
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7e89</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.56359bc7.0.1515a807d29.N8000">
            <con:stage id="_StageId-N3f57c7ff.56359bc7.0.1515a807d29.N7fff" name="StageCallOutBrmError">
                <con:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="ns0" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con:context>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7db0</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformOsbProcessRenovacionFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>1</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-N3f57c7ff.6d92291a.0.151b6bc74a1.N7f28</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[fn-bea:inlinedXML(concat(' <ns0:headerMessageResponse xmlns:ns0="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
         <ns0:usuario>',$header_tmp//ns0:usuario/text(),'</ns0:usuario>
         <ns0:idConsumidor>',$header_tmp//ns0:idConsumidor/text(),'</ns0:idConsumidor>
         <ns0:idDestino>',$header_tmp//ns0:idDestino/text(),'</ns0:idDestino>
         <ns0:codigoRespuesta>1</ns0:codigoRespuesta>
         <ns0:descripcionRespuesta>Error</ns0:descripcionRespuesta>
      </ns0:headerMessageResponse>
'))]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con3:report>
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7f06</con1:id>
                        <con3:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>clienteId_errorHandler</con3:key>
                            <con3:varName>body_tmp</con3:varName>
                            <con3:value>
                                <con1:xpathText>./eval:processCreditoRequest/eval:cliente/nmp:id/text()</con1:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                    <con1:reply isError="true">
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7ff9</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N53efffe1.N727c6ccd.0.15156e80bbd.N7f98">
            <con:stage id="_StageId-N53efffe1.N727c6ccd.0.15156e80bbd.N7f97" name="StageServiceError">
                <con:context>
                    <con1:userNsDecl prefix="ns0" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPPersona"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-N3f57c7ff.39d8b79d.0.15159b2d1d9.N7ffa</con1:id>
                        <con2:case id="_BranchId-N3f57c7ff.39d8b79d.0.15159b2d1d9.N7ff9">
                            <con2:condition>
                                <con1:xqueryText>fn:not($body/soap-env:Fault)</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:replace varName="body" contents-only="true">
                                    <con1:id>_ActionId-N3f57c7ff.39d8b79d.0.15159b2d1d9.N7ff6</con1:id>
                                    <con2:location>
                                        <con1:xpathText>.</con1:xpathText>
                                    </con2:location>
                                    <con2:expr>
                                        <con1:xsltTransform>
                                            <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformOsbProcessRenovacionFault"/>
                                            <con1:input>$fault</con1:input>
                                            <con1:param name="app">
                                                <con1:path>0</con1:path>
                                            </con1:param>
                                        </con1:xsltTransform>
                                    </con2:expr>
                                </con2:replace>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                    <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-N3f57c7ff.6d92291a.0.151b6bc74a1.N7fc3</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[fn-bea:inlinedXML(concat(' <ns0:headerMessageResponse xmlns:ns0="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
         <ns0:usuario>',$header_tmp//ns0:usuario/text(),'</ns0:usuario>
         <ns0:idConsumidor>',$header_tmp//ns0:idConsumidor/text(),'</ns0:idConsumidor>
         <ns0:idDestino>',$header_tmp//ns0:idDestino/text(),'</ns0:idDestino>
         <ns0:codigoRespuesta>1</ns0:codigoRespuesta>
         <ns0:descripcionRespuesta>Error</ns0:descripcionRespuesta>
      </ns0:headerMessageResponse>
'))]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con3:report>
                        <con1:id>_ActionId-N53efffe1.N727c6ccd.0.15156e80bbd.N7f4f</con1:id>
                        <con3:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>clienteId_errorHandler</con3:key>
                            <con3:varName>body_tmp</con3:varName>
                            <con3:value>
                                <con1:xpathText>./eval:processCreditoRequest/eval:cliente/nmp1:id/text()</con1:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                    <con1:reply isError="true">
                        <con1:id>_ActionId-N53efffe1.N727c6ccd.0.15156e80bbd.N7f82</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.56359bc7.0.1515a807d29.N7e10">
            <con:stage id="_StageId-N3f57c7ff.56359bc7.0.1515a807d29.N7e0f" name="StageCallOutCrmError">
                <con:context>
                    <con1:userNsDecl prefix="ns0" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                </con:context>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7da7</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformOsbProcessRenovacionFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>4</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-N3f57c7ff.6d92291a.0.151b6bc74a1.N7ef6</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[fn-bea:inlinedXML(concat(' <ns0:headerMessageResponse xmlns:ns0="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
         <ns0:usuario>',$header_tmp//ns0:usuario/text(),'</ns0:usuario>
         <ns0:idConsumidor>',$header_tmp//ns0:idConsumidor/text(),'</ns0:idConsumidor>
         <ns0:idDestino>',$header_tmp//ns0:idDestino/text(),'</ns0:idDestino>
         <ns0:codigoRespuesta>1</ns0:codigoRespuesta>
         <ns0:descripcionRespuesta>Error</ns0:descripcionRespuesta>
      </ns0:headerMessageResponse>
'))]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con3:report>
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7e0b</con1:id>
                        <con3:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>clienteId_errorHandler</con3:key>
                            <con3:varName>body_tmp</con3:varName>
                            <con3:value>
                                <con1:xpathText>./eval:processCreditoRequest/eval:cliente/nmp:id/text()</con1:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                    <con1:reply isError="true">
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7e0a</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N53efffe1.N727c6ccd.0.15156e80bbd.N7fcd">
            <con:stage id="_StageId-N3f57c7ff.56359bc7.0.1515a807d29.N7f4e" name="StageCallOutBrmError">
                <con:context>
                    <con1:userNsDecl prefix="ns0" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                </con:context>
                <con:actions>
                    <con2:replace varName="body" contents-only="true">
                        <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7daa</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xsltTransform>
                                <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformOsbProcessRenovacionFault"/>
                                <con1:input>$fault</con1:input>
                                <con1:param name="app">
                                    <con1:path>3</con1:path>
                                </con1:param>
                            </con1:xsltTransform>
                        </con2:expr>
                    </con2:replace>
                    <con2:replace varName="header" contents-only="true">
                        <con1:id>_ActionId-N3f57c7ff.6d92291a.0.151b6bc74a1.N7f5c</con1:id>
                        <con2:location>
                            <con1:xpathText>.</con1:xpathText>
                        </con2:location>
                        <con2:expr>
                            <con1:xqueryText><![CDATA[fn-bea:inlinedXML(concat(' <ns0:headerMessageResponse xmlns:ns0="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
         <ns0:usuario>',$header_tmp//ns0:usuario/text(),'</ns0:usuario>
         <ns0:idConsumidor>',$header_tmp//ns0:idConsumidor/text(),'</ns0:idConsumidor>
         <ns0:idDestino>',$header_tmp//ns0:idDestino/text(),'</ns0:idDestino>
         <ns0:codigoRespuesta>1</ns0:codigoRespuesta>
         <ns0:descripcionRespuesta>Error</ns0:descripcionRespuesta>
      </ns0:headerMessageResponse>
'))]]></con1:xqueryText>
                        </con2:expr>
                    </con2:replace>
                    <con3:report>
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7f02</con1:id>
                        <con3:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>clienteId_errorHandler</con3:key>
                            <con3:varName>body_tmp</con3:varName>
                            <con3:value>
                                <con1:xpathText>./eval:processCreditoRequest/eval:cliente/nmp:id/text()</con1:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                    <con1:reply isError="true">
                        <con1:id>_ActionId-N3f57c7ff.56359bc7.0.1515a807d29.N7f4a</con1:id>
                    </con1:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N53effff2.N68cbfab3.0.1514c233dac.N7ffb">
            <con:stage id="_StageId-N53effff2.N68cbfab3.0.1514c233dac.N7ff9" name="StageInputReport">
                <con:context>
                    <con1:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPPersona"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="nmp1" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con1:userNsDecl prefix="nmp2" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCredito"/>
                </con:context>
                <con:actions>
                    <con2:assign varName="body_tmp">
                        <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fc5</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$body</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="header_tmp">
                        <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7f8d</con1:id>
                        <con2:expr>
                            <con1:xqueryText>$header</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="withOutCall">
                        <con1:id>_ActionId-N3f57c7ff.N296cbb00.0.151cbc2e0af.N7fbb</con1:id>
                        <con2:expr>
                            <con1:xqueryText>1</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con3:report>
                        <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fc2</con1:id>
                        <con3:expr>
                            <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$body/eval:processCreditoRequest/eval:credito</con:xqueryText>
                        </con3:expr>
                        <con3:labels>
                            <con3:key>clienteId_request</con3:key>
                            <con3:varName>body</con3:varName>
                            <con3:value>
                                <con1:xpathText>./eval:processCreditoRequest/eval:cliente/nmp1:id/text()</con1:xpathText>
                            </con3:value>
                        </con3:labels>
                    </con3:report>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53effff2.N68cbfab3.0.1514c233dac.N7fb6" name="StageValidacion">
                <con:context>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                </con:context>
                <con:actions>
                    <con2:assign varName="continuar">
                        <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7f08</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn:true()</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:assign varName="nodeRequest">
                        <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fb3</con1:id>
                        <con2:expr>
                            <con1:xqueryText>fn:local-name($body/*)</con1:xqueryText>
                        </con2:expr>
                    </con2:assign>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fac</con1:id>
                        <con2:case id="_BranchId-N53effff2.N68cbfab3.0.1514c233dac.N7fab">
                            <con2:condition>
                                <con1:xqueryText>$nodeRequest='processCreditoRequest'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:validate>
                                    <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fa8</con1:id>
                                    <con2:schema ref="OperacionCreditos/RenovacionesIncrementos/Resources/Schemas/OSBRenovacionCreditoElementosXSD"/>
                                    <con2:schemaElement xmlns:eval="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito">eval:processCreditoRequest</con2:schemaElement>
                                    <con2:varName>body</con2:varName>
                                    <con2:location>
                                        <con1:xpathText>./eval:processCreditoRequest</con1:xpathText>
                                    </con2:location>
                                </con2:validate>
                            </con2:actions>
                        </con2:case>
                        <con2:default>
                            <con2:Error>
                                <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fa5</con1:id>
                                <con2:errCode>NMP-008</con2:errCode>
                                <con2:message>Error aplicación - Error en los parámetros del mensaje</con2:message>
                            </con2:Error>
                        </con2:default>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53effff2.N68cbfab3.0.1514c233dac.N7fa4" name="StageInvokeBrmIsRenovacion" errorHandler="error-N3f57c7ff.56359bc7.0.1515a807d29.N8000">
                <con:comment>Se invoca la operacion IsRenovacionTopUp</con:comment>
                <con:context>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                    <con1:userNsDecl prefix="nmpHead" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con:context>
                <con:actions>
                    <con2:wsCallout>
                        <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7fa1</con1:id>
                        <con2:service ref="OperacionCreditos/RenovacionesIncrementos/Business Services/OBRReglaRenovacionTopUpBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con2:operation>isRenovacionTopUp</con2:operation>
                        <con2:request>
                            <con2:body wrapped="false">bodyBrmIsRenovacionTopUpRequest</con2:body>
                            <con2:header>header</con2:header>
                        </con2:request>
                        <con2:response>
                            <con2:body wrapped="false">bodyBrmIsRenovacionTopUpResponse</con2:body>
                            <con2:header>headerBrmIsRenovacionTopUpResponse</con2:header>
                        </con2:response>
                        <con2:requestTransform>
                            <con2:assign varName="bodyBrmIsRenovacionTopUpRequest">
                                <con1:id>_ActionId-N53effff2.N3d0d4b1c.0.1514c88e5f6.N7ffe</con1:id>
                                <con2:expr>
                                    <con1:xqueryTransform>
                                        <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformOsbInputToIsRenovacion"/>
                                        <con1:param name="request">
                                            <con1:path>$body/eval:processCreditoRequest</con1:path>
                                        </con1:param>
                                    </con1:xqueryTransform>
                                </con2:expr>
                            </con2:assign>
                        </con2:requestTransform>
                        <con2:responseTransform>
                            <con2:ifThenElse>
                                <con1:id>_ActionId-N3f57c7ff.N5209986d.0.1525fd428e8.N7fcc</con1:id>
                                <con2:case id="_BranchId-N3f57c7ff.N5209986d.0.1525fd428e8.N7fcb">
                                    <con2:condition>
                                        <con1:xqueryText>$headerBrmIsRenovacionTopUpResponse//nmpHead:codigoRespuesta/text()!=0</con1:xqueryText>
                                    </con2:condition>
                                    <con2:actions>
                                        <con2:assign varName="continuar">
                                            <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7ed5</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>fn:false()</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                        <con2:assign varName="header_res">
                                            <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7d42</con1:id>
                                            <con2:expr>
                                                <con1:xqueryText>$headerBrmIsRenovacionTopUpResponse</con1:xqueryText>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:actions>
                                </con2:case>
                                <con2:default/>
                            </con2:ifThenElse>
                        </con2:responseTransform>
                    </con2:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53effff2.N68cbfab3.0.1514c233dac.N7f94" name="StageInvokeCrmInfoOfertas" errorHandler="error-N3f57c7ff.56359bc7.0.1515a807d29.N7f49">
                <con:context>
                    <con1:userNsDecl prefix="a" namespace="http://schemas.datacontract.org/2004/07/NMP.MRT.Services.DataContracts"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-N5601d8a2.6a67e5b2.0.155c7742702.N7e6f</con1:id>
                        <con2:case id="_BranchId-N5601d8a2.6a67e5b2.0.155c7742702.N7e6e">
                            <con2:condition>
                                <con1:xqueryText>$continuar = 'true'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-N3f57c7ff.5d620151.0.1518d3d5b3b.N7ffe</con1:id>
                                    <con2:service ref="FuerzaDeVentas/GestionOrdenesTrabajo/Proxy Services/CRMServicioOrdenesPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>RecuperarUltimaLlamada</con2:operation>
                                    <con2:request>
                                        <con2:body wrapped="false">bodyCrmRecuperarUltimaLlamadaRequest</con2:body>
                                        <con2:header>header</con2:header>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body wrapped="false">bodyCrmRecuperarUltimaLlamadaResponse</con2:body>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="bodyCrmRecuperarUltimaLlamadaRequest">
                                            <con1:id>_ActionId-N3f57c7ff.5d620151.0.1518d3d5b3b.N7ffa</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformOsbInputToCrmUltimaLlamada"/>
                                                    <con1:param name="isRenovacion">
                                                        <con1:path>$bodyBrmIsRenovacionTopUpResponse</con1:path>
                                                    </con1:param>
                                                    <con1:param name="osbInput">
                                                        <con1:path>$body/*</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:ifThenElse>
                                            <con1:id>_ActionId-N3f57c7ff.5d620151.0.1518d3d5b3b.N7f65</con1:id>
                                            <con2:case id="_BranchId-N3f57c7ff.5d620151.0.1518d3d5b3b.N7f64">
                                                <con2:condition>
                                                    <con1:xqueryText>$bodyCrmRecuperarUltimaLlamadaResponse//a:Codigo/text() != 0 and $bodyCrmRecuperarUltimaLlamadaResponse//a:Codigo/text() != 1</con1:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                    <con2:Error>
                                                        <con1:id>_ActionId-N3f57c7ff.5d620151.0.1518d3d5b3b.N7f61</con1:id>
                                                        <con2:errCode>NMP-1001</con2:errCode>
                                                        <con2:message>Error al solicitar información de la gestión de la última llamada a CRM</con2:message>
                                                    </con2:Error>
                                                </con2:actions>
                                            </con2:case>
                                            <con2:case id="_BranchId-N5601d8a2.6a67e5b2.0.155c7742702.N7db7">
                                                <con2:condition>
                                                    <con1:xqueryText>$bodyCrmRecuperarUltimaLlamadaResponse//a:Codigo/text() = '1'</con1:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                    <con2:assign varName="withOutCall">
                                                        <con1:id>_ActionId-N3f57c7ff.N296cbb00.0.151cbc2e0af.N7fcb</con1:id>
                                                        <con2:expr>
                                                            <con1:xqueryText>0</con1:xqueryText>
                                                        </con2:expr>
                                                    </con2:assign>
                                                </con2:actions>
                                            </con2:case>
                                            <con2:default/>
                                        </con2:ifThenElse>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53effff2.N68cbfab3.0.1514c233dac.N7f93" name="StageInvokeBrmIsSolicitar" errorHandler="error-N53efffe1.N727c6ccd.0.15156e80bbd.N7fcd">
                <con:comment>se invoca la operación isSolicitarConsulta</con:comment>
                <con:context>
                    <con1:userNsDecl prefix="reg" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/ReglaRenovacionTopUp"/>
                    <con1:userNsDecl prefix="a" namespace="http://schemas.datacontract.org/2004/07/NMP.MRT.Services.DataContracts"/>
                    <con1:userNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-N3f57c7ff.N296cbb00.0.151cbc2e0af.N7fc1</con1:id>
                        <con2:case id="_BranchId-N3f57c7ff.N296cbb00.0.151cbc2e0af.N7fc0">
                            <con2:condition>
                                <con1:xqueryText>$continuar = 'true'</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-N53effff2.N68cbfab3.0.1514c233dac.N7f90</con1:id>
                                    <con2:service ref="OperacionCreditos/RenovacionesIncrementos/Business Services/OBRReglaRenovacionTopUpBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>isSolicitarCamp</con2:operation>
                                    <con2:request>
                                        <con2:body wrapped="false">bodyBrmIsSolicitarRequest</con2:body>
                                        <con2:header>header_tmp</con2:header>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body wrapped="false">bodyBrmIsSolicitarResponse</con2:body>
                                        <con2:header>headerBrmIsSolicitarResponse</con2:header>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="bodyBrmIsSolicitarRequest">
                                            <con1:id>_ActionId-N53effff2.N3d0d4b1c.0.1514c88e5f6.N7ffb</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformIsRenovacionToIsSolicitar"/>
                                                    <con1:param name="bodyRequest">
                                                        <con1:path>$body/eval:processCreditoRequest</con1:path>
                                                    </con1:param>
                                                    <con1:param name="brmResponse">
                                                        <con1:path>$bodyBrmIsRenovacionTopUpResponse</con1:path>
                                                    </con1:param>
                                                    <con1:param name="crmResponse">
                                                        <con1:path>$bodyCrmRecuperarUltimaLlamadaResponse</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform/>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N53efffe1.N727c6ccd.0.15156e80bbd.N7f96" name="StageCrmSolicitarCamp" errorHandler="error-N3f57c7ff.56359bc7.0.1515a807d29.N7e10">
                <con:context>
                    <con1:userNsDecl prefix="ns0" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/ReglaRenovacionTopUp"/>
                    <con1:userNsDecl prefix="a" namespace="http://schemas.datacontract.org/2004/07/Nmp.Crm.Servicios.DataContracts"/>
                    <con1:varNsDecl prefix="eval" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/EvaluacionCredito"/>
                </con:context>
                <con:actions>
                    <con2:ifThenElse>
                        <con1:id>_ActionId-N53efffe1.N727c6ccd.0.15156e80bbd.N7f89</con1:id>
                        <con2:case id="_BranchId-N53efffe1.N727c6ccd.0.15156e80bbd.N7f88">
                            <con2:condition>
                                <con1:xqueryText>$bodyBrmIsSolicitarResponse//ns0:isSolicitarCampana or fn:compare($withOutCall, '0') = 0</con1:xqueryText>
                            </con2:condition>
                            <con2:actions>
                                <con2:wsCallout>
                                    <con1:id>_ActionId-N3f57c7ff.N386bb895.0.151a2a4e335.N7ffe</con1:id>
                                    <con2:service ref="FuerzaDeVentas/GestionOrdenesTrabajo/Proxy Services/CRMServicioOrdenesPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con2:operation>MapearDatosProspecto</con2:operation>
                                    <con2:request>
                                        <con2:body wrapped="false">bodyCrmMapearDatosProspectoRequest</con2:body>
                                        <con2:header>header</con2:header>
                                    </con2:request>
                                    <con2:response>
                                        <con2:body wrapped="false">bodyCrmMapearDatosProspectoResponse</con2:body>
                                        <con2:header/>
                                    </con2:response>
                                    <con2:requestTransform>
                                        <con2:assign varName="bodyCrmMapearDatosProspectoRequest">
                                            <con1:id>_ActionId-N3f57c7ff.N386bb895.0.151a2a4e335.N7ffb</con1:id>
                                            <con2:expr>
                                                <con1:xqueryTransform>
                                                    <con1:resource ref="OperacionCreditos/RenovacionesIncrementos/Resources/Transformations/TransformIsRenvacionToMapearProspecto"/>
                                                    <con1:param name="brmOutput">
                                                        <con1:path>$bodyBrmIsRenovacionTopUpResponse</con1:path>
                                                    </con1:param>
                                                    <con1:param name="osbInput">
                                                        <con1:path>$body_tmp/*</con1:path>
                                                    </con1:param>
                                                </con1:xqueryTransform>
                                            </con2:expr>
                                        </con2:assign>
                                    </con2:requestTransform>
                                    <con2:responseTransform>
                                        <con2:ifThenElse>
                                            <con1:id>_ActionId-a1e030f.796f47d5.7.158f9f755b2.N7feb</con1:id>
                                            <con2:case>
                                                <con2:condition>
                                                    <con:xqueryText xmlns:con="http://www.bea.com/wli/sb/stages/config">$bodyCrmMapearDatosProspectoResponse//a:Codigo/text() != 0</con:xqueryText>
                                                </con2:condition>
                                                <con2:actions>
                                                    <con2:Error>
                                                        <con1:id>_ActionId-a1e030f.796f47d5.13.158ff0bfbce.N7ff0</con1:id>
                                                        <con2:errCode>NMP-1001</con2:errCode>
                                                        <con2:message>Error al enviar la gestión a CRM</con2:message>
                                                    </con2:Error>
                                                </con2:actions>
                                            </con2:case>
                                        </con2:ifThenElse>
                                    </con2:responseTransform>
                                </con2:wsCallout>
                            </con2:actions>
                        </con2:case>
                        <con2:default/>
                    </con2:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="PipelinePairNode">
                <con:request>request-N53effff2.N68cbfab3.0.1514c233dac.N7ffb</con:request>
                <con:response>response-N53effff2.N68cbfab3.0.1514c233dac.N7ffa</con:response>
            </con:pipeline-node>
        </con:flow>
        <con:partner-links/>
    </con:router>
</con:pipelineEntry>