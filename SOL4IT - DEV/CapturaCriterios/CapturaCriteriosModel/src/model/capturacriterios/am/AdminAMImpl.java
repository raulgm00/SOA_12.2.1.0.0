package model.capturacriterios.am;

import model.capturacriterios.am.common.AdminAM;
import model.capturacriterios.vo.RolByIdVOImpl;
import model.capturacriterios.vo.RolByIdVORowImpl;
import model.capturacriterios.vo.UserByIdVOImpl;
import model.capturacriterios.vo.UserByIdVORowImpl;

import oracle.jbo.server.ApplicationModuleImpl;
// ---------------------------------------------------------------------
// ---    File generated by Oracle ADF Business Components Design Time.
// ---    Thu Nov 05 13:31:47 CST 2015
// ---    Custom code may be added to this class.
// ---    Warning: Do not modify method signatures of generated methods.
// ---------------------------------------------------------------------
public class AdminAMImpl extends ApplicationModuleImpl implements AdminAM {
    /**
     * This is the default constructor (do not remove).
     */
    public AdminAMImpl() {
    }


    public Integer iniciarVoAdminAm(String usr){
        //Usuario
        String nombre_usr = "";
        int id_usr = 0;
        //Rol
        int id_usr_rol = 0;
        int id_rol = 0;
        int tipoP = 0;
        String nombre_rol = "";
        System.out.println("Usuario Logeado: " + usr.toLowerCase());

        //Usuario
        UserByIdVOImpl ObjUserImpl = this.getUserByIdVO1();
        ObjUserImpl.setNamedWhereClauseParam("p_nameUSR", usr.toLowerCase());
        ObjUserImpl.executeQuery();
        //Obtenemos los datos de la tabla de usuarios
        UserByIdVORowImpl ObjUserRowImpl = (UserByIdVORowImpl) ObjUserImpl.getRowAtRangeIndex(0);
        
        if(ObjUserRowImpl != null){
                if(ObjUserRowImpl.getNombreUsuario() != null){
                    nombre_usr = ObjUserRowImpl.getNombreUsuario();
                    id_usr = ObjUserRowImpl.getIdUsuario();
                    
                    //System.out.println("Nombre Usuario : " + nombre_usr);
                    //System.out.println("ID del usuario : " + id_usr);
                    
                    //Rol
                    RolByIdVOImpl ObjRolImpl = this.getRolByIdVO1();
                    ObjRolImpl.setNamedWhereClauseParam("p_idUSR",id_usr);
                    ObjRolImpl.executeQuery();
                    //Recuperando datos del query
                    RolByIdVORowImpl ObjRolRowImpl = (RolByIdVORowImpl) ObjRolImpl.getRowAtRangeIndex(0);
                    
                    if(ObjRolRowImpl !=null){
                        id_usr_rol = ObjRolRowImpl.getIdUsuarioRol();
                        id_rol = ObjRolRowImpl.getIdRol();
                        
                        if(ObjRolRowImpl.getNombreRol() != null){
                            nombre_rol = ObjRolRowImpl.getNombreRol(); 
                        }
                            
                    }
                    
                    //System.out.println("ID Rol del usuario : " + id_usr_rol + " ID Rol : " + id_rol + " Nombre del Rol : " + nombre_rol);
                    //System.out.println("ROL = " + id_rol );
                    
                    if(id_rol ==4 || id_rol ==5){
                            //Proyecto: Concentradora
                            tipoP = 1 ;
                        
                    }else if( id_rol ==6 || id_rol ==7 || id_rol ==8 ){
                            //Proyecto: Compra Cumplido
                            tipoP = 2 ;
                    }
                }else{
                    System.out.println("El usuario no existe");
                    //retornar al taskflow
                }
        }
        
        System.out.println("Tipo de Proyecto = " + tipoP );
        return tipoP;
    }


    /**
     * Container's getter for RolByIdVO1.
     * @return RolByIdVO1
     */
    public RolByIdVOImpl getRolByIdVO1() {
        return (RolByIdVOImpl) findViewObject("RolByIdVO1");
    }

    /**
     * Container's getter for UserByIdVO1.
     * @return UserByIdVO1
     */
    public UserByIdVOImpl getUserByIdVO1() {
        return (UserByIdVOImpl) findViewObject("UserByIdVO1");
    }
}

