<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config" xmlns:con3="http://www.bea.com/wli/sb/stages/logging/config">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="true" xsi:type="con:SoapBindingType">
            <con:wsdl ref="GestionClientes/UsuariosMonte/Resources/WSDLs/NMPUsuariosMonteWSDL"/>
            <con:binding>
                <con:name>NMPUsuariosMonte_PortTypeSOAP12Binding</con:name>
                <con:namespace>http://servicios.montedepiedad.com.mx/NMP/Service/UsuariosMonte</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
            <oper:tracingEnabled>true</oper:tracingEnabled>
        </oper:operations>
        <con:xqConfiguration>
            <con:snippetVersion>1.0</con:snippetVersion>
        </con:xqConfiguration>
    </con:coreEntry>
    <con:router errorHandler="error-af1001b.4e2d559f.0.15c59f456e4.N7fc9">
        <con:pipeline type="request" name="request-af100c3.24987ae2.0.15c3ca6313b.N7df3">
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6fe7" name="StageGetIdCliente">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6fe6</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>obtenerClientePorUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getClienteUsuarioReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getClienteUsuarioRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getClienteUsuarioReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6fe5</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:obtenerClientePorUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:usuarioMonte>{$body/usu:solicitarReinicioContrasenaRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:usuarioMonte>
&lt;/nmp:obtenerClientePorUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5d0c</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ObtenerClientePorUsuario(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="idCliente">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6c35</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:idCliente/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="numCredencial">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6fe1</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:numeroDeCredencial/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="numTelefono">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6bff</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:Contacto/*:ListaTelefonos/*:Telefono[./*:tipoTelefono='3']/*:numeroTelefonico/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6f29" name="StageConsultaEstado">
                <con:context>
                    <con2:userNsDecl prefix="tns" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6f26</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>consultarEstadoRegistro</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">consultaEstadoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">consultaEstadoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="consultaEstadoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6f23</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:consultarEstadoRegistroRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:numCredencial>{$numCredencial}&lt;/nmp:numCredencial>
&lt;/nmp:consultarEstadoRegistroRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5cd7</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ConsultarEstadoRegistro(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6e19</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N6e18">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado/text()='4' or $consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='2']/tns:idEstado/text()='3'</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6e85</con2:id>
                                        <con1:errCode>NMP-109</con1:errCode>
                                        <con1:message>Reinicio de contraseña denegado</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6d02" name="StageGeneraToken">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6cff</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>generaToken</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">generaTokenReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">generaTokenRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="vigenciaToken">
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7f37</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','vigenciaTokenCel','Valor1', '24',('Parametro','Config'))</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="generaTokenReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6cfe</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<tem:generaToken xmlns:tem="http://tempuri.org/">
     <tem:NoCredencial>{$numCredencial}</tem:NoCredencial>     
     <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>
     <tem:MedioContacto>Telefono</tem:MedioContacto>
     <tem:DatoValidacion>{$numTelefono}</tem:DatoValidacion>
     <tem:VigenciaHoras>{$vigenciaToken}</tem:VigenciaHoras>
</tem:generaToken>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5ca2</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'GeneraToken(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6cfd</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N6cfc">
                                    <con1:condition>
                                        <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:Codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:assign varName="token">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6cfb</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:DetalleRespuesta/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:actions>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7742</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$generaTokenRes/*:generaTokenResult/*:Mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6cfa</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6ccb" name="StageEnvioSMS">
                <con:context/>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6cf5</con2:id>
                        <con1:service ref="Utileria/MensajeriaUtil/Proxy Services/NMPMensajeriaSoapSyncPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>enviaMensajeSMS</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">enviarMensajeReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">enviarMensajeRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="enviarMensajeReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6cf4</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:enviaMensajeSMSrequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSMS">    
    <nmp:telefonoCliente>{$numTelefono}</nmp:telefonoCliente>
    <nmp:mensajeSMS>{concat('Tu codigo de validacion para completar la actualizacion es: ',$token)}</nmp:mensajeSMS>
</nmp:enviaMensajeSMSrequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5c6d</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'EnviarMensajeSMS'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5c00</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N5bff">
                                    <con1:condition>
                                        <con2:xqueryText>$enviarMensajeRes/*:respuesta/text() ='OK'</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5bfe</con2:id>
                                        <con1:errCode>OSB-382500</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N5349" name="StageActualizaFlujo2">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5348</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>updateCliente</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">updateFlujoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">updateFlujoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="updateFlujoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5347</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:updateClienteRequest  xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    <nmp:idCliente>{$idCliente}</nmp:idCliente>
     <nmp:numeroDeCredencial>{$numCredencial}</nmp:numeroDeCredencial>
     <nmp:DatosUsuario>            
        <nmp:estatus>2</nmp:estatus>            
        <nmp:tipoFlujo>3</nmp:tipoFlujo>
     </nmp:DatosUsuario>
</nmp:updateClienteRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5346</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ActualizaEstadoCliente(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.24987ae2.0.15c3ca6313b.N7dba">
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7db9" name="StageResponse">
                <con:context/>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af100c3.6aaed49a.0.15c40e39bfd.N7ecb</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap:Body xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
        <usu:registrarContrasenaResponse xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
            <usu:respuesta>
                <usu:codigo>0</usu:codigo>
                <usu:mensaje>Nueva contraseña registrada exitosamente</usu:mensaje>
            </usu:respuesta>
        </usu:registrarContrasenaResponse>
    </soap:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-af100c3.24987ae2.0.15c3ca6313b.N7f37">
            <con:stage id="_StageId-af10c31.54e14b43.0.15d1db89a49.N7571" name="StageValidacion">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7570</con2:id>
                        <con1:schema ref="GestionClientes/UsuariosMonte/Resources/Schemas/NMPUsuariosMonteXSD"/>
                        <con1:schemaElement xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">usu:validarDatosRequest</con1:schemaElement>
                        <con1:varName>body</con1:varName>
                        <con1:location>
                            <con2:xpathText>./usu:validarDatosRequest</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1005a.N47cae7a6.0.15c8e1ef744.N7f9d" name="stageGetClienteByNumCredencial">
                <con:context>
                    <con2:userNsDecl prefix="cliente" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con2:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="numCredencial">
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7fec</con2:id>
                        <con1:expr>
                            <con2:xqueryTransform>
                                <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/UMOperacionesXQ"/>
                                <con2:param name="funcion">
                                    <con2:path>'numCredencial'</con2:path>
                                </con2:param>
                                <con2:param name="param1">
                                    <con2:path>$body/usu:validarDatosRequest/usu:cliente/usu:numCredencial/text()</con2:path>
                                </con2:param>
                            </con2:xqueryTransform>
                        </con1:expr>
                    </con1:assign>
                    <con1:replace varName="body" contents-only="true">
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7fe9</con2:id>
                        <con1:location>
                            <con2:xpathText>./usu:validarDatosRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con2:xqueryText>$numCredencial/text()</con2:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7f9c</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>getClientesByNumCredencial</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getClienteByCredencialReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getClienteByCredencialRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getClienteByCredencialReq">
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7cc8</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:getClientesByNumCredencialRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:numCredencial>{$numCredencial/text()}&lt;/nmp:numCredencial>
&lt;/nmp:getClientesByNumCredencialRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N62e4</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'obtenerClientePorNumCredencial(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="idCliente">
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7393</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteByCredencialRes/cliente:Cliente/cliente:idCliente/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="cadena2">
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N759d</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>fn:concat($getClienteByCredencialRes/cliente:Cliente/cliente:nombre,' ',$getClienteByCredencialRes/cliente:Cliente/cliente:apellidoPaterno,' ',$getClienteByCredencialRes/cliente:Cliente/cliente:apellidoMaterno)</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af10c31.3de42731.0.15d9a4249c7.N7437" name="StageFechaNacimiento">
                <con:context>
                    <con2:userNsDecl prefix="cliente" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7434</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/Business Services/BMIXUtileriaTextoDifusaBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>getSimilitudSimple</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getSimilitudCorreoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getSimilitudCorreoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getSimilitudCorreoReq">
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7433</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<util:getSimilitudSimpleRequest xmlns:util="http://spring.io/guides/UtileriaTextoDifusa">
   <util:cadena1>{fn:substring-before($getClienteByCredencialRes/cliente:Cliente/cliente:fechaDeNacimiento/text(),'T')}</util:cadena1>
   <util:cadena2>{$body/usu:validarDatosRequest/usu:cliente/usu:fechaNacimiento/text()}</util:cadena2>
</util:getSimilitudSimpleRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7432</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'getSimilitudFechaNacimiento(BMIX)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7431</con2:id>
                                <con1:case id="_BranchId-af10c31.3de42731.0.15d9a4249c7.N7430">
                                    <con1:condition>
                                        <con2:xqueryText>$getSimilitudCorreoRes/*:similitud &lt; 100</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:Error>
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N742f</con2:id>
                                            <con1:errCode>NMP-116</con1:errCode>
                                            <con1:message>El cliente ya ha validado información con un correo diferente</con1:message>
                                        </con1:Error>
                                    </con1:actions>
                                </con1:case>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1005a.N47cae7a6.0.15c8e1ef744.N7f69" name="StageObtenerDatosFlujo">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="tns" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7f68</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>consultarEstadoRegistro</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">consultaEstadoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">consultaEstadoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="consultaEstadoReq">
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7c95</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:consultarEstadoRegistroRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:numCredencial>{$numCredencial/text()}&lt;/nmp:numCredencial>
&lt;/nmp:consultarEstadoRegistroRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N62b0</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ConsultarEstadoRegistro(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7af9</con2:id>
                                <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N7af8">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado/text()='1'</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:Error>
                                            <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N78bd</con2:id>
                                            <con1:errCode>NMP-101</con1:errCode>
                                            <con1:message>El cliente ya ha iniciado un registro</con1:message>
                                        </con1:Error>
                                    </con1:actions>
                                </con1:case>
                                <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N7620">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado/text()='2'</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:assign varName="codigoError">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N786e</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>102</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:actions>
                                </con1:case>
                                <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N761e">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado/text()='3'</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:Error>
                                            <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7615</con2:id>
                                            <con1:errCode>NMP-103</con1:errCode>
                                            <con1:message>El cliente esta pendiente de validar su correo</con1:message>
                                        </con1:Error>
                                    </con1:actions>
                                </con1:case>
                                <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N761c">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado/text()='4'</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:Error>
                                            <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7612</con2:id>
                                            <con1:errCode>NMP-104</con1:errCode>
                                            <con1:message>El cliente ya se encuentra registrado.</con1:message>
                                        </con1:Error>
                                    </con1:actions>
                                </con1:case>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N7f91">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/tns:codigo > 0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N780f</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>concat($serviceName,' - ',$consultaEstadoRes/tns:Mensaje)</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:Error>
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7f8e</con2:id>
                                            <con1:errCode>NMP-100</con1:errCode>
                                            <con1:message>Error en el Servicio</con1:message>
                                        </con1:Error>
                                    </con1:actions>
                                </con1:case>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af10c31.3de42731.0.15d9a4249c7.N7871" name="StageValidarCelularCorreo">
                <con:context>
                    <con2:userNsDecl prefix="cliente" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N77b6</con2:id>
                        <con1:case id="_BranchId-af10c31.3de42731.0.15d9a4249c7.N77b5">
                            <con1:condition>
                                <con2:xqueryText>$codigoError='102'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N77f7</con2:id>
                                    <con1:service ref="GestionClientes/UsuariosMonte/Business Services/BMIXUtileriaTextoDifusaBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>getSimilitudSimple</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">getSimilitudCorreoReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">getSimilitudCorreoRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="getSimilitudCorreoReq">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N77f6</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<util:getSimilitudSimpleRequest xmlns:util="http://spring.io/guides/UtileriaTextoDifusa">
   <util:cadena1>{$getClienteByCredencialRes/cliente:Cliente/cliente:CorreosElectronicos/cliente:CorreoElectronico[./cliente:fuenteDato='25']/cliente:email/text()}</util:cadena1>
   <util:cadena2>{$body/usu:validarDatosRequest/usu:cliente/usu:correoElectronico/text()}</util:cadena2>
</util:getSimilitudSimpleRequest>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N77f5</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'getSimilitudCorreo(BMIX)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N77f4</con2:id>
                                            <con1:case id="_BranchId-af10c31.3de42731.0.15d9a4249c7.N77f3">
                                                <con1:condition>
                                                    <con2:xqueryText>$getSimilitudCorreoRes/*:similitud &lt; 100</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:Error>
                                                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N77f2</con2:id>
                                                        <con1:errCode>NMP-114</con1:errCode>
                                                        <con1:message>El cliente ya ha validado información con un correo diferente</con1:message>
                                                    </con1:Error>
                                                </con1:actions>
                                            </con1:case>
                                        </con1:ifThenElse>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76d6</con2:id>
                                    <con1:service ref="GestionClientes/UsuariosMonte/Business Services/BMIXUtileriaTextoDifusaBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>getSimilitudSimple</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">getSimilitudCelReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">getSimilitudCelRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="getSimilitudCelReq">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76d5</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<util:getSimilitudSimpleRequest xmlns:util="http://spring.io/guides/UtileriaTextoDifusa">
   <util:cadena1>{$getClienteByCredencialRes/cliente:Cliente/cliente:Contacto/cliente:ListaTelefonos/cliente:Telefono[./cliente:tipoTelefono='celular'][1]/cliente:numeroTelefonico/text()}</util:cadena1>
   <util:cadena2>{$body/usu:validarDatosRequest/usu:cliente/usu:telefono/usu:numeroTelefono/text()}</util:cadena2>
</util:getSimilitudSimpleRequest>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76d4</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'getSimilitudCel(BMIX)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76d3</con2:id>
                                            <con1:case id="_BranchId-af10c31.3de42731.0.15d9a4249c7.N76d2">
                                                <con1:condition>
                                                    <con2:xqueryText>$getSimilitudCelRes/*:similitud &lt; 100</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:Error>
                                                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76d1</con2:id>
                                                        <con1:errCode>NMP-115</con1:errCode>
                                                        <con1:message>El cliente ya ha validado información con un telefono diferente</con1:message>
                                                    </con1:Error>
                                                </con1:actions>
                                            </con1:case>
                                        </con1:ifThenElse>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                                <con1:assign varName="body">
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76ce</con2:id>
                                    <con1:expr>
                                        <con2:xsltTransform>
                                            <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/TrValidarDatosResponse"/>
                                            <con2:input>$body</con2:input>
                                            <con2:param name="codigoRespuesta">
                                                <con2:path>$codigoError</con2:path>
                                            </con2:param>
                                            <con2:param name="infoCliente">
                                                <con2:path>$getClienteByCredencialRes</con2:path>
                                            </con2:param>
                                        </con2:xsltTransform>
                                    </con1:expr>
                                </con1:assign>
                                <con2:reply>
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76cb</con2:id>
                                </con2:reply>
                            </con1:actions>
                        </con1:case>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1005a.N47cae7a6.0.15c8e1ef744.N7eca" name="StageValidarContrato">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:disabled>true</con:disabled>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7ec9</con2:id>
                        <con1:service ref="OperacionPrendaria/Partidas/Proxy Services/NMPPartidasSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>validarContrato</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">validarContratoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">validarContratoRes</con1:body>
                            <con1:header/>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="validarContratoReq">
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7c62</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:validarContratoClienteRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPPartidas">
    <nmp:idCliente>{$idCliente}</nmp:idCliente>
    <nmp:folio>{$body/usu:validarDatosRequest/usu:cliente/usu:datosPrendarios/usu:numContrato/text()}</nmp:folio>
</nmp:validarContratoClienteRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N627c</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ValidarContrato(MIDAS)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N75a4</con2:id>
                                <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N75a3">
                                    <con1:condition>
                                        <con2:xqueryText>$validarContratoRes/*:codigo = 0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7809</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$validarContratoRes/*:descripcion)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N75a0</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1005a.N47cae7a6.0.15c8e1ef744.N7f34" name="StageGetPorcentaje">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="cadena1">
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N759a</con2:id>
                        <con1:expr>
                            <con2:xqueryText>fn:concat($body/usu:validarDatosRequest/usu:cliente/usu:nombres,' ',$body/usu:validarDatosRequest/usu:cliente/usu:apellidoPaterno,' ',$body/usu:validarDatosRequest/usu:cliente/usu:apellidoMaterno)</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7f33</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/Business Services/BMIXUtileriaTextoDifusaBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>getSimilitudSimple</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getSimilitudSimpleReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getSimilitudSimpleRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getSimilitudSimpleReq">
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N755a</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<util:getSimilitudSimpleRequest xmlns:util="http://spring.io/guides/UtileriaTextoDifusa">
   <util:cadena1>{$cadena1}</util:cadena1>
   <util:cadena2>{$cadena2}</util:cadena2>
</util:getSimilitudSimpleRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6248</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'getSimilitudNombre(BMIX)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7562</con2:id>
                                <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N7561">
                                    <con1:condition>
                                        <con2:xqueryText>$getSimilitudSimpleRes/*:similitud >=85</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N755e</con2:id>
                                        <con1:errCode>NMP-105</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1005a.N47cae7a6.0.15c8e1ef744.N7dc9" name="StageUpdateCliente">
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7dc8</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>updateCliente</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">updateClienteReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">updateClienteRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:replace varName="updateClienteReq">
                                <con2:id>_ActionId-af10068.5fa12745.0.15cb23a9d87.N7ffb</con2:id>
                                <con1:expr>
                                    <con2:xsltTransform>
                                        <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/TrValidarDatosUpdateClienteReqToCRMupdateClienteReq"/>
                                        <con2:input>$body/*</con2:input>
                                        <con2:param name="idCliente">
                                            <con2:path>$idCliente</con2:path>
                                        </con2:param>
                                    </con2:xsltTransform>
                                </con1:expr>
                            </con1:replace>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6214</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ActualizaCliente(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1005a.N47cae7a6.0.15c8e1ef744.N7697" name="StageActualizaFlujo1">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7696</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>updateCliente</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">updateFlujoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">updateFlujoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="updateFlujoReq">
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7695</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:updateClienteRequest  xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    
     <nmp:numeroDeCredencial>{$body/usu:validarDatosRequest/usu:cliente/usu:numCredencial/text()}</nmp:numeroDeCredencial>
     <nmp:DatosUsuario>            
        <nmp:estatus>1</nmp:estatus>            
        <nmp:tipoFlujo>1</nmp:tipoFlujo>
     </nmp:DatosUsuario>
</nmp:updateClienteRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N61e0</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ActualizaEstadoCliente(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N74b1</con2:id>
                                <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N74b0">
                                    <con1:condition>
                                        <con2:xqueryText>$updateFlujoRes/*:respuesta ='Estatus actualizado'</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7f95</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$validarContratoRes/*:descripcion)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N74ad</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N51d8" name="StageValidacionMedioContacto">
                <con:context>
                    <con2:userNsDecl prefix="cliente" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N74ef</con2:id>
                        <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N74ee">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:validarDatosRequest/usu:cliente/usu:medioValidacion=1</con2:xqueryText>
                            </con1:condition>
                            <con1:actions/>
                        </con1:case>
                        <con1:default>
                            <con1:Error>
                                <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N74e9</con2:id>
                                <con1:errCode>NMP-106</con1:errCode>
                                <con1:message>Medio de Validación Incorrecto</con1:message>
                            </con1:Error>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4f98</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/ProxyServices/NMPUsuariosMontePXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>validarMedioContacto</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">validaMedioContactoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">validaMedioContactoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="validaMedioContactoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4f95</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<usu:validarMedioContactoRequest xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
    <usu:usuario>       
        <usu:medioContacto>
            <usu:contactoPor>{$body/usu:validarDatosRequest/usu:cliente/usu:medioValidacion/text()}</usu:contactoPor>
            <usu:valorContacto>{$body/usu:validarDatosRequest/usu:cliente/usu:telefono/usu:numeroTelefono/text()}</usu:valorContacto>
        </usu:medioContacto>
        <usu:datosValidacion reenvioToken="false">          
        </usu:datosValidacion>
    </usu:usuario>
    <usu:cliente>        
        <usu:numCredencial>{$getClienteByCredencialRes/cliente:Cliente/cliente:numeroDeCredencial/text()}</usu:numCredencial>        
    </usu:cliente>
</usu:validarMedioContactoRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7fc9</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ValidaMedioContacto(OSB)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N481a</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N4819">
                                    <con1:condition>
                                        <con2:xqueryText>$validaMedioContactoRes/*:respuesta/*:codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7fcd</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$validaMedioContactoRes/*:respuesta/*:mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4818</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.24987ae2.0.15c3ca6313b.N7e96">
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7e95" name="StageResponse">
                <con:context/>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af100c3.6aaed49a.0.15c40e39bfd.N7f97</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap:Body xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
        <usu:actualizarDatosResponse xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
            <usu:respuesta>
                <usu:codigo>0</usu:codigo>
                <usu:mensaje>Actualización pendiente de validación</usu:mensaje>
            </usu:respuesta>
        </usu:actualizarDatosResponse>
    </soap:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-af100c3.131fc352.0.15c4184bb6f.N7f9e">
            <con:stage id="_StageId-af100c3.131fc352.0.15c4184bb6f.N7f9c" name="StageValidacion">
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:varNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="serviceName">
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N637d</con2:id>
                        <con1:expr>
                            <con2:xqueryText>'UsuariosMonte'</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="body_tmp">
                        <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7f6c</con2:id>
                        <con1:expr>
                            <con2:xqueryText>$body</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="operacion">
                        <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7f69</con2:id>
                        <con1:expr>
                            <con2:xqueryText>$inbound/ctx:service/ctx:operation</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1001b.4e2d559f.0.15c59f456e4.N7faf</con2:id>
                        <con1:case id="_BranchId-af1001b.4e2d559f.0.15c59f456e4.N7fae">
                            <con1:condition>
                                <con2:xqueryText>$header/nmph:headerMessage</con2:xqueryText>
                            </con1:condition>
                            <con1:actions/>
                        </con1:case>
                        <con1:default>
                            <con1:assign varName="header">
                                <con2:id>_ActionId-af1001b.4e2d559f.0.15c59f456e4.N7fab</con2:id>
                                <con1:expr>
                                    <con2:xsltTransform>
                                        <con2:resource ref="Common/XSLT/TRInboundToHeaderSoap12NMP"/>
                                        <con2:input>$inbound</con2:input>
                                    </con2:xsltTransform>
                                </con1:expr>
                            </con1:assign>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:validate>
                        <con2:id>_ActionId-af1001b.4e2d559f.0.15c59f456e4.N7ffb</con2:id>
                        <con1:schema ref="Common/XSD/NMPStandardHeader"/>
                        <con1:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con1:schemaElement>
                        <con1:varName>header</con1:varName>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                        <con1:resultVarName/>
                    </con1:validate>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-af1001b.4e2d559f.0.15c59f456e4.N7fc9">
            <con:stage id="_StageId-af1001b.4e2d559f.0.15c59f456e4.N7fc8" name="StageUsuariosMonteError">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7f31</con2:id>
                        <con1:case id="_BranchId-af10c31.46c01acf.0.15de1f090e5.N7f30">
                            <con1:condition>
                                <con2:xqueryText>$operacion='validarDatos'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7f2d</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$body_tmp</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>ValidarDatos Req usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarDatosRequest/usu:cliente/usu:correoElectronico</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCredencial</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarDatosRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7f2a</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>ValidarDatos Fault usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarDatosRequest/usu:cliente/usu:correoElectronico</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCredencial</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarDatosRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af10c31.46c01acf.0.15de1f090e5.N7f28">
                            <con1:condition>
                                <con2:xqueryText>$operacion='validarMedioContacto'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7ef4</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$body_tmp</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>ValidarMedioContacto Req usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarMedioContactoRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCredencial</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarMedioContactoRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7eee</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>ValidarMedioContacto Fault usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarMedioContactoRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCredencial</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:validarMedioContactoRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af10c31.46c01acf.0.15de1f090e5.N7eec">
                            <con1:condition>
                                <con2:xqueryText>$operacion='actualizarDatos'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7eb8</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$body_tmp</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>actualizarDatos Req usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:actualizarDatosRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCredencial</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:actualizarDatosRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7eb5</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>actualizarDatos Fault usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:actualizarDatosRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCredencial</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:actualizarDatosRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af10c31.46c01acf.0.15de1f090e5.N7eb3">
                            <con1:condition>
                                <con2:xqueryText>$operacion='solicitarAlta'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7e7f</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$body_tmp</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>solicitarAlta Req usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCliente</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarAltaRequest/usu:cliente/*</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7e7c</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>SolicitarAlta Fault Usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>numCliente</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarAltaRequest/usu:cliente/*</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af10c31.46c01acf.0.15de1f090e5.N7e7a">
                            <con1:condition>
                                <con2:xqueryText>$operacion='solicitarActivacion'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7e46</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$body_tmp</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>solicitarActivacion Req usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarActivacionRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>token</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarActivacionRequest/usu:usuario/usu:datosValidacion/usu:token</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7e43</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>solicitarActivacion Fault usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarActivacionRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                    <con3:labels>
                                        <con3:key>token</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarActivacionRequest/usu:usuario/usu:datosValidacion/usu:token</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af10c31.46c01acf.0.15de1f090e5.N7e0f">
                            <con1:condition>
                                <con2:xqueryText>$operacion='solicitarReinicioContrasena'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7ddb</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$body_tmp</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>solicitarReinicioContrasena Req usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarReinicioContrasenaRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7da6</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>solicitarReinicioContrasena Fault usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:solicitarReinicioContrasenaRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af10c31.46c01acf.0.15de1f090e5.N7da4">
                            <con1:condition>
                                <con2:xqueryText>$operacion='registrarContrasena'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7d6f</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$body_tmp</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>registrarContrasena Req usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                                <con3:report>
                                    <con2:id>_ActionId-af10c31.46c01acf.0.15de1f090e5.N7d6c</con2:id>
                                    <con3:expr>
                                        <con2:xqueryText>$fault</con2:xqueryText>
                                    </con3:expr>
                                    <con3:labels>
                                        <con3:key>registrarContrasena Fault usuario</con3:key>
                                        <con3:varName>body_tmp</con3:varName>
                                        <con3:value>
                                            <con2:xpathText>./usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario</con2:xpathText>
                                        </con3:value>
                                    </con3:labels>
                                </con3:report>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7e7b</con2:id>
                        <con1:expr>
                            <con2:xsltTransform>
                                <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/TransformFaultsUsuariosMonte"/>
                                <con2:input>$fault</con2:input>
                                <con2:param name="serviceName">
                                    <con2:path>$serviceName</con2:path>
                                </con2:param>
                            </con2:xsltTransform>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="header">
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N76c8</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;soap:Header xmlns:soap="http://www.w3.org/2003/05/soap-envelope">      
    &lt;/soap:Header></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con2:reply isError="true">
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7e47</con2:id>
                    </con2:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.24987ae2.0.15c3ca6313b.N7ecd">
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7ecc" name="StageResponse">
                <con:context/>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af100c3.6aaed49a.0.15c40e39bfd.N7fca</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap:Body xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
        <usu:validarMedioContactoResponse xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
            <!--Optional:-->
            <usu:cliente>
                <usu:estadoRegistro>validación</usu:estadoRegistro>
            </usu:cliente>
            <usu:respuesta>
                <usu:codigo>0</usu:codigo>
                <usu:mensaje>{$mensajeResponse}</usu:mensaje>
            </usu:respuesta>
        </usu:validarMedioContactoResponse>
    </soap:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.24987ae2.0.15c3ca6313b.N7f36">
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7f34" name="StageResponse">
                <con:context>
                    <con2:varNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af100c3.6aaed49a.0.15c40e39bfd.N7ffe</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap:Body xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
        <usu:validarDatosResponse xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
            <!--Optional:-->
            <usu:cliente>
                <usu:estadoRegistro>Preregistro</usu:estadoRegistro>
                <usu:idCliente>{$idCliente}</usu:idCliente>
            </usu:cliente>
            <usu:respuesta>
                <usu:codigo>0</usu:codigo>
                <usu:mensaje>Preregistro pendiente de validación</usu:mensaje>
            </usu:respuesta>
        </usu:validarDatosResponse>
    </soap:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-af100c3.24987ae2.0.15c3ca6313b.N7e2a">
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N70ac" name="StageGetIdCliente">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:disabled>true</con:disabled>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N70ab</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>obtenerClientePorUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getClienteUsuarioReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getClienteUsuarioRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getClienteUsuarioReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N70aa</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:obtenerClientePorUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:usuarioMonte>{$body/usu:solicitarActivacionRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:usuarioMonte>
&lt;/nmp:obtenerClientePorUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5dab</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ObtenerClientePorUsuario(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N70a9</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N70a8">
                                    <con1:condition>
                                        <con2:xqueryText>$getClienteUsuarioRes</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:assign varName="idCliente">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N70a7</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:idCliente/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="numCredencial">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N709d</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:numeroDeCredencial/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:actions>
                                </con1:case>
                                <con1:default>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N70a6</con2:id>
                                        <con1:errCode>OSB-382500</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af10c31.3de42731.0.15d9a4249c7.N7950" name="StageDesencriptar">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="llaveSecreta">
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N791c</con2:id>
                        <con1:expr>
                            <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','llaveSecreta','Valor1', 'e5d6b646-d57d-49',('Parametro','Config'))</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:javaCallout varName="token">
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7919</con2:id>
                        <con1:archive ref="Common/JAR/utileria-nmp-encriptacion"/>
                        <con1:className>utileria.nmp.encriptacion.EncriptarDesencriptarMensaje</con1:className>
                        <con1:method>public static java.lang.String desencriptar(java.lang.String, java.lang.String)</con1:method>
                        <con1:expr>
                            <con2:xqueryText>$body/usu:solicitarActivacionRequest/usu:usuario/usu:datosValidacion/usu:token/text()</con2:xqueryText>
                        </con1:expr>
                        <con1:expr>
                            <con2:xqueryText>$llaveSecreta</con2:xqueryText>
                        </con1:expr>
                        <con1:return-param-as-ref>false</con1:return-param-as-ref>
                    </con1:javaCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7e29" name="StageValidaToken">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7137</con2:id>
                        <con2:disabled>true</con2:disabled>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N7136">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:solicitarActivacionRequest/usu:usuario/usu:medioContacto/usu:contactoPor=1</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="MedioContacto">
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7135</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>'Telefono'</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N7134">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:solicitarActivacionRequest/usu:usuario/usu:medioContacto/usu:contactoPor=2</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="MedioContacto">
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7133</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>'Correo'</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                    </con1:ifThenElse>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7934</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>validaToken</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">validaTokenReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">validaTokenRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="validaTokenReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N78ff</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<tem:validaToken xmlns:tem="http://tempuri.org/">    
    <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>             
    <tem:Codigo>{$token}</tem:Codigo>    
</tem:validaToken>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5d76</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ValidarToken(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N788b</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N788a">
                                    <con1:condition>
                                        <con2:xqueryText>$validaTokenRes/*:validaTokenResult/*:Codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:assign varName="idCliente">
                                            <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7c43</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$validaTokenRes/*:validaTokenResult/*:DetalleRespuesta/*:IdCliente</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:actions>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N787d</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$validaTokenRes/*:validaTokenResult/*:Mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7887</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af10c31.N78b5a8b1.0.15d85190c0a.N7cb8" name="StageInFoCliente">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7cb3</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>getClientesByID</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getClienteReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getClienteRes</con1:body>
                            <con1:header/>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getClienteReq">
                                <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7cb2</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:getClientesByIDRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
   &lt;nmp:idCliente>{$idCliente/text()}&lt;/nmp:idCliente>
&lt;/nmp:getClientesByIDRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7cb1</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ObtenerClientePorIdCliente(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="idCliente">
                                <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7cb0</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteRes/*:Cliente/*:idCliente/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="numCredencial">
                                <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7caf</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteRes/*:Cliente/*:numeroDeCredencial/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="nombreCliente">
                                <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7cae</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteRes/*:Cliente/*:nombre/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="correo">
                                <con2:id>_ActionId-af10c31.N78b5a8b1.0.15d85190c0a.N7c09</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteRes/*:Cliente/*:CorreosElectronicos/*:CorreoElectronico[./*:tipoEmail='Principal']/*:email/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N712b" name="StageHabilitarUsuario">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="ai" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7815</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>activarUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">activarRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">activarResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7439</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'HabilitarUsuario(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="activarRequest">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7814</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:activarUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    &lt;nmp:Username>{$correo}&lt;/nmp:Username>
&lt;/nmp:activarUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N712c" name="StageActualizaFlujo4">
                <con:context/>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7854</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>updateCliente</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">updateFlujoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">updateFlujoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="updateFlujoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N77bd</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:updateClienteRequest  xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">    
     <nmp:numeroDeCredencial>{$numCredencial}</nmp:numeroDeCredencial>
     <nmp:DatosUsuario>            
        <nmp:estatus>4</nmp:estatus>            
        <nmp:tipoFlujo>1</nmp:tipoFlujo>
     </nmp:DatosUsuario>
</nmp:updateClienteRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5d41</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ActualizaEstadoCliente(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-af10068.N64ade893.0.15d2d6a1629.N7eaa">
            <con:stage id="_StageId-af10068.N64ade893.0.15d2d6a1629.N7ea9" name="StageConfirmaContraseñaError">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7da1</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>borrarUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">borrarUsuarioRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">borrarUsuarioResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7da0</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'AWSCognitoIdentityProviderService'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="borrarUsuarioRequest">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7d9f</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:borrarUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    &lt;nmp:Username>{$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:Username>
&lt;/nmp:borrarUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                    <con1:assign varName="serviceName">
                        <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7e0f</con2:id>
                        <con1:expr>
                            <con2:xqueryText>concat($serviceName,' - ',$fault/*:details/*:ReceivedFaultDetail/*:detail/*:messageError/*:descripcionError/text())</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:Error>
                        <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7e12</con2:id>
                        <con1:errCode>NMP-100</con1:errCode>
                        <con1:message>Error en el Servicio</con1:message>
                    </con1:Error>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.24987ae2.0.15c3ca6313b.N7e28">
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7e27" name="StageResponse">
                <con:context/>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af100c3.6aaed49a.0.15c40e39bfd.N7f31</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap:Body xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
        <usu:solicitarActivacionResponse xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
            <!--Optional:-->
            <usu:cliente>
                <usu:estadoRegistro>Activado</usu:estadoRegistro>
            </usu:cliente>
            <usu:respuesta>
                <usu:codigo>0</usu:codigo>
                <usu:mensaje>Usuario activado exitosamente</usu:mensaje>
            </usu:respuesta>
        </usu:solicitarActivacionResponse>
    </soap:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-af100c3.24987ae2.0.15c3ca6313b.N7e61">
            <con:stage id="_StageId-af10c31.54e14b43.0.15d1db89a49.N750a" name="StageValidacion">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7509</con2:id>
                        <con1:schema ref="GestionClientes/UsuariosMonte/Resources/Schemas/NMPUsuariosMonteXSD"/>
                        <con1:schemaElement xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">usu:solicitarAltaRequest</con1:schemaElement>
                        <con1:varName>body</con1:varName>
                        <con1:location>
                            <con2:xpathText>./usu:solicitarAltaRequest</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7e60" name="StageValidarToken">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7ada</con2:id>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N7ad7">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:solicitarAltaRequest/usu:usuario/usu:medioContacto/usu:contactoPor=1</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="MedioContacto">
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7a0a</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>'Telefono'</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:Error>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N758c</con2:id>
                                <con1:errCode>NMP-108</con1:errCode>
                                <con1:message>Medio de Validación Incorrecto</con1:message>
                            </con1:Error>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7d49</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>validaToken</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">validarTokenReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">validarTokenRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="validarTokenReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7ae1</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<tem:validaToken xmlns:tem="http://tempuri.org/">    
    <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>             
    <tem:Codigo>{$body/usu:solicitarAltaRequest/usu:usuario/usu:datosValidacion/usu:token/text()}</tem:Codigo>    
</tem:validaToken>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5ffb</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ValidarToken(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7cdf</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N7cde">
                                    <con1:condition>
                                        <con2:xqueryText>$validarTokenRes/*:validaTokenResult/*:Codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7c69</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$validarTokenRes/*:validaTokenResult/*:Mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7ca7</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N7d17" name="StageAltaUsuario">
                <con:context>
                    <con2:userNsDecl prefix="utl" namespace="http://servicios.montedepiedad.com.mx/NMP/Transformations/UtilidadesFecha"/>
                    <con2:dependencies>
                        <con2:importModule ref="Common/XQ/UtilidadServiciosAmazonXQ"/>
                    </con2:dependencies>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af10021.6bfc6c29.0.15cd231f6b3.N7a57</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>crearUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">crearUsuarioRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">crearUsuarioResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7506</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'AltaUsuario(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="updated_at">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7edc</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>utl:obtenerTimestampDeFecha(utl:agregarHorasEnFechaHora(fn:current-dateTime(),xs:int('5')))</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="crearUsuarioRequest">
                                <con2:id>_ActionId-af10021.6bfc6c29.0.15cd231f6b3.N7a51</con2:id>
                                <con1:expr>
                                    <con2:xsltTransform>
                                        <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/TrAltaUsuarioToCognitoCrearUsuario"/>
                                        <con2:input>$body</con2:input>
                                        <con2:param name="operacion">
                                            <con2:path>'solicitarAlta'</con2:path>
                                        </con2:param>
                                        <con2:param name="updated_at">
                                            <con2:path>$updated_at</con2:path>
                                        </con2:param>
                                    </con2:xsltTransform>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af004be.3b6e7a43.0.15cf552feaf.N79ba" name="StageActivacionUsuario">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="ai" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N79b9</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>autenticarUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">autenticarUsuarioRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">autenticarUsuarioResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N74d2</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ActivacionUsuario(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="autenticarUsuarioRequest">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N79b8</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:autenticarUsuarioRequest
    xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    <nmp:flujoAutenticacion>ADMIN_NO_SRP_AUTH</nmp:flujoAutenticacion>
    <nmp:parametrosAutenticacion>
        <nmp:parametro>
            <nmp:nombre>USERNAME</nmp:nombre>
            <nmp:valor>{$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario/text()}</nmp:valor>
        </nmp:parametro>
        <nmp:parametro>
            <nmp:nombre>PASSWORD</nmp:nombre>
            <nmp:valor>{concat('Nmp$0',$body/usu:solicitarAltaRequest/usu:usuario/usu:datosValidacion/usu:token)}</nmp:valor>
        </nmp:parametro>
    </nmp:parametrosAutenticacion>
</nmp:autenticarUsuarioRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="sesion">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N79b7</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$autenticarUsuarioResponse/ai:informacionCambio/ai:sesion</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af004be.3b6e7a43.0.15cf552feaf.N794d" name="StageConfirmaContrasena" errorHandler="error-af10068.N64ade893.0.15d2d6a1629.N7eaa">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N794c</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>actualizarParamAutenticacion</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">actualizarParamRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">actualizarParamResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N749f</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ConfirmarContrasena(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="actualizarParamRequest">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N794b</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:actualizarParamAutenticacionRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    <nmp:nombreCambio>NEW_PASSWORD_REQUIRED</nmp:nombreCambio> 
    <nmp:respuestaCambios>
        <!--1 or more repetitions:-->
        <nmp:parametro>
            <nmp:nombre>USERNAME</nmp:nombre>
            <nmp:valor>{$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario/text()}</nmp:valor>           
        </nmp:parametro>
        <nmp:parametro>
            <nmp:nombre>NEW_PASSWORD</nmp:nombre>
            <nmp:valor>{$body/usu:solicitarAltaRequest/usu:usuario/usu:contrasena/text()}</nmp:valor>           
        </nmp:parametro>
    </nmp:respuestaCambios>
    <!--Optional:-->
    <nmp:Sesion>{$sesion/text()}</nmp:Sesion>
</nmp:actualizarParamAutenticacionRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af004be.3b6e7a43.0.15cf552feaf.N794a" name="StageDeshabilitarUsuario">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7c01</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>desactivarUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">desactivarRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">desactivarResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N746c</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'DeshabilitarUsuario(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="desactivarRequest">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7c00</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:desactivarUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    &lt;nmp:Username>{$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:Username>
&lt;/nmp:desactivarUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N729c" name="StageGeneraToken">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7299</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>generaToken</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">generaTokenReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">generaTokenRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="vigenciaToken">
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7f3b</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','vigenciaTokenCorreo','Valor1', '24',('Parametro','Config'))</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af10c4f.6857809e.0.15d60aec80e.N7fc7</con2:id>
                                <con1:case id="_BranchId-af10c4f.6857809e.0.15d60aec80e.N7fc6">
                                    <con1:condition>
                                        <con2:xqueryText>$body/usu:solicitarAltaRequest/usu:cliente/usu:numCredencial</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:assign varName="numCredencial">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7f7a</con2:id>
                                            <con1:expr>
                                                <con2:xqueryTransform>
                                                    <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/UMOperacionesXQ"/>
                                                    <con2:param name="funcion">
                                                        <con2:path>'numCredencial'</con2:path>
                                                    </con2:param>
                                                    <con2:param name="param1">
                                                        <con2:path>$body/usu:solicitarAltaRequest/usu:cliente/usu:numCredencial/text()</con2:path>
                                                    </con2:param>
                                                </con2:xqueryTransform>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:replace varName="body" contents-only="true">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7f77</con2:id>
                                            <con1:location>
                                                <con2:xpathText>./usu:solicitarAltaRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                            </con1:location>
                                            <con1:expr>
                                                <con2:xqueryText>$numCredencial/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:replace>
                                        <con1:assign varName="generaTokenReq">
                                            <con2:id>_ActionId-af10c4f.6857809e.0.15d60aec80e.N7f91</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<tem:generaToken xmlns:tem="http://tempuri.org/">
     <tem:NoCredencial>{$body/usu:solicitarAltaRequest/usu:cliente/usu:numCredencial/text()}</tem:NoCredencial> 
     <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>
     <tem:MedioContacto>Correo</tem:MedioContacto>
     <tem:DatoValidacion>{$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario/text()}</tem:DatoValidacion>
     <tem:VigenciaHoras>{$vigenciaToken}</tem:VigenciaHoras>
</tem:generaToken>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:actions>
                                </con1:case>
                                <con1:default/>
                            </con1:ifThenElse>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5fc6</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'GeneraToken(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N725e</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N725d">
                                    <con1:condition>
                                        <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:Codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions>
                                        <con1:assign varName="tokenCRM">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7229</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:DetalleRespuesta/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="llaveSecreta">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7958</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','llaveSecreta','Valor1', 'e5d6b646-d57d-49',('Parametro','Config'))</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:javaCallout varName="token">
                                            <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N795b</con2:id>
                                            <con1:archive ref="Common/JAR/utileria-nmp-encriptacion"/>
                                            <con1:className>utileria.nmp.encriptacion.EncriptarDesencriptarMensaje</con1:className>
                                            <con1:method>public static java.lang.String encriptar(java.lang.String, java.lang.String)</con1:method>
                                            <con1:expr>
                                                <con2:xqueryText>$tokenCRM</con2:xqueryText>
                                            </con1:expr>
                                            <con1:expr>
                                                <con2:xqueryText>$llaveSecreta</con2:xqueryText>
                                            </con1:expr>
                                            <con1:return-param-as-ref>false</con1:return-param-as-ref>
                                        </con1:javaCallout>
                                    </con1:actions>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7bcc</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$generaTokenRes/*:generaTokenResult/*:Mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N71f5</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N7c0f" name="StageActualizaFlujo3">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7af2</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>updateCliente</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">updateFlujoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">updateFlujoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="updateFlujoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7af1</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:updateClienteRequest  xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">    
     <nmp:numeroDeCredencial>{$body/usu:solicitarAltaRequest/usu:cliente/usu:numCredencial/text()}</nmp:numeroDeCredencial>
     <nmp:DatosUsuario>            
        <nmp:estatus>3</nmp:estatus>            
        <nmp:tipoFlujo>1</nmp:tipoFlujo>
     </nmp:DatosUsuario>
</nmp:updateClienteRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5f5c</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ActualizaEstadoCliente(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af10068.N64ade893.0.15d2d6a1629.N7d18" name="StageGetInfoCliente">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7d17</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>obtenerClientePorUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getClienteUsuarioReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getClienteUsuarioRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getClienteUsuarioReq">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7d16</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:obtenerClientePorUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:usuarioMonte>{$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:usuarioMonte>
&lt;/nmp:obtenerClientePorUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7d15</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ObtenerClienteUsuario(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="nombreCliente">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7cde</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:nombre/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N7aed" name="StageEnviaCorreo">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7aea</con2:id>
                        <con1:service ref="Utileria/EnvioCorreoUtil/Proxy Services/NMPEnvioCorreoUtilPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>enviarCorreo</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">enviaCorreoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">enviaCorreoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="dominioMonte">
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7f71</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','dominioMonte','Valor1', 'http://dev1775-frontmimonte.mybluemix.net/srv/activate/?t',('Parametro','Config'))</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="contenidoCorreo">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7d92</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[string(concat("<p>Estimado/a ",$nombreCliente,",</p>

<p>Gracias por registrarte en Mi Monte. </p>
<p>Para acceder a tu cuenta, por favor haz clic en el siguiente enlace: </p>",
$dominioMonte,'=',$token,"&amp;u=",$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario,"
      
<p>En Mi Monte podrás realizar:</p>

<ul>
<p><li> Consulta tu boleta de empeño </li></p>
<p><li> Pagos en línea </li></p>
<p><li> Consulta de tus boletas próximas a vencer </li></p>
<p><li> Consulta de tus boletas vencidas </li></p>
</ul>

<p>Si necesitas ayuda adicional, por favor comunícate con nosotros al 01800 EL MONTE (018003566683)</p>"))]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="enviaCorreoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7ae7</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<env:envioCorreoRequest xmlns:env="http://servicios.montedepiedad.com.mx/NMP/Schema/EnvioCorreoUtil">
    <env:para>{$body/usu:solicitarAltaRequest/usu:usuario/usu:nombreUsuario/text()}</env:para>
    <env:de>notificaciones@montepiedad.com.mx</env:de>
    <env:asunto>Activa tu cuenta Mi Monte</env:asunto>
    <env:contenidoHTML>{$contenidoCorreo}</env:contenidoHTML>	
</env:envioCorreoRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5e4f</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'EnviarCorreo(SBLUE)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.24987ae2.0.15c3ca6313b.N7df1">
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7df0" name="StageResponse">
                <con:context/>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af100c3.6aaed49a.0.15c40e39bfd.N7efe</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap:Body xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
    <usu:solicitarReinicioContrasenaResponse xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
        <usu:telefono>
            <usu:ultimosDigitos>{fn:substring($numTelefono,7)}</usu:ultimosDigitos>           
        </usu:telefono>        
        <usu:respuesta>
            <usu:codigo>0</usu:codigo>
            <usu:mensaje>Reinicio de contrasena pendiente de validación</usu:mensaje>
        </usu:respuesta>
    </usu:solicitarReinicioContrasenaResponse>
</soap:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-af100c3.24987ae2.0.15c3ca6313b.N7ecf">
            <con:stage id="_StageId-af10c31.54e14b43.0.15d1db89a49.N75db" name="StageValidacion">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N75d7</con2:id>
                        <con1:schema ref="GestionClientes/UsuariosMonte/Resources/Schemas/NMPUsuariosMonteXSD"/>
                        <con1:schemaElement xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">usu:validarMedioContactoRequest</con1:schemaElement>
                        <con1:varName>body</con1:varName>
                        <con1:location>
                            <con2:xpathText>./usu:validarMedioContactoRequest</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N4edb" name="StageInFoCliente">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7e0d</con2:id>
                        <con1:case id="_BranchId-af004be.3b6e7a43.0.15cf552feaf.N7e0c">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:validarMedioContactoRequest/usu:cliente/usu:numCredencial</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="numCredencial">
                                    <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7ac1</con2:id>
                                    <con1:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/UMOperacionesXQ"/>
                                            <con2:param name="funcion">
                                                <con2:path>'numCredencial'</con2:path>
                                            </con2:param>
                                            <con2:param name="param1">
                                                <con2:path>$body/usu:validarMedioContactoRequest/usu:cliente/usu:numCredencial/text()</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con1:expr>
                                </con1:assign>
                                <con1:assign varName="numCredencial">
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7f74</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>$numCredencial/text()</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:replace varName="body" contents-only="true">
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7fe6</con2:id>
                                    <con1:location>
                                        <con2:xpathText>./usu:validarMedioContactoRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                    </con1:location>
                                    <con1:expr>
                                        <con2:xqueryText>$numCredencial</con2:xqueryText>
                                    </con1:expr>
                                </con1:replace>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af004be.3b6e7a43.0.15cf552feaf.N7d82">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:validarMedioContactoRequest/usu:cliente/usu:idCliente</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7c0c</con2:id>
                                    <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>getClientesByID</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">getClienteReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">getClienteRes</con1:body>
                                        <con1:header/>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="getClienteReq">
                                            <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7c0b</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>&lt;nmp:getClientesByIDRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
   &lt;nmp:idCliente>{$body/usu:validarMedioContactoRequest/usu:cliente/usu:idCliente/text()}&lt;/nmp:idCliente>
&lt;/nmp:getClientesByIDRequest></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7c0a</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'ObtenerClientePorIdCliente(CRM)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:assign varName="idCliente">
                                            <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7c07</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$getClienteRes/*:Cliente/*:idCliente/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="numCredencial">
                                            <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7c06</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$getClienteRes/*:Cliente/*:numeroDeCredencial/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="nombreCliente">
                                            <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7bd4</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$getClienteRes/*:Cliente/*:nombre/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:wsCallout>
                                <con2:id>_ActionId-a1e030f.N4ad56736.1.15d3df40c82.N7fff</con2:id>
                                <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con1:operation>obtenerClientePorUsuario</con1:operation>
                                <con1:request>
                                    <con1:body wrapped="false">getClienteReq</con1:body>
                                    <con1:header>header</con1:header>
                                </con1:request>
                                <con1:response>
                                    <con1:body wrapped="false">getClienteRes</con1:body>
                                    <con1:header/>
                                </con1:response>
                                <con1:requestTransform>
                                    <con1:assign varName="getClienteReq">
                                        <con2:id>_ActionId-a1e030f.N4ad56736.1.15d3df40c82.N7ffe</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>&lt;nmp:obtenerClientePorUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
   &lt;nmp:usuarioMonte>{$body/usu:validarMedioContactoRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:usuarioMonte>
&lt;/nmp:obtenerClientePorUsuarioRequest></con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-a1e030f.N4ad56736.1.15d3df40c82.N7ffd</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>'ObtenerClientePorUsuario(CRM)'</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                </con1:requestTransform>
                                <con1:responseTransform>
                                    <con1:assign varName="idCliente">
                                        <con2:id>_ActionId-a1e030f.N4ad56736.1.15d3df40c82.N7ffc</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>$getClienteRes/*:Cliente/*:idCliente/text()</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:assign varName="numCredencial">
                                        <con2:id>_ActionId-a1e030f.N4ad56736.1.15d3df40c82.N7ffb</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>$getClienteRes/*:Cliente/*:numeroDeCredencial/text()</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:assign varName="nombreCliente">
                                        <con2:id>_ActionId-a1e030f.N4ad56736.1.15d3df40c82.N7ffa</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>$getClienteRes/*:Cliente/*:nombre/text()</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                </con1:responseTransform>
                            </con1:wsCallout>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N515a" name="StageConsultaEstado">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="tns" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5159</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>consultarEstadoRegistro</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">consultaEstadoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">consultaEstadoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="consultaEstadoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5158</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:consultarEstadoRegistroRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:numCredencial>{$numCredencial}&lt;/nmp:numCredencial>
&lt;/nmp:consultarEstadoRegistroRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5157</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ConsultarEstadoRegistro(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5156</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N5155">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/*:codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7f61</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$consultaEstadoRes/*:mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5154</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N4d41" name="StageMedioValidacion">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7662</con2:id>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N7661">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:validarMedioContactoRequest/usu:usuario/usu:medioContacto/usu:contactoPor=1</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="MedioContacto">
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7627</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>'Telefono'</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:assign varName="vigenciaToken">
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7ffe</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','vigenciaTokenCel','Valor1', '24',('Parametro','Config'))</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N765d">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:validarMedioContactoRequest/usu:usuario/usu:medioContacto/usu:contactoPor=2</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="MedioContacto">
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N75f3</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>'Correo'</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:assign varName="vigenciaToken">
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7ffb</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','vigenciaTokenCorreo','Valor1', '24',('Parametro','Config'))</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:assign varName="dominioMonte">
                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7ff8</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','dominioMonte','Valor1', 'http://dev1575-frontmimonte.mybluemix.net/srv/activate/?t',('Parametro','Config'))</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:Error>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N75bf</con2:id>
                                <con1:errCode>NMP-106</con1:errCode>
                                <con1:message>Medio de Validación Incorrecto</con1:message>
                            </con1:Error>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N50e8" name="StageValidaEstatus">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="tns" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N50e7</con2:id>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N50e6">
                            <con1:condition>
                                <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado=1</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7d8e</con2:id>
                                    <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>generaToken</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">generaTokenReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">generaTokenRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="generaTokenReq">
                                            <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7bc9</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<tem:generaToken xmlns:tem="http://tempuri.org/">
     <tem:NoCredencial>{$numCredencial}</tem:NoCredencial>     
     <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>
     <tem:MedioContacto>{$MedioContacto}</tem:MedioContacto>
     <tem:DatoValidacion>{$body/usu:validarMedioContactoRequest/usu:usuario/usu:medioContacto/usu:valorContacto/text()}</tem:DatoValidacion>
     <tem:VigenciaHoras>{$vigenciaToken}</tem:VigenciaHoras>
</tem:generaToken>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6179</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'ValidaMedioContacto(CRM)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N746c</con2:id>
                                            <con1:case id="_BranchId-af1005a.N47cae7a6.0.15c8e1ef744.N746b">
                                                <con1:condition>
                                                    <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:Codigo=0</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:assign varName="token">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7fc4</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:DetalleRespuesta/text()</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:actions>
                                            </con1:case>
                                            <con1:default>
                                                <con1:assign varName="serviceName">
                                                    <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7e34</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>concat($serviceName,' - ',$generaTokenRes/*:generaTokenResult/*:Mensaje)</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                                <con1:Error>
                                                    <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7468</con2:id>
                                                    <con1:errCode>NMP-100</con1:errCode>
                                                    <con1:message>Error en el Servicio</con1:message>
                                                </con1:Error>
                                            </con1:default>
                                        </con1:ifThenElse>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7dc4</con2:id>
                                    <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>updateCliente</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">updateFlujoReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">updateFlujoRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="updateFlujoReq">
                                            <con2:id>_ActionId-af1005a.N47cae7a6.0.15c8e1ef744.N7bfc</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<nmp:updateClienteRequest  xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
     <nmp:numeroDeCredencial>{$numCredencial}</nmp:numeroDeCredencial>     
     <nmp:DatosUsuario>            
        <nmp:estatus>2</nmp:estatus>            
        <nmp:tipoFlujo>1</nmp:tipoFlujo>
     </nmp:DatosUsuario>
</nmp:updateClienteRequest>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N61ac</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'ActualizaEstadoCliente(CRM)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform/>
                                </con1:wsCallout>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7fcd</con2:id>
                                    <con1:service ref="Utileria/MensajeriaUtil/Proxy Services/NMPMensajeriaSoapSyncPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>enviaMensajeSMS</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">enviarMensajeReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">enviarMensajeRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="enviarMensajeReq">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7fca</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<nmp:enviaMensajeSMSrequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSMS">    
    <nmp:telefonoCliente>{$body/usu:validarMedioContactoRequest/usu:usuario/usu:medioContacto/usu:valorContacto/text()}</nmp:telefonoCliente>
    <nmp:mensajeSMS>{concat('Tu codigo de validacion para completar tu registro es: ',$token)}</nmp:mensajeSMS>
</nmp:enviaMensajeSMSrequest>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N610c</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'EnviarMensajeSMS'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform/>
                                </con1:wsCallout>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N50e4">
                            <con1:condition>
                                <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado=2 or $consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado=3 or $consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='2']/tns:idEstado=2 or $consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='3']/tns:idEstado=2</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:ifThenElse>
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7999</con2:id>
                                    <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N7998">
                                        <con1:condition>
                                            <con2:xqueryText>$body/usu:validarMedioContactoRequest/usu:usuario/usu:datosValidacion/@reenvioToken='true'</con2:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:wsCallout>
                                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N769d</con2:id>
                                                <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con1:operation>generaToken</con1:operation>
                                                <con1:request>
                                                    <con1:body wrapped="false">generaTokenReq</con1:body>
                                                    <con1:header>header</con1:header>
                                                </con1:request>
                                                <con1:response>
                                                    <con1:body wrapped="false">generaTokenRes</con1:body>
                                                </con1:response>
                                                <con1:requestTransform>
                                                    <con1:assign varName="generaTokenReq">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N769c</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText><![CDATA[<tem:generaToken xmlns:tem="http://tempuri.org/">
     <tem:NoCredencial>{$numCredencial}</tem:NoCredencial>     
     <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>
     <tem:MedioContacto>{$MedioContacto}</tem:MedioContacto>
     <tem:DatoValidacion>{$body/usu:validarMedioContactoRequest/usu:usuario/usu:medioContacto/usu:valorContacto/text()}</tem:DatoValidacion>
     <tem:VigenciaHoras>{$vigenciaToken}</tem:VigenciaHoras>
</tem:generaToken>]]></con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="serviceName">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N60a2</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>'GeneraToken(CRM)'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:requestTransform>
                                                <con1:responseTransform>
                                                    <con1:ifThenElse>
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N769b</con2:id>
                                                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N769a">
                                                            <con1:condition>
                                                                <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:Codigo=0</con2:xqueryText>
                                                            </con1:condition>
                                                            <con1:actions>
                                                                <con1:ifThenElse>
                                                                    <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7911</con2:id>
                                                                    <con1:case id="_BranchId-af10c31.3de42731.0.15d9a4249c7.N7910">
                                                                        <con1:condition>
                                                                            <con2:xqueryText>$MedioContacto='Correo'</con2:xqueryText>
                                                                        </con1:condition>
                                                                        <con1:actions>
                                                                            <con1:assign varName="tokenCRM">
                                                                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N78a6</con2:id>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:DetalleRespuesta/text()</con2:xqueryText>
                                                                                </con1:expr>
                                                                            </con1:assign>
                                                                            <con1:assign varName="llaveSecreta">
                                                                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7955</con2:id>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText>dvm:lookupValue('GestionClientes/UsuariosMonte/Resources/DVMs/ConfiguracionUsuarioMonte', 'Llave','llaveSecreta','Valor1', 'e5d6b646-d57d-49',('Parametro','Config'))</con2:xqueryText>
                                                                                </con1:expr>
                                                                            </con1:assign>
                                                                            <con1:javaCallout varName="token">
                                                                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7951</con2:id>
                                                                                <con1:archive ref="Common/JAR/utileria-nmp-encriptacion"/>
                                                                                <con1:className>utileria.nmp.encriptacion.EncriptarDesencriptarMensaje</con1:className>
                                                                                <con1:method>public static java.lang.String encriptar(java.lang.String, java.lang.String)</con1:method>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText>$tokenCRM</con2:xqueryText>
                                                                                </con1:expr>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText>$llaveSecreta</con2:xqueryText>
                                                                                </con1:expr>
                                                                                <con1:return-param-as-ref>false</con1:return-param-as-ref>
                                                                            </con1:javaCallout>
                                                                        </con1:actions>
                                                                    </con1:case>
                                                                    <con1:default>
                                                                        <con1:assign varName="token">
                                                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7699</con2:id>
                                                                            <con1:expr>
                                                                                <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:DetalleRespuesta/text()</con2:xqueryText>
                                                                            </con1:expr>
                                                                        </con1:assign>
                                                                    </con1:default>
                                                                </con1:ifThenElse>
                                                            </con1:actions>
                                                        </con1:case>
                                                        <con1:default>
                                                            <con1:assign varName="serviceName">
                                                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7d33</con2:id>
                                                                <con1:expr>
                                                                    <con2:xqueryText>concat($serviceName,' - ',$generaTokenRes/*:generaTokenResult/*:Mensaje)</con2:xqueryText>
                                                                </con1:expr>
                                                            </con1:assign>
                                                            <con1:Error>
                                                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N7697</con2:id>
                                                                <con1:errCode>NMP-100</con1:errCode>
                                                                <con1:message>Error en el Servicio</con1:message>
                                                            </con1:Error>
                                                        </con1:default>
                                                    </con1:ifThenElse>
                                                </con1:responseTransform>
                                            </con1:wsCallout>
                                            <con1:ifThenElse>
                                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N754e</con2:id>
                                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N754d">
                                                    <con1:condition>
                                                        <con2:xqueryText>$MedioContacto='Correo'</con2:xqueryText>
                                                    </con1:condition>
                                                    <con1:actions>
                                                        <con1:ifThenElse>
                                                            <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7c75</con2:id>
                                                            <con1:case id="_BranchId-af10068.N64ade893.0.15d2d6a1629.N7c74">
                                                                <con1:condition>
                                                                    <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado=3</con2:xqueryText>
                                                                </con1:condition>
                                                                <con1:actions>
                                                                    <con1:ifThenElse>
                                                                        <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7bca</con2:id>
                                                                        <con1:case id="_BranchId-af10068.N64ade893.0.15d2d6a1629.N7bc9">
                                                                            <con1:condition>
                                                                                <con2:xqueryText>$body/usu:validarMedioContactoRequest/usu:cliente/usu:numCredencial</con2:xqueryText>
                                                                            </con1:condition>
                                                                            <con1:actions>
                                                                                <con1:wsCallout>
                                                                                    <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7b96</con2:id>
                                                                                    <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                                    <con1:operation>getClientesByNumCredencial</con1:operation>
                                                                                    <con1:request>
                                                                                        <con1:body wrapped="false">getClienteByCredencialReq</con1:body>
                                                                                        <con1:header>header</con1:header>
                                                                                    </con1:request>
                                                                                    <con1:response>
                                                                                        <con1:body wrapped="false">getClienteByCredencialRes</con1:body>
                                                                                    </con1:response>
                                                                                    <con1:requestTransform>
                                                                                        <con1:assign varName="serviceName">
                                                                                            <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7b5f</con2:id>
                                                                                            <con1:expr>
                                                                                                <con2:xqueryText>'obtenerClientePorNumCredencial(CRM)'</con2:xqueryText>
                                                                                            </con1:expr>
                                                                                        </con1:assign>
                                                                                        <con1:assign varName="getClienteByCredencialReq">
                                                                                            <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7b62</con2:id>
                                                                                            <con1:expr>
                                                                                                <con2:xqueryText>&lt;nmp1:getClientesByNumCredencialRequest xmlns:nmp1="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
  &lt;nmp1:numCredencial>{$body/usu:validarMedioContactoRequest/usu:cliente/usu:numCredencial/text()}&lt;/nmp1:numCredencial>       
&lt;/nmp1:getClientesByNumCredencialRequest></con2:xqueryText>
                                                                                            </con1:expr>
                                                                                        </con1:assign>
                                                                                    </con1:requestTransform>
                                                                                    <con1:responseTransform>
                                                                                        <con1:assign varName="nombreCliente">
                                                                                            <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7b2b</con2:id>
                                                                                            <con1:expr>
                                                                                                <con2:xqueryText>$getClienteByCredencialRes/*:Cliente/*:nombre/text()</con2:xqueryText>
                                                                                            </con1:expr>
                                                                                        </con1:assign>
                                                                                    </con1:responseTransform>
                                                                                </con1:wsCallout>
                                                                            </con1:actions>
                                                                        </con1:case>
                                                                        <con1:default/>
                                                                    </con1:ifThenElse>
                                                                    <con1:wsCallout>
                                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N744e</con2:id>
                                                                        <con1:service ref="Utileria/EnvioCorreoUtil/Proxy Services/NMPEnvioCorreoUtilPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                                        <con1:operation>enviarCorreo</con1:operation>
                                                                        <con1:request>
                                                                            <con1:body wrapped="false">enviaCorreoReq</con1:body>
                                                                            <con1:header>header</con1:header>
                                                                        </con1:request>
                                                                        <con1:response>
                                                                            <con1:body wrapped="false">enviaCorreoRes</con1:body>
                                                                        </con1:response>
                                                                        <con1:requestTransform>
                                                                            <con1:assign varName="contenidoCorreo">
                                                                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7bd7</con2:id>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText><![CDATA[string(concat("<p>Estimado/a ",$nombreCliente,",</p>

<p>Gracias por registrarte en Mi Monte. </p>
<p>Para acceder a tu cuenta, por favor haz clic en el siguiente enlace: </p>",
$dominioMonte,"=",$token,"&amp;u=",$body/usu:validarMedioContactoRequest/usu:usuario/usu:nombreUsuario,"
      
<p>En Mi Monte podrás realizar:</p>

<ul>
<p><li> Consulta tu boleta de empeño</li></p>
<p><li>Pagos en línea </li></p>
<p><li>Consulta de tus boletas próximas a vencer</li></p>
<p><li>Consulta de tus boletas vencidas</li></p>
</ul>

<p>Si necesitas ayuda adicional, por favor comunícate con nosotros al 01800 EL MONTE (018003566683)</p>"))]]></con2:xqueryText>
                                                                                </con1:expr>
                                                                            </con1:assign>
                                                                            <con1:assign varName="enviaCorreoReq">
                                                                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N744d</con2:id>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText><![CDATA[<env:envioCorreoRequest xmlns:env="http://servicios.montedepiedad.com.mx/NMP/Schema/EnvioCorreoUtil">
    <env:para>{$body/usu:validarMedioContactoRequest/usu:usuario/usu:nombreUsuario/text()}</env:para>
    <env:de>notificaciones@montepiedad.com.mx</env:de>
    <env:asunto>Activa tu cuenta Mi Monte</env:asunto>
    <env:contenidoHTML>{$contenidoCorreo}</env:contenidoHTML>	
</env:envioCorreoRequest>]]></con2:xqueryText>
                                                                                </con1:expr>
                                                                            </con1:assign>
                                                                            <con1:assign varName="serviceName">
                                                                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6064</con2:id>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText>'EnviarCorreo(SBLUE)'</con2:xqueryText>
                                                                                </con1:expr>
                                                                            </con1:assign>
                                                                        </con1:requestTransform>
                                                                        <con1:responseTransform>
                                                                            <con1:assign varName="mensajeResponse">
                                                                                <con2:id>_ActionId-af10068.N3a062e27.0.15d67041a4f.N7efc</con2:id>
                                                                                <con1:expr>
                                                                                    <con2:xqueryText>'Se ha reenviado a su correo el código exitosamente'</con2:xqueryText>
                                                                                </con1:expr>
                                                                            </con1:assign>
                                                                        </con1:responseTransform>
                                                                    </con1:wsCallout>
                                                                </con1:actions>
                                                            </con1:case>
                                                            <con1:default>
                                                                <con1:Error>
                                                                    <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7c0b</con2:id>
                                                                    <con1:errCode>NMP-113</con1:errCode>
                                                                    <con1:message>Estatus no válido para el reenvío de token</con1:message>
                                                                </con1:Error>
                                                            </con1:default>
                                                        </con1:ifThenElse>
                                                    </con1:actions>
                                                </con1:case>
                                                <con1:default>
                                                    <con1:wsCallout>
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N73e5</con2:id>
                                                        <con1:service ref="Utileria/MensajeriaUtil/Proxy Services/NMPMensajeriaSoapSyncPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                        <con1:operation>enviaMensajeSMS</con1:operation>
                                                        <con1:request>
                                                            <con1:body wrapped="false">enviarMensajeReq</con1:body>
                                                            <con1:header>header</con1:header>
                                                        </con1:request>
                                                        <con1:response>
                                                            <con1:body wrapped="false">enviarMensajeRes</con1:body>
                                                        </con1:response>
                                                        <con1:requestTransform>
                                                            <con1:assign varName="enviarMensajeReq">
                                                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N73e4</con2:id>
                                                                <con1:expr>
                                                                    <con2:xqueryText><![CDATA[<nmp:enviaMensajeSMSrequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSMS">    
    <nmp:telefonoCliente>{$body/usu:validarMedioContactoRequest/usu:usuario/usu:medioContacto/usu:valorContacto/text()}</nmp:telefonoCliente>
    <nmp:mensajeSMS>{concat('Tu codigo de validacion para completar tu registro es: ',$token)}</nmp:mensajeSMS>
</nmp:enviaMensajeSMSrequest>]]></con2:xqueryText>
                                                                </con1:expr>
                                                            </con1:assign>
                                                            <con1:assign varName="serviceName">
                                                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6030</con2:id>
                                                                <con1:expr>
                                                                    <con2:xqueryText>'EnviarMensajeSMS'</con2:xqueryText>
                                                                </con1:expr>
                                                            </con1:assign>
                                                        </con1:requestTransform>
                                                        <con1:responseTransform>
                                                            <con1:assign varName="mensajeResponse">
                                                                <con2:id>_ActionId-af10068.N3a062e27.0.15d67041a4f.N7ec8</con2:id>
                                                                <con1:expr>
                                                                    <con2:xqueryText>'Se ha reenviado a su celular el código exitosamente'</con2:xqueryText>
                                                                </con1:expr>
                                                            </con1:assign>
                                                        </con1:responseTransform>
                                                    </con1:wsCallout>
                                                </con1:default>
                                            </con1:ifThenElse>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:wsCallout>
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4a55</con2:id>
                                            <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                            <con1:operation>validaToken</con1:operation>
                                            <con1:request>
                                                <con1:body wrapped="false">validaTokenReq</con1:body>
                                                <con1:header>header</con1:header>
                                            </con1:request>
                                            <con1:response>
                                                <con1:body wrapped="false">validaTokenRes</con1:body>
                                            </con1:response>
                                            <con1:requestTransform>
                                                <con1:assign varName="validaTokenReq">
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4a54</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText><![CDATA[<tem:validaToken xmlns:tem="http://tempuri.org/">    
    <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>             
    <tem:Codigo>{$body/usu:validarMedioContactoRequest/usu:usuario/usu:datosValidacion/usu:token/text()}</tem:Codigo>    
</tem:validaToken>]]></con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                                <con1:assign varName="serviceName">
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4a53</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>'ValidarToken(CRM)'</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                            </con1:requestTransform>
                                            <con1:responseTransform>
                                                <con1:ifThenElse>
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4a52</con2:id>
                                                    <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N4a51">
                                                        <con1:condition>
                                                            <con2:xqueryText>$validaTokenRes/*:validaTokenResult/*:Codigo=0</con2:xqueryText>
                                                        </con1:condition>
                                                        <con1:actions/>
                                                    </con1:case>
                                                    <con1:default>
                                                        <con1:assign varName="serviceName">
                                                            <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7cce</con2:id>
                                                            <con1:expr>
                                                                <con2:xqueryText>concat($serviceName,' - ',$validaTokenRes/*:validaTokenResult/*:Mensaje)</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:Error>
                                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4a4f</con2:id>
                                                            <con1:errCode>NMP-100</con1:errCode>
                                                            <con1:message>Error en el Servicio</con1:message>
                                                        </con1:Error>
                                                    </con1:default>
                                                </con1:ifThenElse>
                                            </con1:responseTransform>
                                        </con1:wsCallout>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4363</con2:id>
                                            <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N4362">
                                                <con1:condition>
                                                    <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado=3</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:assign varName="idFlujo">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N42f6</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>1</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="estatusFlujo">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4329</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>4</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="mensajeResponse">
                                                        <con2:id>_ActionId-af10068.N3a062e27.0.15d67041a4f.N7ec6</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>'Validación de correo completada'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:actions>
                                            </con1:case>
                                            <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N435e">
                                                <con1:condition>
                                                    <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='2']/tns:idEstado=2</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:assign varName="idFlujo">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N42c2</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>2</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="estatusFlujo">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N428c</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>3</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="mensajeResponse">
                                                        <con2:id>_ActionId-af10068.N3a062e27.0.15d67041a4f.N7ec3</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>'Validación de SMS completada'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:actions>
                                            </con1:case>
                                            <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N435c">
                                                <con1:condition>
                                                    <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='3']/tns:idEstado=2</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:assign varName="idFlujo">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N428f</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>3</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="estatusFlujo">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N428a</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>3</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="mensajeResponse">
                                                        <con2:id>_ActionId-af10068.N3a062e27.0.15d67041a4f.N7ec0</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>'Validación de SMS completada'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:actions>
                                            </con1:case>
                                            <con1:default>
                                                <con1:Error>
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4225</con2:id>
                                                    <con1:errCode>NMP-109</con1:errCode>
                                                    <con1:message>Estatus del Flujo Incorrecto</con1:message>
                                                </con1:Error>
                                            </con1:default>
                                        </con1:ifThenElse>
                                        <con1:wsCallout>
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N44cc</con2:id>
                                            <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                            <con1:operation>updateCliente</con1:operation>
                                            <con1:request>
                                                <con1:body wrapped="false">updateFlujoReq</con1:body>
                                                <con1:header>header</con1:header>
                                            </con1:request>
                                            <con1:response>
                                                <con1:body wrapped="false">updateFlujoRes</con1:body>
                                            </con1:response>
                                            <con1:requestTransform>
                                                <con1:assign varName="updateFlujoReq">
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N44cb</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText><![CDATA[<nmp:updateClienteRequest  xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
     <nmp:numeroDeCredencial>{$numCredencial}</nmp:numeroDeCredencial>
     <nmp:DatosUsuario>            
        <nmp:estatus>{$estatusFlujo}</nmp:estatus>            
        <nmp:tipoFlujo>{$idFlujo}</nmp:tipoFlujo>
     </nmp:DatosUsuario>
</nmp:updateClienteRequest>]]></con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                                <con1:assign varName="serviceName">
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N44ca</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>'ActualizaEstadoCliente(CRM)'</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                            </con1:requestTransform>
                                            <con1:responseTransform/>
                                        </con1:wsCallout>
                                    </con1:default>
                                </con1:ifThenElse>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:Error>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N50b0</con2:id>
                                <con1:errCode>NMP-107</con1:errCode>
                                <con1:message>No se ha validado la información del cliente</con1:message>
                            </con1:Error>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.24987ae2.0.15c3ca6313b.N7e5f">
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7e5e" name="StageResponse">
                <con:context/>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-af100c3.6aaed49a.0.15c40e39bfd.N7f64</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap:Body xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
        <usu:solicitarAltaResponse xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
            <!--Optional:-->
            <usu:cliente>
                <usu:estadoRegistro>Pendiente</usu:estadoRegistro>
            </usu:cliente>
            <usu:respuesta>
                <usu:codigo>0</usu:codigo>
                <usu:mensaje>Registro pendiente de validación</usu:mensaje>
            </usu:respuesta>
        </usu:solicitarAltaResponse>
    </soap:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-af100c3.24987ae2.0.15c3ca6313b.N7dbc">
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6f31" name="StageObtieneIdCliente">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6f30</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>obtenerClientePorUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">getClienteUsuarioReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">getClienteUsuarioRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="getClienteUsuarioReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6f2f</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:obtenerClientePorUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:usuarioMonte>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:usuarioMonte>
&lt;/nmp:obtenerClientePorUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5bca</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ObtenerClientePorUsuario(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="idCliente">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6f2c</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:idCliente/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="numCredencial">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N6f2b</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:numeroDeCredencial/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="telefono">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7ffe</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:Contacto/*:ListaTelefonos/*:Telefono[./*:tipoTelefono='3']/*:numeroTelefonico/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="nombreCliente">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7d95</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:nombre/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N529d" name="StageValidacionMedioContacto">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4222</con2:id>
                        <con1:service ref="GestionClientes/UsuariosMonte/ProxyServices/NMPUsuariosMontePXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>validarMedioContacto</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">validaMedioContactoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">validaMedioContactoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="validaMedioContactoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N421f</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<usu:validarMedioContactoRequest xmlns:usu="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte">
    <usu:usuario>
        <usu:nombreUsuario>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario/text()}</usu:nombreUsuario>
        <usu:medioContacto>
            <usu:contactoPor>{1}</usu:contactoPor>
            <usu:valorContacto>{$telefono}</usu:valorContacto>
        </usu:medioContacto>
        <usu:datosValidacion reenvioToken="false">  
           <usu:token>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:datosValidacion/usu:token/text()}</usu:token>
        </usu:datosValidacion>
    </usu:usuario>
    <usu:cliente>
        <usu:numCredencial>{$numCredencial}</usu:numCredencial>
    </usu:cliente>
</usu:validarMedioContactoRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N41b3</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N41b2">
                                    <con1:condition>
                                        <con2:xqueryText>$validaMedioContactoRes/*:respuesta/*:codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N76ab</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$validaMedioContactoRes/*:respuesta/*:Mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N41b1</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6a46" name="StageEliminaUsuario">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7ffb</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>borrarUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">borrarUsuarioRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">borrarUsuarioResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7406</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'BorrarUsuario(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="borrarUsuarioRequest">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7ff8</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:borrarUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    &lt;nmp:Username>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:Username>
&lt;/nmp:borrarUsuarioRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6a45" name="StageCrearUsuario">
                <con:context>
                    <con2:userNsDecl prefix="utl" namespace="http://servicios.montedepiedad.com.mx/NMP/Transformations/UtilidadesFecha"/>
                    <con2:dependencies>
                        <con2:importModule ref="Common/XQ/UtilidadServiciosAmazonXQ"/>
                    </con2:dependencies>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7f90</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>crearUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">crearUsuarioRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">crearUsuarioResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N73d3</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'AltaUsuario(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="updated_at">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7edf</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>utl:obtenerTimestampDeFecha(utl:agregarHorasEnFechaHora(fn:current-dateTime(),xs:int('5')))</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="crearUsuarioRequest">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7f8f</con2:id>
                                <con1:expr>
                                    <con2:xsltTransform>
                                        <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/TrAltaUsuarioToCognitoCrearUsuario"/>
                                        <con2:input>$body</con2:input>
                                        <con2:param name="operacion">
                                            <con2:path>$inbound/ctx:service/ctx:operation</con2:path>
                                        </con2:param>
                                        <con2:param name="updated_at">
                                            <con2:path>$updated_at</con2:path>
                                        </con2:param>
                                    </con2:xsltTransform>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6a44" name="StageIniciaAuth">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="ai" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7f24</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>autenticarUsuario</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">autenticarUsuarioRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">autenticarUsuarioResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N73a0</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'AutenticarUsuario(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="autenticarUsuarioRequest">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7f23</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:autenticarUsuarioRequest
    xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    <nmp:flujoAutenticacion>ADMIN_NO_SRP_AUTH</nmp:flujoAutenticacion>
    <nmp:parametrosAutenticacion>
        <nmp:parametro>
            <nmp:nombre>USERNAME</nmp:nombre>
            <nmp:valor>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario/text()}</nmp:valor>
        </nmp:parametro>
        <nmp:parametro>
            <nmp:nombre>PASSWORD</nmp:nombre>
            <nmp:valor>{concat('Nmp$0',$body/usu:registrarContrasenaRequest/usu:usuario/usu:datosValidacion/usu:token/text())}</nmp:valor>
        </nmp:parametro>
    </nmp:parametrosAutenticacion>
</nmp:autenticarUsuarioRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:assign varName="sesion">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7f22</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$autenticarUsuarioResponse/ai:informacionCambio/ai:sesion</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N6a43" name="StageAuthChallenge">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7eba</con2:id>
                        <con1:service ref="GestionIdentidades/Cognito/Proxy Services/NMPAdministradorIdentidadesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>actualizarParamAutenticacion</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">actualizarParamRequest</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">actualizarParamResponse</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N736d</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ConfirmarContrasena(Cognito)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="actualizarParamRequest">
                                <con2:id>_ActionId-af004be.3b6e7a43.0.15cf552feaf.N7eb9</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<nmp:actualizarParamAutenticacionRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPAdministradorIdentidades">
    <nmp:nombreCambio>NEW_PASSWORD_REQUIRED</nmp:nombreCambio> 
    <nmp:respuestaCambios>
        <!--1 or more repetitions:-->
        <nmp:parametro>
            <nmp:nombre>USERNAME</nmp:nombre>
            <nmp:valor>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario/text()}</nmp:valor>           
        </nmp:parametro>
        <nmp:parametro>
            <nmp:nombre>NEW_PASSWORD</nmp:nombre>
            <nmp:valor>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:contrasena/text()}</nmp:valor>           
        </nmp:parametro>
    </nmp:respuestaCambios>
    <!--Optional:-->
    <nmp:Sesion>{$sesion/text()}</nmp:Sesion>
</nmp:actualizarParamAutenticacionRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N69aa" name="StageEnviaCorreo">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N69a9</con2:id>
                        <con1:service ref="Utileria/EnvioCorreoUtil/Proxy Services/NMPEnvioCorreoUtilPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>enviarCorreo</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">enviaCorreoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">enviaCorreoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="contenidoCorreo">
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7d98</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[string(concat("<p>Estimado/a ",$nombreCliente ,",</p> 
<p>La contraseña de tu cuenta ",$body/usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario/text() ," se restableció correctamente.</p>
<p>Si necesitas ayuda adicional, comunícate con nosotros a la línea 01800 EL MONTE (018003566683)</p> ")
)]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="enviaCorreoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N69a8</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<env:envioCorreoRequest xmlns:env="http://servicios.montedepiedad.com.mx/NMP/Schema/EnvioCorreoUtil">
    <env:para>{$body/usu:registrarContrasenaRequest/usu:usuario/usu:nombreUsuario/text()}</env:para>
    <env:de>notificaciones@montepiedad.com.mx</env:de>
    <env:asunto>Notificación Mi Monte</env:asunto>
    <env:contenidoHTML>{$contenidoCorreo}</env:contenidoHTML>
</env:envioCorreoRequest>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5af6</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'EnviarCorreo(SBLUE)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-af100c3.24987ae2.0.15c3ca6313b.N7e98">
            <con:stage id="_StageId-af10068.N64ade893.0.15d2d6a1629.N7ee2" name="StageMedioContacto">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7f87</con2:id>
                        <con1:case id="_BranchId-af10068.N64ade893.0.15d2d6a1629.N7f86">
                            <con1:condition>
                                <con2:xqueryText>$body/usu:actualizarDatosRequest/usu:usuario/usu:medioContacto/usu:contactoPor=1</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="MedioContacto">
                                    <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7f85</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>'Telefono'</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:Error>
                                <con2:id>_ActionId-af10068.N64ade893.0.15d2d6a1629.N7f82</con2:id>
                                <con1:errCode>NMP-112</con1:errCode>
                                <con1:message>Medio de Validación Incorrecto</con1:message>
                            </con1:Error>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af100c3.24987ae2.0.15c3ca6313b.N7e97" name="StageObtieneEstadoFlujo">
                <con:context>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="tns" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:wsCallout>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N59f1</con2:id>
                        <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>consultarEstadoRegistro</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">consultaEstadoReq</con1:body>
                            <con1:header>header</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">consultaEstadoRes</con1:body>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="numCredencial">
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7fe3</con2:id>
                                <con1:expr>
                                    <con2:xqueryTransform>
                                        <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/UMOperacionesXQ"/>
                                        <con2:param name="funcion">
                                            <con2:path>'numCredencial'</con2:path>
                                        </con2:param>
                                        <con2:param name="param1">
                                            <con2:path>$body/usu:actualizarDatosRequest/usu:cliente/usu:numCredencial/text()</con2:path>
                                        </con2:param>
                                    </con2:xqueryTransform>
                                </con1:expr>
                            </con1:assign>
                            <con1:replace varName="body" contents-only="true">
                                <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7fdf</con2:id>
                                <con1:location>
                                    <con2:xpathText>./usu:actualizarDatosRequest/usu:cliente/usu:numCredencial</con2:xpathText>
                                </con1:location>
                                <con1:expr>
                                    <con2:xqueryText>$numCredencial/text()</con2:xqueryText>
                                </con1:expr>
                            </con1:replace>
                            <con1:assign varName="consultaEstadoReq">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N59ee</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;nmp:consultarEstadoRegistroRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:numCredencial>{$body/usu:actualizarDatosRequest/usu:cliente/usu:numCredencial/text()}&lt;/nmp:numCredencial>
&lt;/nmp:consultarEstadoRegistroRequest></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="serviceName">
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N59ba</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>'ConsultarEstadoRegistro(CRM)'</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:ifThenElse>
                                <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N594d</con2:id>
                                <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N594c">
                                    <con1:condition>
                                        <con2:xqueryText>$consultaEstadoRes/*:codigo=0</con2:xqueryText>
                                    </con1:condition>
                                    <con1:actions/>
                                </con1:case>
                                <con1:default>
                                    <con1:assign varName="serviceName">
                                        <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7678</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>concat($serviceName,' - ',$consultaEstadoRes/*:Mensaje)</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:Error>
                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N594b</con2:id>
                                        <con1:errCode>NMP-100</con1:errCode>
                                        <con1:message>Error en el Servicio</con1:message>
                                    </con1:Error>
                                </con1:default>
                            </con1:ifThenElse>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-af1008f.N5e25f397.0.15cc13f222d.N4943" name="StageValidaEstatus">
                <con:context>
                    <con2:userNsDecl prefix="nmp" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="usu" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/UsuariosMonte"/>
                    <con2:userNsDecl prefix="tns" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4942</con2:id>
                        <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N4941">
                            <con1:condition>
                                <con2:xqueryText>$consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='1']/tns:idEstado/text()='4' or $consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='2']/tns:idEstado/text()='3' or $consultaEstadoRes/tns:cliente/tns:estadosFlujo/tns:estadoFlujo[./tns:idFlujo='3']/tns:idEstado/text()='3'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5838</con2:id>
                                    <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>obtenerClientePorUsuario</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">getClienteUsuarioReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">getClienteUsuarioRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="getClienteUsuarioReq">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5837</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>&lt;nmp:obtenerClientePorUsuarioRequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    &lt;nmp:usuarioMonte>{$body/usu:actualizarDatosRequest/usu:usuario/usu:nombreUsuario/text()}&lt;/nmp:usuarioMonte>
&lt;/nmp:obtenerClientePorUsuarioRequest></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5836</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'ObtenerClientePorUsuario(CRM)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:assign varName="idCliente">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5833</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>$getClienteUsuarioRes/*:Cliente/*:idCliente/text()</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N58cd</con2:id>
                                    <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>updateCliente</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">updateClienteReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">updateClienteRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:replace varName="updateClienteReq">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N5826</con2:id>
                                            <con1:expr>
                                                <con2:xsltTransform>
                                                    <con2:resource ref="GestionClientes/UsuariosMonte/Resources/Transformations/TrActualizarDatosReqToUpdateClienteReq"/>
                                                    <con2:input>$body/*</con2:input>
                                                    <con2:param name="idCliente">
                                                        <con2:path>$idCliente</con2:path>
                                                    </con2:param>
                                                </con2:xsltTransform>
                                            </con1:expr>
                                        </con1:replace>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N58cb</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'ActualizaCliente(CRM)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform/>
                                </con1:wsCallout>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4729</con2:id>
                                    <con1:service ref="GestionClientes/UsuariosMonte/Business Services/CRMTokensSvcBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>generaToken</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">generaTokenReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">generaTokenRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="generaTokenReq">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4728</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<tem:generaToken xmlns:tem="http://tempuri.org/">
     <tem:NoCredencial>{$body/usu:actualizarDatosRequest/usu:cliente/usu:numCredencial/text()}</tem:NoCredencial>     
     <tem:FuenteDato>{$header/nmp:headerMessage/nmp:idConsumidor/text()}</tem:FuenteDato>
     <tem:MedioContacto>{$MedioContacto}</tem:MedioContacto>
     <tem:DatoValidacion>{$body/usu:actualizarDatosRequest/usu:usuario/usu:datoActualizar/usu:telefono/usu:numeroTelefono/text()}</tem:DatoValidacion>
     <tem:VigenciaHoras>24</tem:VigenciaHoras>
</tem:generaToken>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4727</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'GeneraToken(CRM)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4726</con2:id>
                                            <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N4725">
                                                <con1:condition>
                                                    <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:Codigo=0</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:assign varName="token">
                                                        <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4724</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>$generaTokenRes/*:generaTokenResult/*:DetalleRespuesta/text()</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:actions>
                                            </con1:case>
                                            <con1:default>
                                                <con1:assign varName="serviceName">
                                                    <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7610</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>concat($serviceName,' - ',$generaTokenRes/*:generaTokenResult/*:Mensaje)</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                                <con1:Error>
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4722</con2:id>
                                                    <con1:errCode>NMP-100</con1:errCode>
                                                    <con1:message>Error en el Servicio</con1:message>
                                                </con1:Error>
                                            </con1:default>
                                        </con1:ifThenElse>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N46a3</con2:id>
                                    <con1:service ref="Utileria/MensajeriaUtil/Proxy Services/NMPMensajeriaSoapSyncPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>enviaMensajeSMS</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">enviarMensajeReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">enviarMensajeRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="enviarMensajeReq">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N46a2</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<nmp:enviaMensajeSMSrequest xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPSMS">    
    <nmp:telefonoCliente>{$body/usu:actualizarDatosRequest/usu:usuario/usu:datoActualizar/usu:telefono/usu:numeroTelefono/text()}</nmp:telefonoCliente>
    <nmp:mensajeSMS>{concat('Su codigo de validacion para completar la actualizacion es: ',$token)}</nmp:mensajeSMS>
</nmp:enviaMensajeSMSrequest>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N46a1</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'EnviarMensajeSMS'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N46a0</con2:id>
                                            <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N469f">
                                                <con1:condition>
                                                    <con2:xqueryText>$enviarMensajeRes/*:respuesta/text() ='OK'</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions/>
                                            </con1:case>
                                            <con1:default>
                                                <con1:Error>
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N469e</con2:id>
                                                    <con1:errCode>OSB-382500</con1:errCode>
                                                    <con1:message>Error en el Servicio</con1:message>
                                                </con1:Error>
                                            </con1:default>
                                        </con1:ifThenElse>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                                <con1:wsCallout>
                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4588</con2:id>
                                    <con1:service ref="GestionClientes/Clientes/Proxy Services/NMPClientesSoapPXY" xsi:type="ref:ProxyRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>updateCliente</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">updateFlujoReq</con1:body>
                                        <con1:header>header</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">updateFlujoRes</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="updateFlujoReq">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4587</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<nmp:updateClienteRequest  xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPCliente">
    <nmp:idCliente>{$idCliente}</nmp:idCliente>
     <nmp:numeroDeCredencial>{$body/usu:actualizarDatosRequest/usu:cliente/usu:numCredencial/text()}</nmp:numeroDeCredencial>
     <nmp:DatosUsuario>            
        <nmp:estatus>2</nmp:estatus>            
        <nmp:tipoFlujo>2</nmp:tipoFlujo>
     </nmp:DatosUsuario>
</nmp:updateClienteRequest>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                        <con1:assign varName="serviceName">
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4586</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText>'ActualizaEstadoCliente(CRM)'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4585</con2:id>
                                            <con1:case id="_BranchId-af1008f.N5e25f397.0.15cc13f222d.N4584">
                                                <con1:condition>
                                                    <con2:xqueryText>$updateFlujoRes/*:respuesta ='Estatus actualizado'</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions/>
                                            </con1:case>
                                            <con1:default>
                                                <con1:Error>
                                                    <con2:id>_ActionId-af1008f.N5e25f397.0.15cc13f222d.N4583</con2:id>
                                                    <con1:errCode>OSB-382500</con1:errCode>
                                                    <con1:message>Error en el Servicio</con1:message>
                                                </con1:Error>
                                            </con1:default>
                                        </con1:ifThenElse>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:Error>
                                <con2:id>_ActionId-af10c31.54e14b43.0.15d1db89a49.N7675</con2:id>
                                <con1:errCode>NMP-111</con1:errCode>
                                <con1:message>Actualización de datos denegada</con1:message>
                            </con1:Error>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-af100c3.131fc352.0.15c4184bb6f.N7f9d">
            <con:stage id="_StageId-af100c3.131fc352.0.15c4184bb6f.N7f9b" name="StageResponse">
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="header">
                        <con2:id>_ActionId-af100c3.131fc352.0.15c4184bb6f.N7f98</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;soap:Header xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
        &lt;nmph:headerMessageResponse xmlns:nmph="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">
            {$header/nmph:headerMessage/*}
        &lt;/nmph:headerMessageResponse>
    &lt;/soap:Header></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:rename varName="header">
                        <con2:id>_ActionId-af10c31.3de42731.0.15d9a4249c7.N7968</con2:id>
                        <con2:disabled>true</con2:disabled>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                        <con1:localname>headerMessageResponse</con1:localname>
                    </con1:rename>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:pipeline-node name="PipelinePairHeader">
                <con:request>request-af100c3.131fc352.0.15c4184bb6f.N7f9e</con:request>
                <con:response>response-af100c3.131fc352.0.15c4184bb6f.N7f9d</con:response>
            </con:pipeline-node>
            <con:branch-node type="operation" id="_FlowId-af100c3.24987ae2.0.15c3ca6313b.N7f38" name="BranchNodeUsuariosMonte">
                <con:context/>
                <con:branch-table>
                    <con:branch name="validarDatos">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairValidarDatos">
                                <con:request>request-af100c3.24987ae2.0.15c3ca6313b.N7f37</con:request>
                                <con:response>response-af100c3.24987ae2.0.15c3ca6313b.N7f36</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="validarMedioContacto">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairValidarMedio">
                                <con:request>request-af100c3.24987ae2.0.15c3ca6313b.N7ecf</con:request>
                                <con:response>response-af100c3.24987ae2.0.15c3ca6313b.N7ecd</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="actualizarDatos">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairActualizarDatos">
                                <con:request>request-af100c3.24987ae2.0.15c3ca6313b.N7e98</con:request>
                                <con:response>response-af100c3.24987ae2.0.15c3ca6313b.N7e96</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="solicitarAlta">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairSolicitarAlta">
                                <con:request>request-af100c3.24987ae2.0.15c3ca6313b.N7e61</con:request>
                                <con:response>response-af100c3.24987ae2.0.15c3ca6313b.N7e5f</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="solicitarActivacion">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairSolicitarActivacion">
                                <con:request>request-af100c3.24987ae2.0.15c3ca6313b.N7e2a</con:request>
                                <con:response>response-af100c3.24987ae2.0.15c3ca6313b.N7e28</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="solicitarReinicioContrasena">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairSolicitarReinicioPass">
                                <con:request>request-af100c3.24987ae2.0.15c3ca6313b.N7df3</con:request>
                                <con:response>response-af100c3.24987ae2.0.15c3ca6313b.N7df1</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="registrarContrasena">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairRegistraContrasena">
                                <con:request>request-af100c3.24987ae2.0.15c3ca6313b.N7dbc</con:request>
                                <con:response>response-af100c3.24987ae2.0.15c3ca6313b.N7dba</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow/>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con:router>
</con:pipelineEntry>