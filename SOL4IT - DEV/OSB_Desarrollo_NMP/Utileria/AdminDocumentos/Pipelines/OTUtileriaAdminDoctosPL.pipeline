<?xml version="1.0" encoding="UTF-8"?>
<con:pipelineEntry xmlns:con="http://www.bea.com/wli/sb/pipeline/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:con1="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con2="http://www.bea.com/wli/sb/stages/config">
    <con:coreEntry>
        <con:binding type="SOAP" isSoap12="false" xsi:type="con:SoapBindingType">
            <con:wsdl ref="Utileria/AdminDocumentos/Resources/WSDLs/NMPUtileriaAdminDoctosWSDL"/>
            <con:binding>
                <con:name>OpenTextAdminDoctosSOAP11Binding</con:name>
                <con:namespace>http://servicios.montedepiedad.com.mx/NMP/Service/Utileria/OpenTextSvc</con:namespace>
            </con:binding>
        </con:binding>
        <oper:operations xmlns:oper="http://xmlns.oracle.com/servicebus/pipeline/operations">
            <oper:logging enabled="false" level="debug"/>
            <oper:reporting>false</oper:reporting>
        </oper:operations>
        <con:xqConfiguration>
            <con:snippetVersion>1.0</con:snippetVersion>
        </con:xqConfiguration>
    </con:coreEntry>
    <con:router errorHandler="error-N3f57c7ff.N30a15aa1.0.151eb1f54d7.N7e03">
        <con:pipeline type="request" name="request-N3f57c7ff.N77f15b43.0.15212daffa7.N79b0">
            <con:stage id="_StageId-N3f57c7ff.5de6dca.0.156c8092c35.N7f88" name="StageValidacion">
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e07</con2:id>
                        <con1:schema ref="Utileria/AdminDocumentos/Resources/Schemas/NMPAdministraDocumentosXSD"/>
                        <con1:schemaElement xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">open:getIdNodoRequest</con1:schemaElement>
                        <con1:varName>body</con1:varName>
                        <con1:location>
                            <con2:xpathText>./open:getIdNodoRequest</con2:xpathText>
                        </con1:location>
                        <con1:resultVarName/>
                    </con1:validate>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.4963813.0.152cd7e9269.N7ffe</con2:id>
                        <con2:disabled>true</con2:disabled>
                        <con1:schema ref="Common/XSD/NMPStandardHeader"/>
                        <con1:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con1:schemaElement>
                        <con1:varName>header</con1:varName>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.5de6dca.0.156c8092c35.N7f82</con2:id>
                        <con1:schema ref="Utileria/AdminDocumentos/Resources/Schemas/NMPAdministraDocumentosXSD"/>
                        <con1:schemaElement xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">open:customHeader</con1:schemaElement>
                        <con1:varName>header</con1:varName>
                        <con1:location>
                            <con2:xpathText>./open:customHeader</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                    <con1:assign varName="OpHeader">
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79aa</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap-env:Header xmlns:soap-env="http://schemas.xmlsoap.org/soap/envelope/">
<urn:OTAuthentication xmlns:urn="urn:api.ecm.opentext.com">       
         <urn:AuthenticationToken>{$header/open:customHeader/open:tokenUser/text()}</urn:AuthenticationToken>
      </urn:OTAuthentication>
</soap-env:Header>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f57c7ff.N77f15b43.0.15212daffa7.N79af" name="StageGetIdRequest" errorHandler="error-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7ef3">
                <con:context>
                    <con2:userNsDecl prefix="corop" namespace="urn:Core.service.livelink.opentext.com"/>
                    <con2:userNsDecl prefix="consec" namespace="http://www.bea.com/wli/sb/services/security/config"/>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="opendoc" namespace="urn:DocMan.service.livelink.opentext.com"/>
                    <con2:varNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af0041d.N26ff3b9.0.15b5f33b232.N7956</con2:id>
                        <con1:case id="_BranchId-af0041d.N26ff3b9.0.15b5f33b232.N7955">
                            <con1:condition>
                                <con2:xqueryText>$body/open:getIdNodoRequest/open:BusinessWorkspace/@parentGroup = 'IdCarpeta'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="idNode">
                                    <con2:comment>Se recupera el ID de la carpeta Nivel 1</con2:comment>
                                    <con2:id>_ActionId-af0041d.N26ff3b9.0.15b5f33b232.N7917</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>$body/open:getIdNodoRequest/open:BusinessWorkspace/open:numero</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:wsCallout>
                                <con2:comment>Se recupera el ID de la carpeta Nivel 1</con2:comment>
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a6</con2:id>
                                <con1:service ref="Utileria/AdminDocumentos/BusinessSerices/OTDocumentManagementBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con1:operation>GetNodeByName</con1:operation>
                                <con1:request>
                                    <con1:body wrapped="false">GetNodeRequest</con1:body>
                                    <con1:header>OpHeader</con1:header>
                                </con1:request>
                                <con1:response>
                                    <con1:body wrapped="false">GetNodeResponse</con1:body>
                                </con1:response>
                                <con1:requestTransform>
                                    <con1:assign varName="numeroBW">
                                        <con2:comment>autocompleta con 0 a la izquierda a 10 o 13 digitos el numero del workspace, siempre que este no se mayor de 10 o 13 digitos.</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a5</con2:id>
                                        <con1:expr>
                                            <con2:xqueryTransform>
                                                <con2:resource ref="Utileria/AdminDocumentos/Resources/Transformations/OTOperacionesXQ"/>
                                                <con2:param name="funcion">
                                                    <con2:path>$body/open:getIdNodoRequest/open:BusinessWorkspace/@parentGroup</con2:path>
                                                </con2:param>
                                                <con2:param name="param1">
                                                    <con2:path>$body/open:getIdNodoRequest/open:BusinessWorkspace/open:numero/text()</con2:path>
                                                </con2:param>
                                            </con2:xqueryTransform>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:assign varName="atributoParentId">
                                        <con2:comment>Se recupera el numero de atributo de donde se recuperara el ID de la carpeta nivel 0</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.66a20af4.0.1523c1d62fc.N7ff8</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value','1','Attribute2', 'NULL',('Parameter','AmbienteOT'))</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:assign varName="parentId">
                                        <con2:comment>Se recupera el ID de la carpeta nivel 0 definido en el DV settingsAdministraDocumentos.</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a4</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value',$body/open:getIdNodoRequest/open:BusinessWorkspace/@parentGroup , $atributoParentId, '0',('Parameter','parentGroup'))</con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                    <con1:assign varName="GetNodeRequest">
                                        <con2:comment>Se genera el Request de la operación GetNodobyName</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a3</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText><![CDATA[<urn1:GetNodeByName xmlns:urn1="urn:DocMan.service.livelink.opentext.com">
         <urn1:parentID>{$parentId}</urn1:parentID>
         <urn1:name>{$numeroBW/text()}</urn1:name>       
</urn1:GetNodeByName>]]></con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                </con1:requestTransform>
                                <con1:responseTransform>
                                    <con1:ifThenElse>
                                        <con2:comment>Se valida que la respuesta devuelva un nodo con el ID del numero de workpace enviado, en caso contrario se envia un error indicando que las carpetas buscadas no existen</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7f2d</con2:id>
                                        <con1:case id="_BranchId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7f2c">
                                            <con1:condition>
                                                <con2:xqueryText>fn:count($GetNodeResponse/opendoc:GetNodeByNameResult/opendoc:ID)>0</con2:xqueryText>
                                            </con1:condition>
                                            <con1:actions>
                                                <con1:assign varName="idNode">
                                                    <con2:comment>Se recupera el ID de la carpeta Nivel 1</con2:comment>
                                                    <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a2</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>$GetNodeResponse/opendoc:GetNodeByNameResult/opendoc:ID/text()</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                            </con1:actions>
                                        </con1:case>
                                        <con1:default>
                                            <con1:assign varName="body">
                                                <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7ef7</con2:id>
                                                <con1:expr>
                                                    <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:resultado>ERROR</open:resultado>
         <open:descripcion>{fn:concat('Workspace de ',$body/open:getIdNodoRequest/open:BusinessWorkspace/@parentGroup),' con numero ',$body/open:getIdNodoRequest/open:BusinessWorkspace/open:numero/text(),' no existe'}</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                                </con1:expr>
                                            </con1:assign>
                                            <con2:reply>
                                                <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7ef4</con2:id>
                                            </con2:reply>
                                        </con1:default>
                                    </con1:ifThenElse>
                                </con1:responseTransform>
                            </con1:wsCallout>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-af1008d.N63098342.0.15bb162592d.N7dfb</con2:id>
                        <con1:case id="_BranchId-af1008d.N63098342.0.15bb162592d.N7dfa">
                            <con1:condition>
                                <con2:xqueryText>$body/open:getIdNodoRequest/open:aliasCarpeta='PARENT'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="idFolder">
                                    <con2:id>_ActionId-af1008d.N63098342.0.15bb162592d.N7d9a</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>$idNode</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:wsCallout>
                                <con2:comment>Se recupera el ID de la carpeta Nivel 2</con2:comment>
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a1</con2:id>
                                <con1:service ref="Utileria/AdminDocumentos/BusinessSerices/OTDocumentManagementBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                <con1:operation>ListNodes</con1:operation>
                                <con1:request>
                                    <con1:body wrapped="false">ListNodeRequest</con1:body>
                                    <con1:header>OpHeader</con1:header>
                                </con1:request>
                                <con1:response>
                                    <con1:body wrapped="false">ListNodeResponse</con1:body>
                                    <con1:header/>
                                </con1:response>
                                <con1:requestTransform>
                                    <con1:assign varName="ListNodeRequest">
                                        <con2:comment>Genera el request para listar las carpetas encontradas en el Nivel 1</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a0</con2:id>
                                        <con1:expr>
                                            <con2:xqueryText><![CDATA[<urn1:ListNodes xmlns:urn1="urn:DocMan.service.livelink.opentext.com">
         <urn1:parentID>{$idNode}</urn1:parentID>
         <urn1:partialData>false</urn1:partialData>
</urn1:ListNodes>]]></con2:xqueryText>
                                        </con1:expr>
                                    </con1:assign>
                                </con1:requestTransform>
                                <con1:responseTransform>
                                    <con1:ifThenElse>
                                        <con2:comment>se valida el proceso, si el proceso es "listaDocumentos" se recupera el nombre de la carpeta a partir del alias de la carpeta recibido, en caso contrario se recupera el nombre de carpeta permitido para almacenar archivos</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.66a20af4.0.1523c1d62fc.N7e5f</con2:id>
                                        <con1:case id="_BranchId-N3f57c7ff.66a20af4.0.1523c1d62fc.N7e5e">
                                            <con1:condition>
                                                <con2:xqueryText>$body/open:getIdNodoRequest/open:aliasCarpeta</con2:xqueryText>
                                            </con1:condition>
                                            <con1:actions>
                                                <con1:assign varName="carpeta">
                                                    <con2:id>_ActionId-N3f57c7ff.66a20af4.0.1523c1d62fc.N7e29</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAliasCarpeta', 'Value',$body/open:getIdNodoRequest/open:aliasCarpeta , 'Attribute1', 'NULL',('Parameter','aliasCarpeta'))</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                            </con1:actions>
                                        </con1:case>
                                        <con1:case id="_BranchId-af0041d.N26ff3b9.0.15b5f33b232.N7bdc">
                                            <con1:condition>
                                                <con2:xqueryText>$body/open:getIdNodoRequest/open:tipoPlantilla</con2:xqueryText>
                                            </con1:condition>
                                            <con1:actions>
                                                <con3:assign varName="ambiente" xmlns:con4="http://www.bea.com/wli/sb/stages/transform/config" xmlns:con3="http://www.bea.com/wli/sb/stages/transform/config">
                                                    <con2:comment>Se recupera el numero de atributo de donde se recuperara el ID de la carpeta nivel 0</con2:comment>
                                                    <con2:id>_ActionId-af0041d.N26ff3b9.0.15b5f33b232.N7a10</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value','1','Attribute3','NULL',('Parameter','AmbienteOT'))</con2:xqueryText>
                                                    </con1:expr>
                                                </con3:assign>
                                                <con1:assign varName="carpeta">
                                                    <con2:id>_ActionId-af0041d.N26ff3b9.0.15b5f33b232.N7ba8</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/administracionPlantillas', 'nombre',$body/open:getIdNodoRequest/open:tipoPlantilla, 'carpetaContenedora', 'null',('ambiente',$ambiente))</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                            </con1:actions>
                                        </con1:case>
                                        <con1:default>
                                            <con1:assign varName="carpeta">
                                                <con2:comment>En base al nombre del proceso, alias de carpeta y id consumidor se recupera el nombre de la carpeta valido para almacenar documentos.</con2:comment>
                                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N799f</con2:id>
                                                <con1:expr>
                                                    <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAlmacenaDocumento', 'CodigoDocumento',$body/open:getIdNodoRequest/open:tipoDocumento , $header/nmph:headerMessage/nmph:idConsumidor/text(), 'null',('Proceso',$body/open:getIdNodoRequest/open:proceso/text()))</con2:xqueryText>
                                                </con1:expr>
                                            </con1:assign>
                                        </con1:default>
                                    </con1:ifThenElse>
                                    <con1:ifThenElse>
                                        <con2:comment>Si la carpeta no esta configurada en los DVM's Manda un error, en caso contrario se busca el nombre de la carpeta en la lista de la carpeta nivel 1</con2:comment>
                                        <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e44</con2:id>
                                        <con1:case id="_BranchId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e43">
                                            <con1:condition>
                                                <con2:xqueryText>$carpeta='null'</con2:xqueryText>
                                            </con1:condition>
                                            <con1:actions>
                                                <con1:ifThenElse>
                                                    <con2:id>_ActionId-af0041d.N26ff3b9.0.15b5f33b232.N79d5</con2:id>
                                                    <con1:case id="_BranchId-af0041d.N26ff3b9.0.15b5f33b232.N79d4">
                                                        <con1:condition>
                                                            <con2:xqueryText>$body/open:getIdNodoRequest/open:tipoPlantilla</con2:xqueryText>
                                                        </con1:condition>
                                                        <con1:actions>
                                                            <con1:assign varName="body">
                                                                <con2:id>_ActionId-af0041d.N26ff3b9.0.15b5f33b232.N799f</con2:id>
                                                                <con1:expr>
                                                                    <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:resultado>ERROR</open:resultado>
         <open:descripcion>Plantilla {$body/open:getIdNodoRequest/open:tipoPlantilla} no valida</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                                                </con1:expr>
                                                            </con1:assign>
                                                        </con1:actions>
                                                    </con1:case>
                                                    <con1:default>
                                                        <con1:assign varName="body">
                                                            <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e0e</con2:id>
                                                            <con1:expr>
                                                                <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:resultado>ERROR</open:resultado>
         <open:descripcion>Valor {$body/open:getIdNodoRequest/open:tipoDocumento/text()} no valido</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                    </con1:default>
                                                </con1:ifThenElse>
                                                <con2:reply>
                                                    <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e0b</con2:id>
                                                </con2:reply>
                                            </con1:actions>
                                        </con1:case>
                                        <con1:default>
                                            <con1:assign varName="idFolder">
                                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N799e</con2:id>
                                                <con1:expr>
                                                    <con2:xqueryText>$ListNodeResponse/opendoc:ListNodesResult[./opendoc:Name=$carpeta]/opendoc:ID/text()</con2:xqueryText>
                                                </con1:expr>
                                            </con1:assign>
                                            <con1:ifThenElse>
                                                <con2:comment>Si la carpeta no se encuentra en la lista recuperada, se devuelve un error</con2:comment>
                                                <con2:id>_ActionId-N3f57c7ff.1b32af91.0.15242707c72.N7fbb</con2:id>
                                                <con1:case id="_BranchId-N3f57c7ff.1b32af91.0.15242707c72.N7fba">
                                                    <con1:condition>
                                                        <con2:xqueryText>fn:normalize-space($idFolder)=''</con2:xqueryText>
                                                    </con1:condition>
                                                    <con1:actions>
                                                        <con1:assign varName="body">
                                                            <con2:id>_ActionId-N3f57c7ff.1b32af91.0.15242707c72.N7fb9</con2:id>
                                                            <con1:expr>
                                                                <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:resultado>ERROR</open:resultado>
         <open:descripcion>{fn:concat('No existe la carpeta ',$carpeta,' en el espacio de trabajo de ',$body/open:getIdNodoRequest/open:BusinessWorkspace/@parentGroup), ' con número ',$body/open:getIdNodoRequest/open:BusinessWorkspace/open:numero/text()}</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con2:reply>
                                                            <con2:id>_ActionId-N3f57c7ff.1b32af91.0.15242707c72.N7fb8</con2:id>
                                                        </con2:reply>
                                                    </con1:actions>
                                                </con1:case>
                                            </con1:ifThenElse>
                                        </con1:default>
                                    </con1:ifThenElse>
                                </con1:responseTransform>
                            </con1:wsCallout>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57c7ff.N77f15b43.0.15212daffa7.N7785">
            <con:stage id="_StageId-N3f57c7ff.N77f15b43.0.15212daffa7.N7784" name="StageUploadResponse">
                <con:comment/>
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="urn1" namespace="urn:api.ecm.opentext.com"/>
                    <con2:userNsDecl prefix="opendoc" namespace="urn:DocMan.service.livelink.opentext.com"/>
                    <con2:userNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                    <con2:userNsDecl prefix="otcore" namespace="urn:Core.service.livelink.opentext.com"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="bodyResponse">
                        <con2:id>_ActionId-N3f57c7ff.66a20af4.0.1523c1d62fc.N7ffe</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:uploadDocumentoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:documentos>
         <open:nombreDocumento>{$fileName}</open:nombreDocumento>
         <open:documentoURL></open:documentoURL>
         <open:documentoID>{$uploadContentResponse/otcore:UploadContentResult/text()}</open:documentoID>
         <open:tipoDocumento>{fn:string($body/open:uploadDocumentoRequest/open:documento/@tipo)}</open:tipoDocumento>
         <open:estado>OK</open:estado>
         <open:descripcion>Success</open:descripcion>
         </open:documentos>
      </open:uploadDocumentoResponse>
</soapenv:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="serverOT">
                        <con2:comment>Se recupera el nombre del servidor de open Text.</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.66a20af4.0.1523c1d62fc.N7ffb</con2:id>
                        <con1:expr>
                            <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value','1', 'Attribute1', 'NULL',('Parameter','AmbienteOT'))</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:replace varName="bodyResponse" contents-only="true">
                        <con2:comment>Se genera la URL donde se puede consultar el documento</con2:comment>
                        <con2:id>_ActionId-a1e030f.N4c30c2c3.2b.152233332d5.N7ffd</con2:id>
                        <con1:location>
                            <con2:xpathText>./open:uploadDocumentoResponse/open:documentos/open:documentoURL</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con2:xqueryText>fn-bea:serialize(xs:string(fn:concat('&lt;![CDATA[',$serverOT,'/OTCS/livelink.exe/',$uploadContentResponse/otcore:UploadContentResult,'/',$fileName,'?func=doc.Fetch','&amp;amp;','nodeid=',$uploadContentResponse/otcore:UploadContentResult,'&amp;amp;','viewType=1]]&gt;')))</con2:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con1:replace varName="body" contents-only="false">
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N776e</con2:id>
                        <con1:location>
                            <con2:xpathText>.</con2:xpathText>
                        </con1:location>
                        <con1:expr>
                            <con2:xqueryText>$bodyResponse</con2:xqueryText>
                        </con1:expr>
                    </con1:replace>
                    <con1:rename varName="header">
                        <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7f52</con2:id>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                        <con1:localname>headerMessageResponse</con1:localname>
                    </con1:rename>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57c7ff.N77f15b43.0.15212daffa7.N79a9">
            <con:stage id="_StageId-N3f57c7ff.N77f15b43.0.15212daffa7.N79a8" name="StageGetIdResponse">
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:userNsDecl prefix="urn1" namespace="urn:api.ecm.opentext.com"/>
                    <con2:userNsDecl prefix="opendoc" namespace="urn:DocMan.service.livelink.opentext.com"/>
                    <con2:userNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                    <con2:userNsDecl prefix="otcore" namespace="urn:Core.service.livelink.opentext.com"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N78b7</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo>{$idFolder}</open:idNodo>
         <open:resultado>OK</open:resultado>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:rename varName="header">
                        <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7f4f</con2:id>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                        <con1:localname>headerMessageResponse</con1:localname>
                    </con1:rename>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N3f57c7ff.N77f15b43.0.15212daffa7.N778c">
            <con:stage id="_StageId-N3f57c7ff.5de6dca.0.156c8092c35.N7f81" name="StageValidacion">
                <con:comment>Se valida el body y el customHeader</con:comment>
                <con:context>
                    <con2:userNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7d1f</con2:id>
                        <con1:schema ref="Utileria/AdminDocumentos/Resources/Schemas/NMPAdministraDocumentosXSD"/>
                        <con1:schemaElement xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">open:uploadDocumentoRequest</con1:schemaElement>
                        <con1:varName>body</con1:varName>
                        <con1:location>
                            <con2:xpathText>./open:uploadDocumentoRequest</con2:xpathText>
                        </con1:location>
                        <con1:resultVarName/>
                    </con1:validate>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.5de6dca.0.156c8092c35.N7f7a</con2:id>
                        <con1:schema ref="Utileria/AdminDocumentos/Resources/Schemas/NMPAdministraDocumentosXSD"/>
                        <con1:schemaElement xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">open:customHeader</con1:schemaElement>
                        <con1:varName>header</con1:varName>
                        <con1:location>
                            <con2:xpathText>./open:customHeader</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f57c7ff.N77f15b43.0.15212daffa7.N778b" name="StageUploadRequest" errorHandler="error-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7d9a">
                <con:context>
                    <con2:userNsDecl prefix="corop" namespace="urn:Core.service.livelink.opentext.com"/>
                    <con2:userNsDecl prefix="consec" namespace="http://www.bea.com/wli/sb/services/security/config"/>
                    <con2:userNsDecl prefix="urn1" namespace="urn:api.ecm.opentext.com"/>
                    <con2:userNsDecl prefix="opendoc" namespace="urn:DocMan.service.livelink.opentext.com"/>
                    <con2:varNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="OpHeader">
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7762</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soap-env:Header xmlns:soap-env="http://schemas.xmlsoap.org/soap/envelope/">
<urn:OTAuthentication xmlns:urn="urn:api.ecm.opentext.com">       
         <urn:AuthenticationToken>{$header/open:customHeader/open:tokenUser/text()}</urn:AuthenticationToken>
      </urn:OTAuthentication>
</soap-env:Header>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="fileName">
                        <con2:comment>Se asigna el nombre del archivo a la variable fileName</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.N36978f0c.0.152a3311606.N7fcd</con2:id>
                        <con1:expr>
                            <con2:xqueryText>$body/open:uploadDocumentoRequest/open:documento/open:nombre/text()</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:wsCallout>
                        <con2:comment>Se crea el id del contexto del documento a almacenar</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7779</con2:id>
                        <con1:service ref="Utileria/AdminDocumentos/BusinessSerices/OTDocumentManagementBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>CreateDocumentContext</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">DocContextRequest</con1:body>
                            <con1:header>OpHeader</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">DocContextResponse</con1:body>
                            <con1:header/>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="DocContextRequest">
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7778</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<urn1:CreateDocumentContext xmlns:urn1="urn:DocMan.service.livelink.opentext.com">
         <urn1:parentID>{$body/open:uploadDocumentoRequest/open:idNodo/text()}</urn1:parentID>
         <urn1:name>{$fileName}</urn1:name>
         <urn1:advancedVersionControl>false</urn1:advancedVersionControl>        
         <urn1:metadata>    
         </urn1:metadata>
</urn1:CreateDocumentContext>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform>
                            <con1:insert varName="OpHeader">
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7777</con2:id>
                                <con1:location>
                                    <con2:xpathText>./urn1:OTAuthentication</con2:xpathText>
                                </con1:location>
                                <con1:where>before</con1:where>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<urn:fileAtts xmlns:urn="urn:Core.service.livelink.opentext.com">
         <urn:CreatedDate>{fn:current-dateTime()}</urn:CreatedDate>
         <urn:FileName>{$fileName}</urn:FileName>
         <urn:FileSize>{$body/open:uploadDocumentoRequest/open:documento/open:size/text()}</urn:FileSize>
         <urn:ModifiedDate>{fn:current-dateTime()}</urn:ModifiedDate>         
</urn:fileAtts>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:insert>
                            <con1:insert varName="OpHeader">
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7776</con2:id>
                                <con1:location>
                                    <con2:xpathText>./urn1:OTAuthentication</con2:xpathText>
                                </con1:location>
                                <con1:where>before</con1:where>
                                <con1:expr>
                                    <con2:xqueryText>&lt;urn:contextID xmlns:urn="urn:Core.service.livelink.opentext.com">{$DocContextResponse/opendoc:CreateDocumentContextResult/text()}&lt;/urn:contextID></con2:xqueryText>
                                </con1:expr>
                            </con1:insert>
                        </con1:responseTransform>
                    </con1:wsCallout>
                    <con1:wsCallout>
                        <con2:comment>Se almacena el documento en open text.</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7775</con2:id>
                        <con1:service ref="Utileria/AdminDocumentos/BusinessSerices/OTContentServiceBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>UploadContent</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">uploadContentRequest</con1:body>
                            <con1:header>OpHeader</con1:header>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">uploadContentResponse</con1:body>
                            <con1:header/>
                        </con1:response>
                        <con1:requestTransform>
                            <con1:assign varName="uploadContentRequest">
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7774</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>&lt;urn:UploadContent xmlns:urn="urn:Core.service.livelink.opentext.com">
         &lt;urn:contents>{$body/open:uploadDocumentoRequest/open:documento/open:contenido/text()}&lt;/urn:contents>
&lt;/urn:UploadContent></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:requestTransform>
                        <con1:responseTransform/>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.N30a15aa1.0.151eb1f54d7.N7e03">
            <con:stage id="_StageId-N3f57c7ff.N30a15aa1.0.151eb1f54d7.N7e02" name="StageFaults">
                <con:context/>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-N3f57c7ff.N30a15aa1.0.151eb1f54d7.N7dff</con2:id>
                        <con1:expr>
                            <con2:xsltTransform>
                                <con2:resource ref="Utileria/AdminDocumentos/Resources/Transformations/TransformFaultsUtileriaAdminDocumentos"/>
                                <con2:input>$fault</con2:input>
                            </con2:xsltTransform>
                        </con1:expr>
                    </con1:assign>
                    <con1:assign varName="header">
                        <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7dfd</con2:id>
                        <con1:expr>
                            <con2:xqueryText>&lt;soap:Header xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">
&lt;/soap:Header></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con2:reply isError="true">
                        <con2:id>_ActionId-N3f57c7ff.N30a15aa1.0.151eb1f54d7.N7dfb</con2:id>
                    </con2:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N3f57c7ff.N77f15b43.0.15212daffa7.N7b98">
            <con:stage id="_StageId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7dd4" name="StageValidacion">
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7dd1</con2:id>
                        <con1:schema ref="Common/XSD/NMPStandardHeader"/>
                        <con1:schemaElement xmlns:nmp="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader">nmp:headerMessage</con1:schemaElement>
                        <con1:varName>header</con1:varName>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                    <con1:assign varName="userOT">
                        <con2:comment>Recupera el nombre del service account usado por los consumidores definidos en el DVM settingsAdministraDocumentos</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.4546ee07.0.157f8a35c20.N7ffd</con2:id>
                        <con1:expr>
                            <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value',$header/nmph:headerMessage/nmph:idDestino,'Attribute1', 'NULL',('Parameter','UserOT'))</con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N3f57c7ff.4546ee07.0.157f8a35c20.N7f19</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.4546ee07.0.157f8a35c20.N7f18">
                            <con1:condition>
                                <con2:xqueryText>$userOT='NULL'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="userOT">
                                    <con2:comment>Recupera el nombre del service account usado por los consumidores definidos en el DVM settingsAdministraDocumentos</con2:comment>
                                    <con2:id>_ActionId-N3f57c7ff.5de6dca.0.156c8092c35.N7ffd</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value',$header/nmph:headerMessage/nmph:idConsumidor,'Attribute1', 'NULL',('Parameter','UserOT'))</con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f57c7ff.N77f15b43.0.15212daffa7.N7b97" name="StageRequest">
                <con:context>
                    <con2:userNsDecl prefix="corop" namespace="urn:Core.service.livelink.opentext.com"/>
                    <con2:userNsDecl prefix="consec" namespace="http://www.bea.com/wli/sb/services/security/config"/>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:varNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:comment>Si el usuario esta listado en DVM, recupera las credenciales de el Service Account, en caso contrario las credenciales son recuperadas del Request</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.5de6dca.0.156c8092c35.N7f93</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.5de6dca.0.156c8092c35.N7f92">
                            <con1:condition>
                                <con2:xqueryText>$userOT='NULL'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:validate>
                                    <con2:id>_ActionId-N3f57c7ff.5de6dca.0.156c8092c35.N7f8f</con2:id>
                                    <con1:schema ref="Utileria/AdminDocumentos/Resources/Schemas/NMPAdministraDocumentosXSD"/>
                                    <con1:schemaElement xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">open:autenticacionRequest</con1:schemaElement>
                                    <con1:varName>body</con1:varName>
                                    <con1:location>
                                        <con2:xpathText>./open:autenticacionRequest</con2:xpathText>
                                    </con1:location>
                                </con1:validate>
                                <con1:assign varName="authenticationRequest">
                                    <con2:id>_ActionId-N3f57c7ff.5de6dca.0.156c8092c35.N7f89</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText><![CDATA[<urn:AuthenticateUser xmlns:urn="urn:Core.service.livelink.opentext.com">         
         <urn:userName>{$body/open:autenticacionRequest/open:usuario/text()}</urn:userName>
         <urn:userPassword>{$body/open:autenticacionRequest/open:contrasena/text()}</urn:userPassword>
</urn:AuthenticateUser>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:assign varName="usuario">
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7b96</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>fn-bea:lookupBasicCredentials(fn:concat('Utileria/AdminDocumentos/Resources/ServiceAccount/',$userOT))</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                            <con1:assign varName="authenticationRequest">
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7b95</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<urn:AuthenticateUser xmlns:urn="urn:Core.service.livelink.opentext.com">         
         <urn:userName>{$usuario/consec:username/text()}</urn:userName>
         <urn:userPassword>{$usuario/consec:password/text()}</urn:userPassword>
</urn:AuthenticateUser>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:wsCallout>
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7b94</con2:id>
                        <con1:service ref="Utileria/AdminDocumentos/BusinessSerices/OTAuthenticationBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                        <con1:operation>AuthenticateUser</con1:operation>
                        <con1:request>
                            <con1:body wrapped="false">authenticationRequest</con1:body>
                            <con1:header/>
                        </con1:request>
                        <con1:response>
                            <con1:body wrapped="false">authenticationResponse</con1:body>
                            <con1:header/>
                        </con1:response>
                        <con1:requestTransform/>
                        <con1:responseTransform>
                            <con1:assign varName="tokenVar">
                                <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7b93</con2:id>
                                <con1:expr>
                                    <con2:xqueryText>$authenticationResponse/corop:AuthenticateUserResult</con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:responseTransform>
                    </con1:wsCallout>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7d9a">
            <con:stage id="_StageId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N733c" name="StageFaultsUpload">
                <con:context>
                    <con2:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                    <con2:varNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:comment>Valida si el codigo de error obtenido para asignar la descripción correcta del error. 382500=Error enviado del servicio, 382505=Error de validación.</con2:comment>
                        <con2:id>_ActionId-a1e030f.N4c30c2c3.2a.15222ac01d5.N8000</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N733a">
                            <con1:condition>
                                <con2:xqueryText>$fault/ctx:errorCode='OSB-382500'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="body">
                                    <con2:id>_ActionId-a1e030f.N4c30c2c3.2a.15222ac01d5.N7fff</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:uploadDocumentoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:documentos>
         <open:nombreDocumento>{$body/open:uploadDocumentoRequest/open:documento/open:nombre/text()}</open:nombreDocumento>
         <open:documentoURL/>
         <open:estado>ERROR</open:estado>
         <open:descripcion>{$fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text()}</open:descripcion>
         </open:documentos>
      </open:uploadDocumentoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-N3f57c7ff.N36978f0c.0.152a3311606.N7f1b">
                            <con1:condition>
                                <con2:xqueryText>$fault/ctx:errorCode='OSB-382505'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="body">
                                    <con2:id>_ActionId-N3f57c7ff.N36978f0c.0.152a3311606.N7ee8</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:estado>ERROR</open:estado>
         <open:descripcion>{$fault/ctx:details/con1:ValidationFailureDetail[1]/con1:message[1]/text()}</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:assign varName="body">
                                <con2:id>_ActionId-a1e030f.N4c30c2c3.2a.15222ac01d5.N7ffe</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:uploadDocumentoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:documentos>
         <open:nombreDocumento>{$body/open:uploadDocumentoRequest/open:documento/open:nombre/text()}</open:nombreDocumento>
         <open:documentoURL/>
         <open:estado>ERROR</open:estado>
         <open:descripcion>{$fault/ctx:reason/text()}</open:descripcion>
         </open:documentos>
      </open:uploadDocumentoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:rename varName="header">
                        <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7f4c</con2:id>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                        <con1:localname>headerMessageResponse</con1:localname>
                    </con1:rename>
                    <con2:reply isError="false">
                        <con2:id>_ActionId-a1e030f.N4c30c2c3.2a.15222ac01d5.N7ffd</con2:id>
                    </con2:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7ef3">
            <con:stage id="_StageId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7ef2" name="StageFaultGetId">
                <con:context>
                    <con2:userNsDecl prefix="con1" namespace="http://www.bea.com/wli/sb/stages/transform/config"/>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con:context>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7eb7</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7eb6">
                            <con1:condition>
                                <con2:xqueryText>$fault/ctx:errorCode='OSB-382500'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="body">
                                    <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e82</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:resultado>ERROR</open:resultado>
         <open:descripcion>{$fault/ctx:details/con1:ReceivedFaultDetail/con1:faultstring/text()}</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-N3f57c7ff.N36978f0c.0.152a3311606.N7f52">
                            <con1:condition>
                                <con2:xqueryText>$fault/ctx:errorCode='OSB-382505'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="body">
                                    <con2:id>_ActionId-N3f57c7ff.N36978f0c.0.152a3311606.N7f1e</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:resultado>ERROR</open:resultado>
         <open:descripcion>{$fault/ctx:details/con1:ValidationFailureDetail[1]/con1:message[1]/text()}</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:assign varName="body">
                                <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e4e</con2:id>
                                <con1:expr>
                                    <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:getIdNodoResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:idNodo></open:idNodo>
         <open:resultado>ERROR</open:resultado>
         <open:descripcion>{$fault/ctx:reason/text()}</open:descripcion>
      </open:getIdNodoResponse>
</soapenv:Body>]]></con2:xqueryText>
                                </con1:expr>
                            </con1:assign>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:rename varName="header">
                        <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7f49</con2:id>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                        <con1:localname>headerMessageResponse</con1:localname>
                    </con1:rename>
                    <con2:reply>
                        <con2:id>_ActionId-N3f57c7ff.N7e0999cc.0.1521e1476fd.N7e4b</con2:id>
                    </con2:reply>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57c7ff.N77f15b43.0.15212daffa7.N7b91">
            <con:stage id="_StageId-N3f57c7ff.N77f15b43.0.15212daffa7.N7b0e" name="StageResponse">
                <con:context>
                    <con2:userNsDecl prefix="nmph" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/NMPStandardHeader"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="body">
                        <con2:id>_ActionId-N3f57c7ff.N77f15b43.0.15212daffa7.N7b92</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<soapenv:Body xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
<open:autenticacionResponse xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">       
         <open:autenticacionToken>{$tokenVar/text()}</open:autenticacionToken>
      </open:autenticacionResponse>
</soapenv:Body>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:rename varName="header">
                        <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7f55</con2:id>
                        <con1:location>
                            <con2:xpathText>./nmph:headerMessage</con2:xpathText>
                        </con1:location>
                        <con1:localname>headerMessageResponse</con1:localname>
                    </con1:rename>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="request" name="request-N3f57c7ff.714f8497.0.1560983aaa2.N7e37">
            <con:stage id="_StageId-N3f57c7ff.714f8497.0.1560983aaa2.N74ff" name="StageValidacion">
                <con:comment>Se valida el body y el customHeader</con:comment>
                <con:context>
                    <con2:userNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N74fc</con2:id>
                        <con1:schema ref="Utileria/AdminDocumentos/Resources/Schemas/NMPAdministraDocumentosXSD"/>
                        <con1:schemaElement xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">open:crearCarpetaRequest</con1:schemaElement>
                        <con1:varName>body</con1:varName>
                        <con1:location>
                            <con2:xpathText>./open:crearCarpetaRequest</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                    <con1:validate>
                        <con2:id>_ActionId-N3f57c7ff.5de6dca.0.156c8092c35.N7f77</con2:id>
                        <con1:schema ref="Utileria/AdminDocumentos/Resources/Schemas/NMPAdministraDocumentosXSD"/>
                        <con1:schemaElement xmlns:open="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">open:customHeader</con1:schemaElement>
                        <con1:varName>header</con1:varName>
                        <con1:location>
                            <con2:xpathText>./open:customHeader</con2:xpathText>
                        </con1:location>
                    </con1:validate>
                </con:actions>
            </con:stage>
            <con:stage id="_StageId-N3f57c7ff.714f8497.0.1560983aaa2.N7e35" name="StageCarpeta" errorHandler="error-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7e0c">
                <con:context>
                    <con2:userNsDecl prefix="opendoc" namespace="urn:DocMan.service.livelink.opentext.com"/>
                    <con2:userNsDecl prefix="open" namespace="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc"/>
                </con:context>
                <con:actions>
                    <con1:assign varName="respuesta">
                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N775e</con2:id>
                        <con1:expr>
                            <con2:xqueryText><![CDATA[<ot:crearCarpetaResponse xmlns:ot="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">
        <ot:resultado>
            <ot:respuesta>OK</ot:respuesta>
            <ot:descripcion>null</ot:descripcion>
        </ot:resultado>
    </ot:crearCarpetaResponse>]]></con2:xqueryText>
                        </con1:expr>
                    </con1:assign>
                    <con1:ifThenElse>
                        <con2:comment>Se valida el nivel de dependencia</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7ad0</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.Nfc2034a.0.156dc706085.N7fff">
                            <con1:condition>
                                <con2:xqueryText>$body/open:crearCarpetaRequest/open:carpeta/@nivelDependencia='1'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:ifThenElse>
                                    <con2:comment>Si el nivel de depencia es 1 se valida que este tenga definido una carpeta contenedora, en caso contrario se manda un error</con2:comment>
                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N779e</con2:id>
                                    <con1:case id="_BranchId-N3f57c7ff.714f8497.0.1560983aaa2.N779d">
                                        <con1:condition>
                                            <con2:xqueryText>fn:count($body/open:crearCarpetaRequest/open:carpetaContenedora/open:nombre)=1</con2:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:assign varName="directorioValidoFlag">
                                                <con2:comment>Se valida que el nivel de jerarquia entre carpetas sea valido.</con2:comment>
                                                <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7b05</con2:id>
                                                <con1:expr>
                                                    <con2:xqueryText>dvm:lookup('Utileria/AdminDocumentos/Resources/DVMs/settingsNivelDependencia', 'Subdirectorios',$body/open:crearCarpetaRequest/open:carpeta/@tipo,$body/open:crearCarpetaRequest/open:carpetaContenedora/@tipo,'0')</con2:xqueryText>
                                                </con1:expr>
                                            </con1:assign>
                                            <con1:ifThenElse>
                                                <con2:comment>Se valida que el nivel de jerarquia entre carpetas sea valido.</con2:comment>
                                                <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7a2e</con2:id>
                                                <con1:case id="_BranchId-N3f57c7ff.714f8497.0.1560983aaa2.N7a2d">
                                                    <con1:condition>
                                                        <con2:xqueryText>$directorioValidoFlag='1'</con2:xqueryText>
                                                    </con1:condition>
                                                    <con1:actions>
                                                        <con1:assign varName="carpetaNivel0">
                                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7954</con2:id>
                                                            <con1:expr>
                                                                <con2:xqueryText>$body/open:crearCarpetaRequest/open:carpetaContenedora/open:nombre</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="atributoParentId">
                                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7951</con2:id>
                                                            <con1:expr>
                                                                <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value','1','Attribute2', 'NULL',('Parameter','AmbienteOT'))</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                        <con1:assign varName="parentId">
                                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N794e</con2:id>
                                                            <con1:expr>
                                                                <con2:xqueryText>dvm:lookupValue('Utileria/AdminDocumentos/Resources/DVMs/settingsAdministraDocumentos', 'Value',$carpetaNivel0 , $atributoParentId, '0',('Parameter','parentGroup'))</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                    </con1:actions>
                                                </con1:case>
                                                <con1:default>
                                                    <con1:replace varName="respuesta" contents-only="true">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7755</con2:id>
                                                        <con1:location>
                                                            <con2:xpathText>./open:resultado/open:descripcion</con2:xpathText>
                                                        </con1:location>
                                                        <con1:expr>
                                                            <con2:xqueryText>fn:concat('Creación de carpeta ',$body/open:crearCarpetaRequest/open:carpeta/@tipo,' a este nivel no permitido')</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:replace>
                                                    <con1:replace varName="respuesta" contents-only="true">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N76a5</con2:id>
                                                        <con1:location>
                                                            <con2:xpathText>./open:resultado/open:respuesta</con2:xpathText>
                                                        </con1:location>
                                                        <con1:expr>
                                                            <con2:xqueryText>'ERROR'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:replace>
                                                </con1:default>
                                            </con1:ifThenElse>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:replace varName="respuesta" contents-only="true">
                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7758</con2:id>
                                            <con1:location>
                                                <con2:xpathText>./open:resultado/open:descripcion</con2:xpathText>
                                            </con1:location>
                                            <con1:expr>
                                                <con2:xqueryText>fn:concat('Carpeta ',$body/open:crearCarpetaRequest/open:carpeta/@tipo,' con dependecia 1 se debe de indicar una carpeta contenedora')</con2:xqueryText>
                                            </con1:expr>
                                        </con1:replace>
                                        <con1:replace varName="respuesta" contents-only="true">
                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N76ac</con2:id>
                                            <con1:location>
                                                <con2:xpathText>./open:resultado/open:respuesta</con2:xpathText>
                                            </con1:location>
                                            <con1:expr>
                                                <con2:xqueryText>'ERROR'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:replace>
                                    </con1:default>
                                </con1:ifThenElse>
                            </con1:actions>
                        </con1:case>
                        <con1:case id="_BranchId-N3f57c7ff.Nfc2034a.0.156dc706085.N7edc">
                            <con1:condition>
                                <con2:xqueryText>$body/open:crearCarpetaRequest/open:carpeta/@nivelDependencia='2'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:ifThenElse>
                                    <con2:comment>Si el nivel de dependencia es 2 se valida que en el nodo de la carpeta contenedora exista el elemento id</con2:comment>
                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7917</con2:id>
                                    <con1:case id="_BranchId-N3f57c7ff.714f8497.0.1560983aaa2.N7916">
                                        <con1:condition>
                                            <con2:xqueryText>$body/open:crearCarpetaRequest/open:carpetaContenedora/open:id</con2:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:assign varName="directorioValidoFlag">
                                                <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7873</con2:id>
                                                <con1:expr>
                                                    <con2:xqueryText>dvm:lookup('Utileria/AdminDocumentos/Resources/DVMs/settingsNivelDependencia', 'Subdirectorios',$body/open:crearCarpetaRequest/open:carpeta/@tipo,$body/open:crearCarpetaRequest/open:carpetaContenedora/@tipo,'0')</con2:xqueryText>
                                                </con1:expr>
                                            </con1:assign>
                                            <con1:ifThenElse>
                                                <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N78a9</con2:id>
                                                <con1:case id="_BranchId-N3f57c7ff.714f8497.0.1560983aaa2.N78a8">
                                                    <con1:condition>
                                                        <con2:xqueryText>$directorioValidoFlag='1'</con2:xqueryText>
                                                    </con1:condition>
                                                    <con1:actions>
                                                        <con1:assign varName="parentId">
                                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N780b</con2:id>
                                                            <con1:expr>
                                                                <con2:xqueryText>$body/open:crearCarpetaRequest/open:carpetaContenedora/open:id/text()</con2:xqueryText>
                                                            </con1:expr>
                                                        </con1:assign>
                                                    </con1:actions>
                                                </con1:case>
                                                <con1:default>
                                                    <con1:replace varName="respuesta" contents-only="true">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N771e</con2:id>
                                                        <con1:location>
                                                            <con2:xpathText>./open:resultado/open:descripcion</con2:xpathText>
                                                        </con1:location>
                                                        <con1:expr>
                                                            <con2:xqueryText>fn:concat('Creación de carpeta ',$body/open:crearCarpetaRequest/open:carpeta/@tipo,' a este nivel no permitido')</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:replace>
                                                    <con1:replace varName="respuesta" contents-only="true">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N76a7</con2:id>
                                                        <con1:location>
                                                            <con2:xpathText>./open:resultado/open:respuesta</con2:xpathText>
                                                        </con1:location>
                                                        <con1:expr>
                                                            <con2:xqueryText>'ERROR'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:replace>
                                                </con1:default>
                                            </con1:ifThenElse>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:replace varName="respuesta" contents-only="true">
                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7721</con2:id>
                                            <con1:location>
                                                <con2:xpathText>./open:resultado/open:descripcion</con2:xpathText>
                                            </con1:location>
                                            <con1:expr>
                                                <con2:xqueryText>fn:concat('Se necesita indicar el ID de la carpeta contenedora para ',$body/open:crearCarpetaRequest/open:carpetaContenedora/@tipo)</con2:xqueryText>
                                            </con1:expr>
                                        </con1:replace>
                                        <con1:replace varName="respuesta" contents-only="true">
                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N76a9</con2:id>
                                            <con1:location>
                                                <con2:xpathText>./open:resultado/open:respuesta</con2:xpathText>
                                            </con1:location>
                                            <con1:expr>
                                                <con2:xqueryText>'ERROR'</con2:xqueryText>
                                            </con1:expr>
                                        </con1:replace>
                                    </con1:default>
                                </con1:ifThenElse>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:replace varName="respuesta" contents-only="true">
                                <con2:id>_ActionId-N3f57c7ff.Nfc2034a.0.156dc706085.N7e9e</con2:id>
                                <con1:location>
                                    <con2:xpathText>./open:resultado/open:descripcion</con2:xpathText>
                                </con1:location>
                                <con1:expr>
                                    <con2:xqueryText>fn:concat('Nivel de dependencia ',$body/open:crearCarpetaRequest/open:carpeta/@nivelDependencia,', no es valido')</con2:xqueryText>
                                </con1:expr>
                            </con1:replace>
                            <con1:replace varName="respuesta" contents-only="true">
                                <con2:id>_ActionId-N3f57c7ff.Nfc2034a.0.156dc706085.N7e9b</con2:id>
                                <con1:location>
                                    <con2:xpathText>./open:resultado/open:respuesta</con2:xpathText>
                                </con1:location>
                                <con1:expr>
                                    <con2:xqueryText>'ERROR'</con2:xqueryText>
                                </con1:expr>
                            </con1:replace>
                        </con1:default>
                    </con1:ifThenElse>
                    <con1:ifThenElse>
                        <con2:comment>Se valida si en el paso anterior ocurrio un error si fuera el caso, se responde con el error, en caso contrario, continua con la validación y creació de la carpeta</con2:comment>
                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N76b5</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.714f8497.0.1560983aaa2.N76b4">
                            <con1:condition>
                                <con2:xqueryText>$respuesta/open:resultado/open:respuesta='OK'</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:assign varName="OpHeader">
                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7df4</con2:id>
                                    <con1:expr>
                                        <con2:xqueryText><![CDATA[<soap-env:Header xmlns:soap-env="http://schemas.xmlsoap.org/soap/envelope/">
<urn:OTAuthentication xmlns:urn="urn:api.ecm.opentext.com">       
         <urn:AuthenticationToken>{$header/open:customHeader/open:tokenUser/text()}</urn:AuthenticationToken>
      </urn:OTAuthentication>
</soap-env:Header>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:assign>
                                <con1:assign varName="numeroBW">
                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d9b</con2:id>
                                    <con1:expr>
                                        <con2:xqueryTransform>
                                            <con2:resource ref="Utileria/AdminDocumentos/Resources/Transformations/OTOperacionesXQ"/>
                                            <con2:param name="funcion">
                                                <con2:path>$body/open:crearCarpetaRequest/open:carpeta/@tipo</con2:path>
                                            </con2:param>
                                            <con2:param name="param1">
                                                <con2:path>$body/open:crearCarpetaRequest/open:carpeta/open:nombre/text()</con2:path>
                                            </con2:param>
                                        </con2:xqueryTransform>
                                    </con1:expr>
                                </con1:assign>
                                <con1:wsCallout>
                                    <con2:comment>Se valida si la carpeta existe</con2:comment>
                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d9c</con2:id>
                                    <con1:service ref="Utileria/AdminDocumentos/BusinessSerices/OTDocumentManagementBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                    <con1:operation>GetNodeByName</con1:operation>
                                    <con1:request>
                                        <con1:body wrapped="false">GetNodeRequest</con1:body>
                                        <con1:header>OpHeader</con1:header>
                                    </con1:request>
                                    <con1:response>
                                        <con1:body wrapped="false">GetNodeResponse</con1:body>
                                    </con1:response>
                                    <con1:requestTransform>
                                        <con1:assign varName="GetNodeRequest">
                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d98</con2:id>
                                            <con1:expr>
                                                <con2:xqueryText><![CDATA[<urn1:GetNodeByName xmlns:urn1="urn:DocMan.service.livelink.opentext.com">
         <urn1:parentID>{$parentId}</urn1:parentID>
         <urn1:name>{$numeroBW/text()}</urn1:name>       
</urn1:GetNodeByName>]]></con2:xqueryText>
                                            </con1:expr>
                                        </con1:assign>
                                    </con1:requestTransform>
                                    <con1:responseTransform>
                                        <con1:ifThenElse>
                                            <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d97</con2:id>
                                            <con1:case id="_BranchId-N3f57c7ff.714f8497.0.1560983aaa2.N7d96">
                                                <con1:condition>
                                                    <con2:xqueryText>fn:count($GetNodeResponse/opendoc:GetNodeByNameResult/opendoc:ID)>0</con2:xqueryText>
                                                </con1:condition>
                                                <con1:actions>
                                                    <con1:assign varName="idNode">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d95</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>$GetNodeResponse/opendoc:GetNodeByNameResult/opendoc:ID/text()</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:assign varName="existeCarpetaFlag">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d8d</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>'1'</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:actions>
                                            </con1:case>
                                            <con1:default>
                                                <con1:assign varName="existeCarpetaFlag">
                                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d94</con2:id>
                                                    <con1:expr>
                                                        <con2:xqueryText>'0'</con2:xqueryText>
                                                    </con1:expr>
                                                </con1:assign>
                                            </con1:default>
                                        </con1:ifThenElse>
                                    </con1:responseTransform>
                                </con1:wsCallout>
                                <con1:ifThenElse>
                                    <con2:comment>Si la carpeta existe se manda el Id recuperado en el paso anterior, en caso contrario se crea</con2:comment>
                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d24</con2:id>
                                    <con1:case id="_BranchId-N3f57c7ff.714f8497.0.1560983aaa2.N7d23">
                                        <con1:condition>
                                            <con2:xqueryText>$existeCarpetaFlag='0'</con2:xqueryText>
                                        </con1:condition>
                                        <con1:actions>
                                            <con1:wsCallout>
                                                <con2:comment>Se crea la carpeta</con2:comment>
                                                <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d0b</con2:id>
                                                <con1:service ref="Utileria/AdminDocumentos/BusinessSerices/OTDocumentManagementBS" xsi:type="ref:BusinessServiceRef" xmlns:ref="http://www.bea.com/wli/sb/reference"/>
                                                <con1:operation>CreateFolder</con1:operation>
                                                <con1:request>
                                                    <con1:body wrapped="false">createFolderRequest</con1:body>
                                                    <con1:header>OpHeader</con1:header>
                                                </con1:request>
                                                <con1:response>
                                                    <con1:body wrapped="false">createFolderResponse</con1:body>
                                                </con1:response>
                                                <con1:requestTransform>
                                                    <con1:assign varName="createFolderRequest">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d08</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText><![CDATA[<urn1:CreateFolder xmlns:urn1="urn:DocMan.service.livelink.opentext.com">
        <urn1:parentID>{$parentId}</urn1:parentID>        
        <urn1:name>{$numeroBW/text()}</urn1:name>
        <urn1:comment>{$body/open:crearCarpetaRequest/open:carpeta/open:comentarios/text()}</urn1:comment>
</urn1:CreateFolder>]]></con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                </con1:requestTransform>
                                                <con1:responseTransform>
                                                    <con1:assign varName="idNode">
                                                        <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7cd3</con2:id>
                                                        <con1:expr>
                                                            <con2:xqueryText>$createFolderResponse/opendoc:CreateFolderResult/opendoc:ID/text()</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:assign>
                                                    <con1:replace varName="respuesta" contents-only="true">
                                                        <con2:id>_ActionId-N3f57c7ff.2f5c6636.0.1562d7895ff.N7fc7</con2:id>
                                                        <con1:location>
                                                            <con2:xpathText>./open:resultado/open:descripcion</con2:xpathText>
                                                        </con1:location>
                                                        <con1:expr>
                                                            <con2:xqueryText>fn:concat('Carpeta ',$numeroBW,' creada exitosamente')</con2:xqueryText>
                                                        </con1:expr>
                                                    </con1:replace>
                                                </con1:responseTransform>
                                            </con1:wsCallout>
                                        </con1:actions>
                                    </con1:case>
                                    <con1:default>
                                        <con1:replace varName="respuesta" contents-only="true">
                                            <con2:id>_ActionId-N3f57c7ff.2f5c6636.0.1562d7895ff.N7fca</con2:id>
                                            <con1:location>
                                                <con2:xpathText>./open:resultado/open:descripcion</con2:xpathText>
                                            </con1:location>
                                            <con1:expr>
                                                <con2:xqueryText>fn:concat('Carpeta ',$numeroBW,' ya existe')</con2:xqueryText>
                                            </con1:expr>
                                        </con1:replace>
                                    </con1:default>
                                </con1:ifThenElse>
                                <con1:insert varName="respuesta">
                                    <con2:id>_ActionId-N3f57c7ff.2f5c6636.0.1562d7895ff.N7ffe</con2:id>
                                    <con1:location>
                                        <con2:xpathText>./open:resultado</con2:xpathText>
                                    </con1:location>
                                    <con1:where>before</con1:where>
                                    <con1:expr>
                                        <con2:xqueryText><![CDATA[<ot:carpeta tipo="{fn:string($body/open:crearCarpetaRequest/open:carpeta/@tipo)}" xmlns:ot="http://servicios.montedepiedad.com.mx/NMP/Schema/OpenTextSvc">
            <ot:idCarpetaContenedora>{$parentId}</ot:idCarpetaContenedora>
            <ot:nombre>{$numeroBW/text()}</ot:nombre>
            <ot:idCarpeta>{$idNode}</ot:idCarpeta>
</ot:carpeta>]]></con2:xqueryText>
                                    </con1:expr>
                                </con1:insert>
                                <con1:replace varName="body" contents-only="false">
                                    <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N7d11</con2:id>
                                    <con1:location>
                                        <con2:xpathText>./*</con2:xpathText>
                                    </con1:location>
                                    <con1:expr>
                                        <con2:xqueryText>$respuesta</con2:xqueryText>
                                    </con1:expr>
                                </con1:replace>
                            </con1:actions>
                        </con1:case>
                        <con1:default>
                            <con1:replace varName="body" contents-only="false">
                                <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N76a2</con2:id>
                                <con1:location>
                                    <con2:xpathText>./*</con2:xpathText>
                                </con1:location>
                                <con1:expr>
                                    <con2:xqueryText>$respuesta</con2:xqueryText>
                                </con1:expr>
                            </con1:replace>
                            <con2:reply>
                                <con2:id>_ActionId-N3f57c7ff.714f8497.0.1560983aaa2.N769e</con2:id>
                            </con2:reply>
                        </con1:default>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="response" name="response-N3f57c7ff.714f8497.0.1560983aaa2.N7e36">
            <con:stage id="_StageId-N3f57c7ff.714f8497.0.1560983aaa2.N7e34" name="StageResponse">
                <con:context/>
                <con:actions/>
            </con:stage>
        </con:pipeline>
        <con:pipeline type="error" name="error-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7e0c">
            <con:stage id="_StageId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7e0b" name="StageError">
                <con:context/>
                <con:actions>
                    <con1:ifThenElse>
                        <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7e04</con2:id>
                        <con1:case id="_BranchId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7e03">
                            <con1:condition>
                                <con2:xqueryText>fn:matches($fault/ctx:reason, 'directorioValidoFlag')</con2:xqueryText>
                            </con1:condition>
                            <con1:actions>
                                <con1:Error>
                                    <con2:id>_ActionId-N3f57c7ff.7b9dbc23.0.156e6e7fe55.N7e00</con2:id>
                                    <con1:errCode>OSB-002</con1:errCode>
                                    <con1:message>Valores para identificar el nivel de dependencia no son validos.</con1:message>
                                </con1:Error>
                            </con1:actions>
                        </con1:case>
                        <con1:default/>
                    </con1:ifThenElse>
                </con:actions>
            </con:stage>
        </con:pipeline>
        <con:flow>
            <con:branch-node type="operation" id="_FlowId-N3f57c7ff.N77f15b43.0.15212daffa7.N7ce5" name="BranchNodeUtileriaAdminDoctos">
                <con:context/>
                <con:branch-table>
                    <con:branch name="autenticacionToken">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairAutenticacion">
                                <con:request>request-N3f57c7ff.N77f15b43.0.15212daffa7.N7b98</con:request>
                                <con:response>response-N3f57c7ff.N77f15b43.0.15212daffa7.N7b91</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="getIdNodo">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairGetIdNodo">
                                <con:request>request-N3f57c7ff.N77f15b43.0.15212daffa7.N79b0</con:request>
                                <con:response>response-N3f57c7ff.N77f15b43.0.15212daffa7.N79a9</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="uploadDocumento">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairUploadDoc">
                                <con:request>request-N3f57c7ff.N77f15b43.0.15212daffa7.N778c</con:request>
                                <con:response>response-N3f57c7ff.N77f15b43.0.15212daffa7.N7785</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:branch name="crearCarpeta">
                        <con:operator>equals</con:operator>
                        <con:value/>
                        <con:flow>
                            <con:pipeline-node name="PipelinePairCrearCarpeta">
                                <con:request>request-N3f57c7ff.714f8497.0.1560983aaa2.N7e37</con:request>
                                <con:response>response-N3f57c7ff.714f8497.0.1560983aaa2.N7e36</con:response>
                            </con:pipeline-node>
                        </con:flow>
                    </con:branch>
                    <con:default-branch>
                        <con:flow/>
                    </con:default-branch>
                </con:branch-table>
            </con:branch-node>
        </con:flow>
    </con:router>
    <aler:alertRules xsi:nil="true" xmlns:aler="http://xmlns.oracle.com/servicebus/monitoring/alert"/>
</con:pipelineEntry>